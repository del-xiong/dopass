var g_CS={},g_CS_count={},g_CS_tabs={},g_nexttabid=1,g_CS_tops={},g_breach_data=null,g_secret_cache={},g_cached_hash=null,g_hash_live=0,g_breach_alert_set=0,poll_timeout=6E4,debug=!1,g_possiblemax_tuple=[],g_local_key=null,g_local_key_hex=null,g_local_hash=null,g_local_key_hash=null,g_username=null,g_username_hash=null,g_uid=null,g_pwdeckey=null,g_token="",g_identity="",g_sites=[],g_tlds=[],g_securenotes=[],g_applications=[],g_prompts=[],g_local_accts_version=-1,g_server_accts_version=-1,g_identities=
[],g_formfills=[],g_neverurls=[],g_equivalentdomains=[],g_urlrules=[],g_prefoverrides=[],g_pendings=[],g_shareeautopushes=[],g_shareeautopushests=0,g_loglogins=!1,g_isadmin=!1,g_iscompanyadmin=!1,g_showcredmon=!1,g_launches=[],g_last_launch=[],ischrome=!0,g_icons=[],g_bigicons=[],g_icons_length=0,g_loggedinoffline=!1,g_loggedinonline=!1,g_shares=[],g_multifactorscore=0,g_disablepwalerts=-1,g_notification_type=null,g_notification_data=null,g_site_data=null,g_img_data=null,g_audio_data=null,g_formfill_data=
null,g_reprompt_callback=null,g_reprompt_error_callback=null,g_omnikey_callback=null,g_last_reprompt_time=0,g_premium_exp=0,g_enterpriseuser=0,g_lastpollcheck=0,g_lastpoll=0,g_logoff_other_ses=!1,g_generatedpw=!1,g_gblprefs=[],g_gblprefs_changed=[],g_userprefs=[],g_userprefs_changed=[],g_fillfieldsmatches=[],g_fillfieldsmatchescurridx=[],g_fillfield_confirm_perfield={},g_fillfield_did_fillbest={},g_currenturl="",g_currenttabid="",g_badgedata=null,g_saveall_url,g_saveall_framestotal,g_saveall_framesdone,
g_saveall_docnumsdone,g_saveall_formdata,g_saveall_tabid,g_saveall_done,g_genpws=[],g_lp_hotkeys="generateHk recheckHk searchHk nextHk prevHk homeHk submitHk saveallHk logoffHk defaultffidHk openpopoverHk".split(" "),g_generate_url="",g_generate_url_prev="",g_changepwnewpw="",g_changepwtld="",g_changepwexcludeid=0,g_curr_fill_aid=0,g_is_win="undefined"!=typeof navigator&&-1!=navigator.appVersion.indexOf("Windows"),g_is_mac="undefined"!=typeof navigator&&-1!=navigator.appVersion.indexOf("Mac"),g_is_linux=
"undefined"!=typeof navigator&&(-1!=navigator.appVersion.indexOf("Linux")||-1!=navigator.appVersion.indexOf("X11")),g_can_open_popover="undefined"!=typeof SafariExtensionPopover,g_retryonlinetimerid=null,g_notifytimerid=null,g_loggedLogins=[],g_master_password_saved=!1,g_create_account_data=null,g_nplastpass=null,g_loginstarted=!1,g_persistent_notifications=[],g_rejectedaddsites=[],g_checkgeneratepasswordcallback=null,g_db_transaction_tested=!1,g_db_transaction_worked=!1,g_events=[],g_offer_popupfill=
!1,do_experimental_popupfill=g_offer_popupfill=!0,g_popupfill_hint={},g_popupfill_hint_generate={},g_popupfill_hint_save={},g_popupfill_hint_type={},g_popupfill_last_active={},g_popupfill_last_active_fieldid={},g_popupfill_last_active_fieldtype={},g_popupfill_save_data={},g_popupfill_pw_challenge=null,g_is_selenium=!1,g_selenium_bits=-1,g_hidevault=!1,g_hideshowvault=!1,g_hidenotes=!1,g_hideidentities=!1,g_hideexport=!1,g_hideimport=!1,g_hidesharing=!1,g_hideprint=!1,g_hidecreate=!1,g_hidecreatepop=
!1,g_hideacctsettings=!1,g_nopoll=!1,g_norecovery=!1,g_nosharingkeys=!1,g_skiphttptest=!0,g_hidesearch=!1,g_hidehelptranslate=!1,g_hidesessions=!1,g_hideseccheck=!1,g_hidelogoffprefs=!1,g_hidescreenkeyboard=!1,g_hideabout=!1,g_hiderecheckpage=!1,g_hidecheckupdates=!1,g_hidegopremium=!1,g_hideappearancebox=!1,g_hiderecentlyusedlistsize=!1,g_helpurl=base_url+"help.php?fromwebsite=1",g_dopushserver=!0,g_checkiterationsreduction=!0,g_forgotpwurl=base_url+"forgot.php",g_vaulturloverride="",g_protect_plug2web=
!0,g_shownewloginoption=!0,g_hideopenfavs=!1,g_hidelicenselink=!1,g_hideaboutmanuallink=!1,g_showvaultdefault=0,g_showvaultalways=0,g_hidesaedhotkey=!1,g_hidemenubar=!1,g_showupgradenotes=!0,g_showhistorylinks=!0,g_useshortlang=!1,g_showweakdupalerts=!0,g_runchallenge=!0,g_skipurltest=!1,lppassusernamehash=!1,lpusername=null,lphash=null,lp_rsaprivatekeyhex="",lp_rsaprivatekeyenchex="",lp_rsaprivatekeyenchexserverhash="",g_privkeyattempts=0,g_selectedtabid=-1,g_selectedtab=null,g_export_output="",
g_editfieldsopener=null,g_currenttld=null,g_attachname="",g_attachbytes="",SpecialSites={},BigIconList=null,g_cachedffdat=null,g_didchangepw=[],g_plug2web_timeout=20,g_plug2web_last_initiated=0,g_wlan_works=!1,g_wlan_has_exe=!1;function lpobjrejectedaddsite(){}
var g_opera_button=null,g_firefox_button=null,g_firefox_login_panel=null,g_firefox_panel=null,g_firefox_preload_menu=!0,g_firefox_delay_menu_data=!0,g_firefox_button_clicked=!1,g_firefox_html_panel=null,g_firefox_html_dialog=null,g_username_vals=[],g_datacache=[],g_prefs_read=!1,g_manual_login=!1,g_pplastpass_loaded=!1,g_enable_full_menu=!0,g_popupforminput=[],g_popupform_active=[],g_popupform_active_choose=[],g_popupform_more_open=[],g_popupform_shownavbar=[],g_show_save_success_msg=!0,g_popup_tabid_save=
null,g_popup_tab_docnum=[],g_popup_url_by_tabid=[],g_iframe_hack_src=[],g_flags={},g_basicauth_timer_started=!1,g_onload_started=!1,g_pending_launch=null,pass=!0,g_show_pw_in_logs=!1,g_innerHTML_debug=!1,g_robots_txt=!1,g_skip_ad_frames=!0,g_pending_pw_change={},g_fennec_menu_id=null,g_sharing_enabled=!0,g_folder_sharing_enabled=!0,g_generate_pw_pattern_hints={},g_queeg_mode=!1,g_legacy_enabled=!1,g_enable_checkpoint=!1,g_lp_model=1,g_trial_available=!1,g_is_recovery_login=!1,HUMANIZE_DELAY_QUANTUM=
401,g_last_ui_warning=0;g_have_native_messaging_permission=g_open_native_messaging_html=!1;!have_nplastpass()&&(supports_native_messaging()&&"undefined"!=typeof g_do_native_messaging&&g_do_native_messaging)&&test_native_messaging(function(a){"undefined"==typeof a?g_do_native_messaging=!1:a?(g_have_native_messaging_permission=!0,connect_native_messaging()):g_open_native_messaging_html=!0});
function migrate_from_old_firefox(){if(g_isfirefoxsdk&&!localStorage.getItem("migrated_from_old_firefox")){for(var a={},b={offerGeneratePasswd:"showGenerateNotifications",showChangePasswordNotifications:"showChangeNotificationBar",showFillNotifications:"showFillNotificationBar",showHomepageAfterLogin:"showvault",StoreLostPWOTP:"storeLostOTP",genpw_showadv:"generate_advanced",genpw_passlen:"generate_length",genpw_upper:"generate_upper",genpw_lower:"generate_lower",genpw_digits:"generate_digits",genpw_special:"generate_special",
genpw_mindigits:"generate_mindigits",genpw_ambig:"generate_ambig",genpw_reqevery:"generate_reqevery",genpw_pronounceable:"generate_pronounceable"},d=g_preferences_service.keys("extensions.lastpass"),c="REPLACE INTO LastPassPreferences (username_hash, prefname, prefvalue) VALUES ",e="",f=[],g=0,h="",k="",l={},j={},q={},n={},m={},u={},y={},B={},r={},p={},v={},t={},A=!1,C=-1,w=0;w<d.length;w++){var x=d[w].split(".");if(3<=x.length){var s,z=g_preferences_service.get(d[w]);4<=x.length?(s=x[2],a[s]=1,x=
x[3]):(s="",x=x[2]);if(""==s)if("loginusers"==x){h=z;continue}else if("loginpws"==x){k=z;continue}if("pageOpenSameTab"==x)l[s]=z;else if("pageOpenTab"==x)j[s]=z;else if("idleLogoff"==x)q[s]=z;else if("idleLogoffVal"==x)n[s]=z;else if("autoauto"==x)m[s]=z;else if("autoautoVal"==x)u[s]=z;else if("pollServer"==x)y[s]=z;else if("pollServerVal"==x)B[s]=z;else if("clearClipboard"==x)r[s]=z;else if("clearClipboardSecsVal"==x)p[s]=z;else if("recentUsed"==x)v[s]=z;else if("recentUsedCount"==x)t[s]=z;else if("logOffWhenCloseBrowser"==
x)z&&(A=!0);else if("logOffWhenCloseBrowserVal"==x){if(-1==C||z<C)C=z}else"undefined"!=typeof b[x]&&(x=b[x]),"lastpollcheck"==x&&(z*=1E3),c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push(x),f.push(z),g++}}for(s in l)l[s]?(c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push("openpref"),f.push("same"),g++):"undefined"!=typeof j[s]&&(c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push("openpref"),f.push(j[s]?"tabs":"windows"),g++);for(s in q)c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push("idleLogoffVal"),f.push(q[s]&&"undefined"!=typeof n[s]?
n[s]:0),g++;for(s in m)c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push("autoautoVal"),f.push(m[s]&&"undefined"!=typeof u[s]?u[s]:0),g++;for(s in y)c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push("pollServerVal"),f.push(y[s]&&"undefined"!=typeof B[s]?B[s]:0),g++;for(s in r)c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push("clearClipboardSecsVal"),f.push(r[s]&&"undefined"!=typeof p[s]?p[s]:0),g++;for(s in v)c+=e+"(?, ?, ?)",e=", ",f.push(s),f.push("recentUsedCount"),f.push(v[s]&&"undefined"!=typeof t[s]?t[s]:0),g++;A&&(c+=
e+"(?, ?, ?)",e=", ",f.push(""),f.push("logoffWhenCloseBrowser"),f.push(!0),g++,c+=e+"(?, ?, ?)",e=", ",f.push(""),f.push("logoffWhenCloseBrowserVal"),f.push(C),g++);if(0<g&&(w=opendb(),createPrefsTable(w),w))if(g_indexeddb){b=w.transaction("LastPassPreferences","readwrite").objectStore("LastPassPreferences");for(w=0;w<f.length;w+=3)b.put({username_hash:f[w],prefname:f[w+1],prefvalue:f[w+2],userkey:f[w]+"_"+f[w+1]})}else w.transaction(function(a){a.executeSql(c,f,function(){},function(a,b){console_log(b)})});
""!=h&&unprotect_data(k,!1,function(b){var c={};if(""!=b){b=b.split("|");for(var d=0;d<b.length;d++){var e=b[d].split("=");if(2==e.length){var f=decodeURIComponent(e[0]);c[f]=lpdec(decodeURIComponent(e[1]),AES.hex2bin(SHA256(f)))}}}var g="REPLACE INTO LastPassSavedLogins2 (username, password, last_login, protected) VALUES ";b="";var k=[],e=0;h=h.split("|");for(d=0;d<h.length;d++){f=decodeURIComponent(h[d]);a[SHA256(f)]=1;var l="undefined"!=typeof c[f]?c[f]:"",j="";protect_data(l,!1,f,function(a){j=
a});var m=j!=l?1:0;!m&&""!=l&&(j=lpenc(j,AES.hex2bin(SHA256(f))),m=2);g+=b+"(?, ?, ?, ?)";b=", ";k.push(f);k.push(j);k.push(0==d?(new Date).getTime():0);k.push(m);e++}if(0<e&&(d=opendb(),createSavedLoginsTable(d),d))if(g_indexeddb){c=d.transaction("LastPassSavedLogins2","readwrite").objectStore("LastPassSavedLogins2");for(d=0;d<k.length;d+=4)c.put({username:k[d],password:k[d+1],last_login:k[d+2],"protected":k[d+3]})}else d.transaction(function(a){a.executeSql(g,k,function(){},function(a,b){console_log(b)})})});
var c="REPLACE INTO LastPassData (username_hash, type, data) VALUES ",e="",f=[],g=0,D;for(D in a){var E="";call_binary_function("read_file",D+"_lpall.slps",function(a){""!=a&&unprotect_data(a,!0,function(a){E=a})});""!=E&&(c+=e+"(?, ?, ?)",e=", ",f.push(D),f.push("key"),f.push(E),g++)}if(0<g&&(w=opendb(),createDataTable(w),w))if(g_indexeddb){b=w.transaction("LastPassData","readwrite").objectStore("LastPassData");for(w=0;w<f.length;w+=3)b.put({username_hash:f[w],type:f[w+1],data:f[w+2],usertype:f[w]+
"_"+f[w+1]})}else w.transaction(function(a){a.executeSql(c,f,function(){},function(a,b){console_log(b)})});localStorage_setItem("migrated_from_old_firefox",1)}}function setup_wlan_variables(){(g_is_win||g_is_mac)&&have_binary_function("wlan_works")?call_binary_function("wlan_works",function(a){g_wlan_works=a}):g_wlan_works=!1;!g_is_win||!have_binary_function("wlan_has_exe")?g_wlan_has_exe=!0:call_binary_function("wlan_has_exe",function(a){g_wlan_has_exe=a})}
function navigate_handler(a){if(a.target instanceof SafariBrowserTab){a=a.target;var b=gettabid(a);a.url&&(g_badgedata&&g_badgedata.type&&"alert"==g_badgedata.type&&g_badgedata.tabid&&g_badgedata.tabid==b)&&!compare_tlds(lp_gettld_url(a.url),g_badgedata.tld)&&(g_badgedata=null,drawIconAtRotation(0))}}function command_handler(a){"LPToolButtonClick"==a.command?buttonclick():"LPContextMenuClick"==a.command&&cm_handler()}
function buttonclick(){if(!lploggedin&&(!g_badgedata||"notification"!=g_badgedata.cmd||"error"!=g_badgedata.type))open_login();else if(g_isfirefoxsdk)g_firefox_button_clicked=!0,g_firefox_panel.port.emit("message",{messagetype:"runonload"});else{try{if("undefined"!=typeof SafariExtensionPopover){openpopover(0);return}}catch(a){g_can_open_popover=!1}update_menus();toggle_menu()}}var g_popoverstartpage=0;
function openpopover(a){for(var b=safari.application.activeBrowserWindow,d=0;d<safari.extension.toolbarItems.length;d++){var c=safari.extension.toolbarItems[d];if(b==c.browserWindow&&-1!=c.identifier.indexOf("LPToolButton")){if(g_badgedata&&"notification"==g_badgedata.cmd&&("alert"==g_badgedata.type||"lpalert"==g_badgedata.type||"error"==g_badgedata.type))c.popover.width="lpalert"==g_badgedata.type?500:360,c.popover.height=348,c.popover.contentWindow.menuload(0),c.popover.contentWindow.showwin(460,
248,getchromeurl("lp_toolstrip.html?browseraction=1&alert=1")),setTimeout(function(){var a=getBG();a.g_badgedata=null;a.drawIconAtRotation()},500);else if(VaultToggle.useVault4_0()){if(c.popover){var e=c.popover.identifier;c.popover=null;safari.extension.removePopover(e)}c.popover=safari.extension.createPopover("extensionDropdown",safari.extension.baseURI+"extensionDropdown.html")}else c.popover.width=400,c.popover.height=497,c.popover.contentWindow.showwin(c.popover.width,c.popover.height,getchromeurl("lp_toolstrip.html?browseraction=1"+
(3==a?"&generate=1":"")));c.showPopover();g_popoverstartpage=a}}}function gettabid(a){if(g_ischrome||g_ismaxthon||g_isfirefoxsdk||g_iscasper)return a?a.id:-1;if(g_issafari)return"undefined"==typeof a.myData&&(a.myData=g_nexttabid++,g_CS_tabs[a.myData]=a),a.myData;if(g_isopera){for(var b in g_CS_tabs)if(gettaburl(g_CS_tabs[b])==gettaburl(a))return b;b=g_nexttabid++;g_CS_tabs[b]=a;return b}}
function get_all_windows(a,b){g_ischrome?chrome.windows.getAll(a,b):g_issafari?b(safari.application.browserWindows):g_isopera?b(opera.extension.windows.getAll()):g_ismaxthon?b([window.external.mxGetRuntime().create("mx.browser")]):g_isfirefoxsdk&&b(g_windows.browserWindows)}function get_tabs(a){try{if(g_isopera&&"undefined"==typeof a.tabs.length)return a.tabs.getAll();if(g_ismaxthon){for(var b=[],d=0;d<a.tabs.length;d++)b.push(a.tabs.getTab(d));return b}return a.tabs}catch(c){return[]}}
function get_tabs_length(a){try{return get_tabs(a).length}catch(b){return 0}}function close_tab(a){get_all_windows({populate:!0},function(b){var d=!1;1==b.length&&(1==get_tabs_length(b[0])&&gettabid(get_tabs(b[0])[0])==gettabid(a))&&(openURL(g_isopera?"about:blank":"about:newtab"),d=!0);if(g_ischrome)try{chrome.tabs.remove(gettabid(a))}catch(c){console_error(c)}else if(g_issafari||g_isopera||g_ismaxthon||g_isfirefoxsdk)d?setTimeout(function(){a.close()},0):a.close()})}
function cleanup_tabs(){if(g_issafari)for(var a in g_CS){delete_cs_for_tab(a);for(var b in g_CS[a]){if("undefined"==typeof g_CS[a][b].browserWindow||!g_CS[a][b].browserWindow)delete g_CS[a],"undefined"!=typeof g_CS_tabs[a]&&delete g_CS_tabs[a];break}}}
function message_handler(a){if(g_isopera)a.message=a.data,a.name=a.data.messagetype;else if(g_ismaxthon||g_isfirefoxsdk)a.message=JSON.parse(JSON.stringify(a)),a.name=a.messagetype;var b=!1;if("undefined"!=typeof a.message.g_user_prefs_to_write){var b=!0,d=LPJSON.parse(a.message.g_user_prefs_to_write),c;for(c in d)lpPutUserPref(c,d[c])}if("undefined"!=typeof a.message.g_global_prefs_to_write)for(c in b=!0,d=LPJSON.parse(a.message.g_global_prefs_to_write),d)lpPutGblPref(c,d[c]);b&&lpWriteAllPrefs();
switch(a.name){case "repromptSuccess":repromptSuccess();break;case "closepop":closePop();break;case "connect":connect_eventHandler(a);break;case "focus":var e=lp_gettld_url(gettaburl(a.message));compare_tlds(e,g_currenttld)||(update_menus(),g_currenttld=e);break;case "message":receiveCS(gettabidfromevent(a),a.message,0,{tab:geteventtarget(a)});break;case "processCS":e=LPJSON.parse(a.message.data);e.callback=function(b){event_dispatch_message(a,"website_event_callback",{data:LPJSON.stringify(b)})};
processCS(null,e,null);break;case "disablepasswordmanager":disablepasswordmanager(a.message.disable);break;case "LP_do_login":g_manual_login=a.message.manual_login;LP_do_login(a.message.u,a.message.p,a.message.rememberemail,a.message.rememberpassword,a.message.donotclearmultifactor,a.message.showvault,a.message.lpkey,a.message.lphash);break;case "openURL":"undefined"!=typeof a.message.g_site_data&&(g_site_data=LPJSON.parse(a.message.g_site_data),(e=get_record(get_record_id(g_site_data)))&&(g_site_data.fields=
e.fields));openURL(a.message.url);break;case "start_trial":start_trial();break;case "install_binary":install_binary();break;case "reprompt_callback":g_isfirefoxsdk&&closecurrenttab("login.html");setTimeout(function(){set_last_reprompt_time();g_reprompt_callback_save()},0);break;case "reprompt_error_callback":g_reprompt_error_callback_save();break;case "omnikey_callback":g_omnikey_callback_save(a.message.pin);break;case "update_prefs":"prefs"==a.message.page?(lpGetPref("storeLostOTP")||DeleteOTP(),
lpdbg("idle","updating prefs, idleLogoffVal is "+lpGetPref("idleLogoffVal")),(lpGetPref("logoffWhenCloseBrowser")||0<lpGetPref("idleLogoffVal"))&&0==lpGetPref("rememberpassword")&&deletesavedpw(g_username),start_idle_checker(),setprefs("all","all"),setup_hotkeys(),g_isfirefoxsdk&&1==lpGetPref("disablecrpw")&&g_preferences_service.set("signon.rememberSignons",!1),drawIconAtRotation(0)):"generate"==a.message.page&&(g_genpws=a.message.g_genpws);break;case "copytoclipboard":copytoclipboard(a.message.g_data);
break;case "update_prompts":g_prompts=LPJSON.parse(a.message.g_prompts);break;case "openall":openall(a.message.group);break;case "deleteGroup":deleteGroup(a.message.group,null,function(){event_dispatch_message(a,"delete_group_callback",{})});break;case "copyusername":var e="undefined"!=typeof a.message.fromiframe&&a.message.fromiframe?1:0,f=gettabidfromevent(a);copyusername(a.message.aid,e,f);break;case "copypassword":e="undefined"!=typeof a.message.fromiframe&&a.message.fromiframe?1:0;f=gettabidfromevent(a);
copypassword(a.message.aid,null,e,f);break;case "copyurl":e="undefined"!=typeof a.message.fromiframe&&a.message.fromiframe?1:0;f=gettabidfromevent(a);copyurl(a.message.aid,e,f);break;case "copynote":copynote(a.message.aid);break;case "deleteAid":g_isfirefoxsdk&&g_firefox_button.state("window",{checked:!1});deleteAid(a.message.aid,null,!1,!1,function(){event_dispatch_message(a,"delete_aid_callback",{})});break;case "editAid":editAid(a.message.aid,null,null,a.message.openchpw);break;case "unlock_plug2web":unlock_plug2web();
break;case "gotourl":gotourl(a.message.aid);break;case "launch":setTimeout(function(){launch(a.message.aid)},0);break;case "open_login":open_login(a.message.forcetab);break;case "addprofile":addprofile();break;case "update_create_account_data":g_create_account_data=LPJSON.parse(a.message.create_account_data);break;case "addcreditcard":addcreditcard();break;case "editprofile":editprofile(a.message.ffid);break;case "openprefs":openprefs(a.message.tab);break;case "openbaseurl":openbaseurl(a.message.suffix);
break;case "changemasterpassword":changemasterpassword();break;case "openaddsecurenote":openaddsecurenote();break;case "loggedOut":loggedOut(a.message.skiprequest,a.message.from);break;case "switch_identity":switch_identity(a.message.iid);break;case "renameGroup":renameGroup(a.message.origgrp,a.message.newgrp);break;case "addEmptyGroup":addEmptyGroup(a.message.newgrp);break;case "moveSelectedToGroup":moveSelectedToGroup(a.message.group,a.message.aids);break;case "security_prompt":security_prompt(function(){event_dispatch_message(a,
"security_prompt_callback",{})});break;case "savePassword":f=null==a.message.tabid?gettabidfromevent(a):a.message.tabid;savePassword(a.message.pass,a.message.url,f,null==a.message.nofill?!1:a.message.nofill);break;case "checkgeneratepassword":g_checkgeneratepasswordcallback=function(){event_dispatch_message(a,"generatepasswordfound",{})};sendCS(a.message.tabid,{cmd:"checkgeneratepassword"});break;case "fillform":fillform(a.message.ffid,!1,a.message.origtabid,a.message.ccffid);break;case "changePassword":changePassword(a.message.password,
a.message.aids);break;case "receiveTS":receiveTS(null,a.message);break;case "deleteformfill":e="undefined"!=typeof a.message.fromiframe&&a.message.fromiframe?1:0;f=gettabidfromevent(a);deleteformfill(a.message.ffid,null,e,f);break;case "addeditformfill":addeditformfill(LPJSON.parse(a.message.ffdata),LPJSON.parse(a.message.site));break;case "fix_tlds":fix_tlds(a.message.oldtld,a.message.newtld,a.message.aid);break;case "moveIntoSharedFolder":moveIntoSharedFolder(LPJSON.parse(a.message.shareinfo),LPJSON.parse(a.message.shareinfoorig),
LPJSON.parse(a.message.aidsThatChangedGroups),LPJSON.parse(a.message.aidsnewgrps),a.message.copy,a.message.onlycheck,a.message.skipcheck);break;case "increment_local_accts_version":increment_local_accts_version();break;case "rewritelocalfile":rewritelocalfile();break;case "saveSite":saveSite(a.message.postdata,fix_fields(LPJSON.parse(a.message.acct)));break;case "showImageAttach":showImageAttach(a.message.data);break;case "openAttach":openAttach(a.message.id,a.message.attachid,a.message.filename);
break;case "exportAttachment":exportAttachment(a.message.id,a.message.attachid,a.message.filename);break;case "openLinkedSites":openLinkedSites(a.message.password,a.message.tld,a.message.excludeid);break;case "generate":opengenpw();break;case "ping_ack":case "basicauthmoreinfobtn":case "basicauthneverbtn":case "changepw":case "chooseprofilecc":case "createaccountbtn":case "custombtn":case "disablebtn":case "feedbackbtn":case "starttrialbtn":case "fillformffid":case "popupfillresize":case "recheckpagecontext":case "savesiteicon":case "savethesite":case "startsaveall":case "tryagainbtn":f=
gettabidfromevent(a);processCS(f,a.message);break;case "saveAllSite":saveAllSite(a.message.postdata,fix_fields(LPJSON.parse(a.message.acct)));break;case "saveSiteFromSubmit":saveSiteFromSubmit(a.message.postdata,fix_fields(LPJSON.parse(a.message.acct)));break;case "saveFields":saveFields(a.message.getdata,a.message.postdata,fix_fields(LPJSON.parse(a.message.aData)));break;case "set_editfieldsopener":set_editfieldsopener(geteventtarget(a));break;case "close_editfieldsopener":close_editfieldsopener();
break;case "unprotect_data":unprotect_data(a.message.data,a.message.windowsonly,function(b){event_dispatch_message(a,"unprotect_data_callback",{protected_data:a.message.data,unprotected_data:b})});break;case "change_master_password":event_dispatch_message(a,"change_master_password_callback",{newdata:change_master_password(a.message.newusername,a.message.newpassword,a.message.toserver)});break;case "make_lp_key_hash_iterations":make_lp_key_hash_iterations(a.message.u,a.message.p,get_key_iterations(a.message.u),
function(b,c){event_dispatch_message(a,"make_lp_key_hash_iterations_callback",{lpkey:b,lphash:c})});break;case "lpvt_store_data_and_setsinglefactortype":lpvt_store_data_and_setsinglefactortype(a.message.data);break;case "delete_file":delete_file(a.message.f);break;case "lpevent":lpevent(a.message.w);break;case "applyattacharraychanges":e=LPJSON.parse(a.message.changes);applyattacharraychanges(e);break;case "update_site":e=fix_fields(LPJSON.parse(a.message.site));is_application(e)?g_applications[e.appaid]=
e:e.sn?g_securenotes[e.aid]=e:g_sites[e.aid]=e;break;case "fastDecryptAttachment":fastDecryptAttachment(a.message.id,a.message.mimetype,a.message.data,a.message.attachkey,a.message.key,function(b){event_dispatch_message(a,"fast_decryptatt_callback",{result:b,id:a.message.id,mimetype:a.message.mimetype})});break;case "fastEncryptAttachments":fastEncryptAttachments(a.message.akey,LPJSON.parse(a.message.attachments),function(b){event_dispatch_message(a,"fast_encryptatt_callback",{data:LPJSON.stringify(b)})});
break;case "get_saved_logins":get_saved_logins(function(b){event_dispatch_message(a,"get_saved_logins_callback",{rows:b})});break;case "delete_saved_login":delete_saved_login(a.message.username);break;case "update_fields":g_sites[a.message.aid].fields=LPJSON.parse(a.message.fields);g_sites[a.message.aid]=fix_fields(g_sites[a.message.aid]);break;case "select_selectedtabid":select_selectedtabid();break;case "closecurrenttab":closecurrenttab(a.message.page);break;case "add_identity":add_identity();break;
case "checkforupdates":checkforupdates();break;case "clearforms":clearforms();break;case "clearrecent":clearrecent();break;case "openabout":openabout();break;case "openaddsite":openaddsite();break;case "openchooseprofilecc":openchooseprofilecc();break;case "openexport":openexport();break;case "openfavorites":openfavorites();break;case "openfeedback":openfeedback();break;case "opengenpw":opengenpw();break;case "openhelp":openhelp();break;case "openimport":openimport();break;case "doimport":doimport(a.message.source,
a.message.filename);break;case "openimportchrome":openimportchrome();break;case "openlastpassexport":openlastpassexport();break;case "wlanexport":wlanexport();break;case "formfillexport":formfillexport();break;case "openpremium":openpremium();break;case "openentconsole":openentconsole();break;case "opensearch":opensearch();break;case "openseccheck":openseccheck();break;case "opensessions":opensessions();break;case "openmyaccount":openmyaccount();break;case "openvault":openvault();break;case "recheckpage":recheckpage();
break;case "refreshsites":refreshsites();break;case "saveall":saveall();break;case "upgradetoserver":upgradetoserver();break;case "clearCache":clearCache(a.message.noprompt);break;case "loglogin":loglogin(a.message.aid);break;case "deleteNever":deleteNever(LPJSON.parse(a.message.n));break;case "fillaid":fillaid(a.message.aid);break;case "openprint":openprint(a.message.notes);break;case "getnotificationdata":f=gettabidfromevent(a);"undefined"!=typeof g_datacache[f]&&sendCS(f,{cmd:"gotnotificationdata",
html:g_datacache[f].html,extra:g_datacache[f].extra},"all");break;case "getcpwmsg":f=gettabidfromevent(a);CPWbot_bg&&sendCS(f,{cmd:"gotcpwmsg",msg:CPWbot_bg.get_last_overlay_message(),minimize_state:cpwbot_get_minimize_dialog_state()},"all");break;case "closepopupfills":case "hidecontext":case "hideoverlay":case "slidedownoverlay":case "slideupoverlay":f=gettabidfromevent(a);sendCS(f,{cmd:a.name},"all");"hideoverlay"==a.name&&(g_persistent_notifications[f]=null,clear_badge());break;case "popupfillscreateack":f=
gettabidfromevent(a);sendCS(f,{cmd:a.name},"all");null!=typeof g_popup_tab_docnum[f]?sendCS(f,{cmd:a.name},g_popup_tab_docnum[f]):sendCS(f,{cmd:a.name},"all");has_popup_heartbeat(f)||(do_popup_heartbeat(f),popup_heartbeat_fn(f));break;case "autofillaid":case "autologinaid":f=gettabidfromevent(a);a.message.topurl=geteventtargeturl(a);handleFill(f,a.message);break;case "fillcurrentaid":fillcurrent(a.message.aid);break;case "never":case "neverautofill":case "neverpage":case "neverdomain":f=gettabidfromevent(a);
e=a.message.url;handleNever(f,a.message);"undefined"!=typeof a.message.fromsave&&(g_persistent_notifications[f]=null,clear_badge());if(do_experimental_popupfill&&(hasNeverAutologin(e,lp_gettld_url(e))||hasNeverFormFill(e,lp_gettld_url(e))||hasNeverGenerate(e,lp_gettld_url(e))||hasNeverShowIcon(e,lp_gettld_url(e))||hasNeverSave(e,lp_gettld_url(e))))handleGetNevers(f,e),closeclickables(f),g_popupform_active[f]=0,g_popupform_active_choose[f]=0,recheckpage(!0);break;case "getdata":getdata_eventHandler(a);
break;case "getpopupfillsites":alertfrombg("THIS WAS SUPPOSED TO BE UNUSED 1");break;case "getpopupfillforms":alertfrombg("THIS WAS SUPPOSED TO BE UNUSED 2");break;case "getpopupfilldata":do_experimental_popupfill&&(f=gettabidfromevent(a),"undefined"!=typeof g_datacache[f]&&(e=cobble_popup_iframe_data(f),sendCS(f,e,"all")));break;case "popupfillinputget":do_experimental_popupfill&&(f=gettabidfromevent(a),"undefined"==typeof g_popupform_active[f]&&(g_popupform_active[f]=0),"undefined"==typeof g_popupform_active_choose[f]&&
(g_popupform_active_choose[f]=0),"undefined"!=typeof g_popupforminput[f]&&(sendCS(f,{cmd:"gotpopupfillinput",inputstr:g_popupforminput[f].value,inputid:g_popupforminput[f].id,active:g_popupform_active[f],choose:g_popupform_active_choose[f],moreopen:g_popupform_more_open[f],issaveall:g_popupforminput[f].issaveall,inputtype:g_popupforminput[f].inputtype,shownavbar:g_popupform_shownavbar[f]},"all"),g_popupform_active[f]=0,g_popupform_active_choose[f]=0,g_popupform_more_open[f]=0,g_popupform_shownavbar[f]=
0));break;case "popupfillgetgenerateprefs":if(do_experimental_popupfill){var e=LPJSON.stringify({generate_advanced:parseInt(lpGetPref("generate_advanced",0)),generate_length:parseInt(lpGetPref("generate_length",12)),generate_upper:parseInt(lpGetPref("generate_upper",1)),generate_lower:parseInt(lpGetPref("generate_lower",1)),generate_digits:parseInt(lpGetPref("generate_digits",1)),generate_special:parseInt(lpGetPref("generate_special",0)),generate_mindigits:parseInt(lpGetPref("generate_mindigits",
1)),generate_ambig:parseInt(lpGetPref("generate_ambig",0)),generate_reqevery:parseInt(lpGetPref("generate_reqevery",1)),generate_pronounceable:parseInt(lpGetPref("generate_pronounceable",0))}),g=LPJSON.stringify(g_genpws),f=gettabidfromevent(a);(b=g_generate_pw_pattern_hints[f])||(b="");b=LPJSON.stringify(b);sendCS(f,{cmd:"gotpopupfillgenerateprefs",prefstr:e,genpwstr:g,genpwpattern:b},"all")}break;case "popupfillsetgenerateprefs":if(do_experimental_popupfill){e=LPJSON.parse(a.message.prefstr);lpPutUserPref("generate_advanced",
parseInt(e.generate_advanced));lpPutUserPref("generate_length",parseInt(e.generate_length));lpPutUserPref("generate_upper",parseInt(e.generate_upper));lpPutUserPref("generate_lower",parseInt(e.generate_lower));lpPutUserPref("generate_digits",parseInt(e.generate_digits));lpPutUserPref("generate_special",parseInt(e.generate_special));lpPutUserPref("generate_mindigits",parseInt(e.generate_mindigits));lpPutUserPref("generate_ambig",parseInt(e.generate_ambig));lpPutUserPref("generate_reqevery",parseInt(e.generate_reqevery));
lpPutUserPref("generate_pronounceable",parseInt(e.generate_pronounceable));if("undefined"!=typeof a.message.genpwstr&&(e=LPJSON.parse(a.message.genpwstr),null!=e&&!isEmptyObject(e)))for(g in g_genpws=[],e)e.hasOwnProperty(g)&&g_genpws.push(e[g]);lpWriteAllPrefs()}break;case "deleteaid":e="undefined"!=typeof a.message.fromiframe&&a.message.fromiframe?1:0;f=gettabidfromevent(a);do_experimental_popupfill&&deleteAid(a.message.aid,null,!1,!0,function(){recheckpage(!0)},null,e,f);break;case "editaid":editAid(a.message.aid);
break;case "openchooseprofilecc":openchooseprofilecc();break;case "dosaveiframe":f=gettabidfromevent(a);g=savesite_from_iframe(a.message,f);break;case "popupfillsaveget":if(do_experimental_popupfill){g=g_popupfill_save_data;if(g.formdata2){b=[];for(e in g_sites)check_ident_aid(e)&&(c=g_sites[e].group,""!=c&&!lp_in_array(c,b)&&(b[b.length]=c));b.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1});g.groups=b;"undefined"!=typeof a.message.url&&(g.group=get_default_group(a.message.url))}else"undefined"==
typeof g.close&&g_prompts.view_pw_prompt&&(g.prompting=!0);f=gettabidfromevent(a);g.cmd="gotpopupfillsave";sendCS(f,g,"all");g_popupfill_save_data={}}break;case "dologinaction":lploggedin||open_login();break;case "dopwchallenge":f=gettabidfromevent(a);security_prompt(function(){sendCS(f,{cmd:"didpwchallenge",result:1},"all")},function(){sendCS(f,{cmd:"didpwchallenge",result:0},"all")},!1);break;case "set_share_folder_id":set_share_folder_id(a.message.id);break;case "set_share_folder_group":set_share_folder_group(a.message.group);
break;case "lpdbg":lpdbg(a.message.type,a.message.string);break;case "cpwbot_finish_ack":g_cpwbot&&CPWbot_bg&&(f=gettabidfromevent(a),CPWbot_bg.cpwbot_finish_ack_handler(f,a.message));break;case "cpwbot_validate_state_result":g_cpwbot&&CPWbot_bg&&(f=gettabidfromevent(a),CPWbot_bg.cpwbot_validate_state_result_handler(f,a.message));break;case "dopwchange":gettabidfromevent(a);e=geteventtarget(a);dopwchange(a.message.aid,!1,e);break;case "cpwbot_get_user_debug_messages":g_cpwbot&&CPWbot_bg&&(f=gettabidfromevent(a),
e=cpwbot_get_user_debug_messages(),e=LPJSON.stringify(e),event_dispatch_message(a,"cpwbot_got_user_debug_messages",{value:e}));break;case "cpwbot_getpwchangestate":f=gettabidfromevent(a);e=cpwbot_getpwchangestate();e=LPJSON.stringify(e);event_dispatch_message(a,"cpwbot_gotpwchangestate",{value:e});break;case "cpwbot_get_dialog_msg":g_cpwbot&&CPWbot_bg&&(f=gettabidfromevent(a),e=cpwbot_get_dialog_msg(),e=LPJSON.stringify(e),event_dispatch_message(a,"cpwbot_got_dialog_msg",{value:e}));break;case "cpwbot_preinit":g_cpwbot&&
CPWbot_bg&&cpwbot_preinit();break;case "cpwbot_halt":g_cpwbot&&CPWbot_bg&&cpwbot_halt();break;case "close_cpw_tabs":g_cpwbot&&CPWbot_bg&&(e=geteventtarget(a),cpwbot_close_cpw_tab_handler(e));break;case "send_sms_passcodes":send_sms_passcodes(a.message.postdata);break;case "create_account":create_account(a.message.postdata,function(b){event_dispatch_message(a,"create_account_success_callback",{req:{readyState:b.readyState,status:b.status,responseText:b.responseText}})},function(){event_dispatch_message(a,
"create_account_failure_callback",{})});break;case "enable_credit_monitoring":enable_credit_monitoring(a.message.postdata,function(b){event_dispatch_message(a,"enable_credit_monitoring_success_callback",{req:{readyState:b.readyState,status:b.status,responseText:b.responseText}})},function(){event_dispatch_message(a,"enable_credit_monitoring_failure_callback",{})});break;case "clear_badge":clear_badge();break;case "resize_panel":g_firefox_panel&&g_firefox_panel.resize(a.message.width,a.message.height);
break;case "resize_login_panel":g_firefox_login_panel&&g_firefox_login_panel.resize(a.message.width,a.message.height);break;case "resize_html_panel":g_firefox_html_panel&&g_firefox_html_panel.resize(a.message.width,a.message.height);break;case "resize_html_dialog":g_firefox_html_dialog&&(g_firefox_html_dialog.resizeTo(a.message.width,a.message.height),g_firefox_html_dialog.moveTo(g_firefox_html_dialog.screen.left+(g_firefox_html_dialog.screen.width-a.message.width)/2,g_firefox_html_dialog.screen.top+
(g_firefox_html_dialog.screen.height-a.message.height)/2));break;case "deletesavedpw":deletesavedpw(a.message.username);break;case "sr_add_secret":SecureReprompter.add_secret(a.message.aid,a.message.acct,a.message.t,a.message.hash);break;case "minimize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=1);break;case "maximize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=0);break;case "addAttach":addAttach(function(){event_dispatch_message(a,"addattachcb",
{attachname:g_attachname,attachbytes:g_attachbytes});g_attachname=g_attachbytes=""});break;case "onload_done":g_firefox_preload_menu&&g_firefox_button_clicked&&(g_firefox_panel.show({position:g_firefox_button}),g_firefox_button_clicked=!1);"undefined"!=typeof a.message.need_data&&a.message.need_data&&setTimeout(function(){var b={},c=[],d;for(d in g_sites)check_ident_aid(g_sites[d].aid)&&(c[d]=g_sites[d]);b.g_sites=LPJSON.stringify(c);c=[];for(d in g_securenotes)check_ident_aid(g_securenotes[d].aid)&&
(c[d]=g_securenotes[d]);b.g_securenotes=LPJSON.stringify(c);c=[];for(d in g_applications)check_ident_appaid(g_applications[d].appaid)&&(c[d]=g_applications[d]);b.g_applications=LPJSON.stringify(c);c=[];for(d=0;d<g_formfills.length;d++)check_ident_ffid(g_formfills[d].ffid)&&(c[c.length]=g_formfills[d]);b.g_formfills=LPJSON.stringify(c);event_dispatch_message(a,"data_callback",b)},200);break;case "rebuildcontextonload":rebuildcontextonload();break;case "setbadgetextonload":setbadgetextonload();break;
case "openlastpasslegacy":openlastpasslegacy();break;case "opendebugtab":is_user_debug_enabled()&&opendebugtab();break;case "reset_history":is_user_debug_enabled()&&reset_history()}}
function disablepasswordmanager(a){if(g_isfirefoxsdk||g_ischrome)lpPutGblPref("disableffpwasked",1),lpWriteAllPrefs(),a&&(g_isfirefoxsdk?g_preferences_service.set("signon.rememberSignons",!1):g_ischrome&&("undefined"!=typeof chrome.privacy&&"undefined"!=typeof chrome.privacy.services&&"undefined"!=typeof chrome.privacy.services.passwordSavingEnabled)&&chrome.privacy.services.passwordSavingEnabled.set({value:!1}))}var share_folder_id="";function set_share_folder_id(a){share_folder_id=a}
var share_folder_group="";function set_share_folder_group(a){share_folder_group=a}
function connect_eventHandler(a){var b=!1,d=!0,c=gettabidfromevent(a),e=a.message.docnum;"undefined"!=typeof a.message.top&&(b=a.message.top,d=!1);if(b||d&&a.message.name==geteventtargeturl(a))cleanup_tabs(),g_CS[c]=[],g_CS_count[c]=0,g_loggedLogins=[],b=!0,g_CS_tops[c]=e;if("undefined"==typeof g_CS[c]||!g_CS[c])g_CS[c]=[],g_CS_count[c]=0;g_CS[c][e]=g_isfirefoxsdk?a.worker:geteventtarget(a);register_new_cs(c,e,a.message.name,b,a.message.docstate,a.message.docflags);if(g_issafari){if(2<=g_CS_count[c]&&
("http://chat.major-design.ru/"==a.message.name||0<a.message.name.indexOf("facebook.com/ajax/"))){lpdbg("connect","skipping connect to document with tabcount="+g_CS_count[c]+", istop="+b+", url="+a.message.name);sendCS(c,{cmd:"remove_event_listener"},e);delete g_CS[c][e];return}lpdbg("connect","connecting to document with tabcount="+g_CS_count[c]+", istop="+b+", url="+a.message.name)}g_CS_count[c]++;d={cmd:"setdocnum",docnum:e};if("undefined"==typeof a.message.haslang||1!=a.message.haslang)if(g_issafari||
g_isopera)d.language_data=g_language_data;else if(g_ismaxthon||g_isfirefoxsdk)d.language_data="lptranslations={}",d.g_language=lpGetPref("language","");if(!b&&is_max_frames_exceeded(c,g_CS_count)||hasNeverEnableLP(a.message.name,lp_gettld_url(a.message.name)))L("set killswitch for tab:"+c+" url:"+a.message.name),d.killswitch=1,set_killswitch_value(c,e,d.killswitch);else if(!b&&g_skip_ad_frames&&skip_CS_by_score(c,e))console.warn("EXPERIMENT: skipping ads/rich content frame "+a.message.name),d.killswitch=
1,set_killswitch_value(c,e,d.killswitch);else{var f=lp_gettld_url(a.message.name),f=0<f.lastIndexOf(".")?f.substr(f.lastIndexOf(".")+1):"";d.tld=f;d.tlddata=LPJSON.stringify("undefined"==typeof lp_all_tlds[f]?[]:lp_all_tlds[f]);!do_experimental_popupfill&&0==lpGetPref("showNotificationsAfterClick",1)&&(d.ff=g_cachedffdat);set_killswitch_value(c,e,0)}sendCS(c,d,e);b?("undefined"!=typeof g_persistent_notifications[c]&&g_persistent_notifications[c]&&sendCS(c,g_persistent_notifications[c]),g_cpwbot&&
CPWbot_bg&&CPWbot_bg.score_topdoc(c,e,a.message.name)):"undefined"!=typeof g_persistent_notifications[c]&&(g_persistent_notifications[c]&&-1!=a.message.name.indexOf("streetscape.com"))&&setTimeout(function(){sendCS(c,g_persistent_notifications[c],"all")},10);!b&&is_max_frames_exceeded(c,g_CS_count)&&(g_issafari&&sendCS(c,{cmd:"remove_event_listener"},e),debug&&L("exceeded max frames on tabid "+c),delete g_CS[c][e])}
function getdata_eventHandler(a){var b={g_userprefsstr:LPJSON.stringify(g_userprefs),g_gblprefsstr:LPJSON.stringify(g_gblprefs),g_username:g_username,ischrome:ischrome,LPISLOC:LPISLOC,LPISUPEK:LPISUPEK,LPISUPEKCAPABLE:LPISUPEKCAPABLE,lp_iscbc:lp_iscbc,g_promptsstr:LPJSON.stringify(g_prompts),lploggedin:lploggedin,g_can_copy_to_clipboard:can_copy_to_clipboard(),g_can_clear_clipboard:can_clear_clipboard()};b.g_is_win=g_is_win;b.g_is_linux=g_is_linux;b.g_is_mac=g_is_mac;b.g_have_nplastpass=have_nplastpass();
b.g_have_native_messaging=have_native_messaging();b.g_have_pplastpass=have_pplastpass();b.g_have_ws=have_ws();b.g_isadmin=g_isadmin;b.g_iscompanyadmin=g_iscompanyadmin;b.g_showcredmon=g_showcredmon;b.g_premium_exp=g_premium_exp;b.base_url=base_url;b.g_hidevault=g_hidevault;b.g_hideshowvault=g_hideshowvault;b.g_hidenotes=g_hidenotes;b.g_hideidentities=g_hideidentities;b.g_hideexport=g_hideexport;b.g_hideimport=g_hideimport;b.g_hidesharing=g_hidesharing;b.g_hideprint=g_hideprint;b.g_hidecreate=g_hidecreate;
b.g_hideacctsettings=g_hideacctsettings;b.g_nopoll=g_nopoll;b.g_norecovery=g_norecovery;b.g_nosharingkeys=g_nosharingkeys;b.g_skiphttptest=g_skiphttptest;b.g_hidesearch=g_hidesearch;b.g_offer_popupfill=g_offer_popupfill;b.g_hidesessions=g_hidesessions;b.g_hideseccheck=g_hideseccheck;b.g_hidelogoffprefs=g_hidelogoffprefs;b.g_hidescreenkeyboard=g_hidescreenkeyboard;b.g_hideappearancebox=g_hideappearancebox;b.g_hiderecentlyusedlistsize=g_hiderecentlyusedlistsize;b.g_hidelicenselink=g_hidelicenselink;
b.g_hideaboutmanuallink=g_hideaboutmanuallink;b.g_hideabout=g_hideabout;b.g_hiderecheckpage=g_hiderecheckpage;b.g_hidecheckupdates=g_hidecheckupdates;b.g_hidegopremium=g_hidegopremium;b.g_shownewloginoption=g_shownewloginoption;b.g_hideopenfavs=g_hideopenfavs;b.g_showvaultdefault=g_showvaultdefault;b.g_showvaultalways=g_showvaultalways;b.g_hidesaedhotkey=g_hidesaedhotkey;b.g_key_iterations=get_key_iterations(g_username);b.g_cpwbot=g_cpwbot;b.g_chrome_url=getchromeurl("",!0);b.g_lp_model=g_lp_model;
g_isfirefoxsdk&&(b.remembersignons=g_preferences_service.get("signon.rememberSignons",!0));switch(a.message.page){case "about":b.g_nplastpass_version=get_nplastpass_version();b.g_nplastpass_build_date_time=get_nplastpass_build_date_time();b.g_native_messaging_version=g_native_messaging_version;b.g_native_messaging_build_date=g_native_messaging_build_date;b.g_native_messaging_build_time=g_native_messaging_build_time;b.g_issafari=g_issafari;break;case "import_other":b.g_wlan_works=g_wlan_works;b.g_wlan_has_exe=
g_wlan_has_exe;break;case "img":b.g_img_data=LPJSON.stringify(g_img_data);b.g_audio_data=LPJSON.stringify(g_audio_data);break;case "login":g_reprompt_callback&&(b.g_reprompt_callback="g_reprompt_callback",g_reprompt_callback_save=g_reprompt_callback,g_reprompt_callback=null,b.g_local_key=g_local_key,b.g_cached_hash=g_cached_hash,b.g_local_key_hex=g_local_key_hex,b.g_can_allow_reprompt_skip=!(g_prompts.company_login_site_prompt||g_prompts.company_copyview_site_prompt));g_reprompt_error_callback&&(b.g_reprompt_error_callback=
"g_reprompt_error_callback",g_reprompt_error_callback_save=g_reprompt_error_callback,g_reprompt_error_callback=null);b.g_forgotpwurl=g_forgotpwurl;b.lptoken=lptoken;var d=[],c;for(c in g_sites)check_ident_aid(g_sites[c].aid)&&(d[c]=g_sites[c]);b.g_sites=LPJSON.stringify(d);break;case "omnikey":g_omnikey_callback&&(b.g_omnikey_callback="g_omnikey_callback",g_omnikey_callback_save=g_omnikey_callback,g_omnikey_callback=null);break;case "export":b.g_export_output=g_export_output;g_export_output="";break;
case "attach":addAttach(function(){b.g_attachname=g_attachname;b.g_attachbytes=g_attachbytes;g_attachname=g_attachbytes=""});break;case "prefs":b.g_can_open_popover=g_can_open_popover;b.g_pref_tab=g_pref_tab;g_pref_tab=null;b.g_master_password_saved=g_master_password_saved;var e=[];for(c=0;c<g_formfills.length;c++)check_ident_ffid(g_formfills[c].ffid)&&(e[e.length]=g_formfills[c]);b.g_formfills=LPJSON.stringify(e);b.g_prefoverrides=LPJSON.stringify(g_prefoverrides);b.g_flags=LPJSON.stringify(g_flags);
b.g_opera_context=g_isopera&&opera.contexts.menu?!0:!1;b.g_firefoxsdk_context=g_isfirefoxsdk&&"undefined"!=typeof g_context_menu?!0:!1;b.lppassusernamehash=lppassusernamehash;break;case "vault":b.g_username=g_username;b.g_local_accts_version=g_local_accts_version;b.lploggedin=lploggedin;b.g_identity=g_identity;b.g_isadmin=g_isadmin;b.g_icons_length=g_icons_length;b.recentCount=getRecentCount();b.g_enterpriseuser=g_enterpriseuser;b.g_iscompanyadmin=g_iscompanyadmin;b.g_showcredmon=g_showcredmon;b.g_token=
g_token;b.g_sharing_enabled=g_sharing_enabled;b.g_folder_sharing_enabled=g_folder_sharing_enabled;if("undefined"==typeof a.message.g_username||g_username!=a.message.g_username||g_local_accts_version>a.message.g_local_accts_version||lploggedin!=a.message.lploggedin||g_identity!=a.message.g_identity||g_isadmin!=a.message.g_isadmin){b.g_hideidentities=g_hideidentities;b.g_identities=LPJSON.stringify(g_identities);d=[];for(c in g_sites)check_ident_aid(g_sites[c].aid)&&(d[c]=g_sites[c]);b.g_sites=LPJSON.stringify(d);
b.g_shares=LPJSON.stringify(g_shares);var f=[];for(c in g_securenotes)check_ident_aid(g_securenotes[c].aid)&&(f[c]=g_securenotes[c]);b.g_securenotes=LPJSON.stringify(f);f=[];for(c in g_applications)check_ident_appaid(g_applications[c].appaid)&&(f[c]=g_applications[c]);b.g_applications=LPJSON.stringify(f);e=[];for(c=0;c<g_formfills.length;c++)check_ident_ffid(g_formfills[c].ffid)&&(e[e.length]=g_formfills[c]);b.g_formfills=LPJSON.stringify(e);e=[];for(c=0;c<g_pendings.length;c++)check_ident_aid(g_pendings[c].aid)&&
(e[e.length]=g_pendings[c]);b.g_pendings=LPJSON.stringify(e);b.g_username_hash=g_username_hash;b.searchinnotes=get_searchNotesPref();b.lpclearrecent=lpclearrecent;b.g_icons_length=g_icons_length;b.clearRecentTime=getClearRecentTime();b.g_icons=LPJSON.stringify(g_icons);b.g_bigicons=LPJSON.stringify(g_bigicons);b.g_local_key=g_local_key;b.g_local_key_hex=g_local_key_hex;b.g_promptsstr=LPJSON.stringify(g_prompts);get_securityChallengeScore(function(c){b.securityChallengeScore=c;event_dispatch_message(a,
"gotdata",b)});return}break;case "toolstrip":case "toolstripchangepw":var g="undefined"!=typeof a.message.delay_data&&a.message.delay_data;b.g_shares=LPJSON.stringify(g_shares);b.sitepwlen=LP.sitepwlen;b.g_wlan_works=g_wlan_works;b.g_wlan_has_exe=g_wlan_has_exe;b.g_secret_cache=g_secret_cache;if("string"!=typeof g_generate_url||""==g_generate_url)g_generate_url=getcurrenturl();b.g_generate_url=g_generate_url;""!=g_generate_url&&(g_generate_url_prev=g_generate_url);g_generate_url="";b.allowmultifactortrust=
allowmultifactortrust;b.g_changepwnewpw=g_changepwnewpw;b.g_changepwtld=g_changepwtld;b.g_changepwexcludeid=g_changepwexcludeid;b.lploggedin=lploggedin;b.g_genpws=g_genpws;b.g_local_key=g_local_key;b.g_local_key_hex=g_local_key_hex;b.g_badgedata=g_badgedata;b.g_notification_type=g_notification_type;b.g_notification_data=g_notification_data;b.g_premium_exp=g_premium_exp;b.g_enterpriseuser=g_enterpriseuser;b.g_hideexport=g_hideexport;b.g_hideidentities=g_hideidentities;b.g_hideimport=g_hideimport;b.g_hidenotes=
g_hidenotes;b.g_hideprint=g_hideprint;b.g_identity=g_identity;b.clearRecentTime=getClearRecentTime();if(g){f=!1;for(c in g_applications)if(check_ident_appaid(g_applications[c].appaid)){f=!0;break}b.g_have_application=f}else{d=[];if(g_enable_full_menu)for(c in g_sites)check_ident_aid(g_sites[c].aid)&&(d[c]=g_sites[c]);b.g_sites=LPJSON.stringify(d);f=[];if(g_enable_full_menu)for(c in g_securenotes)check_ident_aid(g_securenotes[c].aid)&&(f[c]=g_securenotes[c]);b.g_securenotes=LPJSON.stringify(f);f=[];
if(g_enable_full_menu)for(c in g_applications)check_ident_appaid(g_applications[c].appaid)&&(f[c]=g_applications[c]);b.g_applications=LPJSON.stringify(f)}b.g_breach_data=LPJSON.stringify(g_breach_data);var h=getcurrenturl(),f=getsites("toolstripchangepw"==a.message.page?g_changepwtld:lp_gettld_url(h),"toolstripchangepw"==a.message.page,"toolstripchangepw"==a.message.page?g_changepwexcludeid:0);"toolstrip"==a.message.page&&(f=reorderOnURL(f,h));c=[];if(g_enable_full_menu)for(e in f)"toolstrip"==a.message.page&&
(e=f[e].aid),c[e]=g_sites[e];b.g_sites_tld=LPJSON.stringify(c);if(!g){e=[];if(g_enable_full_menu)for(c=0;c<g_formfills.length;c++)check_ident_ffid(g_formfills[c].ffid)&&(e[e.length]=g_formfills[c]);b.g_formfills=LPJSON.stringify(e)}b.g_identities=LPJSON.stringify(g_identities);b.g_nevers=LPJSON.stringify(getnevers());b.g_icons=LPJSON.stringify(g_enable_full_menu?g_icons:[]);b.g_bigicons=LPJSON.stringify(g_enable_full_menu?g_icons:[]);b.g_menuheight=getmenuheight(!0,!0,!0,!0);b.g_tabid=getcurrenttabid();
b.g_language=lpGetPref("language","");break;case "formfill":b.g_shares=LPJSON.stringify(g_shares);b.g_formfill_data=LPJSON.stringify(g_formfill_data);g_formfill_data=null;b.countryfromip=countryfromip;b.g_generatedpw=g_generatedpw;b.lploggedin=lploggedin;b.g_local_key=g_local_key;b.g_local_key_hex=g_local_key_hex;break;case "site":h=g_site_data?g_site_data.url:"";b.g_site_data=LPJSON.stringify(g_site_data);g_site_data=null;b.g_generatedpw=g_generatedpw;b.g_showhistorylinks=g_showhistorylinks;b.g_local_key=
g_local_key;b.g_local_key_hex=g_local_key_hex;b.g_secret_cache=LPJSON.stringify(g_secret_cache);d=[];for(c in g_sites)check_ident_aid(g_sites[c].aid)&&(d[c]=g_sites[c]);b.g_sites=LPJSON.stringify(d);f=getsites(lp_gettld_url(h),!0);d=[];for(e in f)d[e]=g_sites[e];b.g_sites_tld=LPJSON.stringify(d);b.g_shares=LPJSON.stringify(g_shares);f=[];for(c in g_securenotes)check_ident_aid(g_securenotes[c].aid)&&(f[c]=g_securenotes[c]);b.g_securenotes=LPJSON.stringify(f);f=[];for(c in g_applications)check_ident_appaid(g_applications[c].appaid)&&
(f[c]=g_applications[c]);b.g_applications=LPJSON.stringify(f);b.lploggedin=lploggedin;b.g_prompts=g_prompts;b.g_savesitestopersonal=LPJSON.stringify("undefined"!=typeof g_savesitestopersonal?g_savesitestopersonal:[]);b.g_sharing_enabled=g_sharing_enabled;break;case "create_account":case "reenter_password":b.g_create_account_data=LPJSON.stringify(g_create_account_data);break;case "siterefresh":d=[];for(c in g_sites)check_ident_aid(g_sites[c].aid)&&(d[c]=g_sites[c]);b.g_sites=LPJSON.stringify(d);f=
getsites(lp_gettld_url(h),!0);d=[];for(e in f)d[e]=g_sites[e];b.g_sites_tld=LPJSON.stringify(d);f=getsites(lp_gettld_url(h),!0);b.g_shares=LPJSON.stringify(g_shares);b.g_pending_pw_change=g_pending_pw_change;break;case "breach":b.g_breach_data=LPJSON.stringify(g_breach_data);b.g_username=g_username;d=[];for(e in g_sites)d[e]=g_sites[e];c=[];for(e in f)c[e]=g_sites[e];b.g_sites=LPJSON.stringify(d);b.g_shares=LPJSON.stringify(c);b.g_local_key=g_local_key;break;case "debug":b.g_historybuf=gethistorybuf(),
b.g_user_debug_enabled=is_user_debug_enabled()}event_dispatch_message(a,"gotdata",b)}
function update_menus(a){(g_ischrome||g_isopera||g_isfirefoxsdk)&&get_selected_tab(null,function(b){a&&(lastcontexturl=null);rebuildcontext(gettaburl(b))});if(g_issafari)for(var b=0;b<safari.extension.bars.length;b++)if("LPMenu"==safari.extension.bars[b].identifier){safari.extension.bars[b].label=gs("LastPass Menu");safari.extension.bars[b].contentWindow.redraw_menu();!lploggedin&&"undefined"==typeof SafariExtensionPopover&&safari.extension.bars[b].hide();break}}
function toggle_menu(a){for(var b=0;b<safari.extension.bars.length;b++)"LPMenu"==safari.extension.bars[b].identifier&&(a||safari.extension.bars[b].visible?safari.extension.bars[b].hide():safari.extension.bars[b].show())}function close_menu(){"undefined"==typeof SafariExtensionPopover&&toggle_menu(!0)}var g_alert_reinstall=!1;function alert_reinstall(){g_alert_reinstall||(g_alert_reinstall=!0)}
function create_firefox_panel(){var a="lp_toolstrip.html?browseraction=1&skip_pagemod=1";g_firefox_delay_menu_data&&(a+="&delay_data=1");g_firefox_panel=g_panel.Panel({width:390,height:497,contentURL:getchromeurl(a),contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",onHide:function(){g_firefox_button.state("window",{checked:!1});closePop()},contextMenu:!0});g_firefox_panel.port.on("message",function(a){a.target=g_firefox_panel;message_handler(a)})}
function lpbackgroundcontainer(){this.receiveMessage=function(a){switch(a.json.messagename){case "frame_script_loaded":g_chrome.Cc["@mozilla.org/globalmessagemanager;1"].getService(g_chrome.Ci.nsIMessageListenerManager).broadcastAsyncMessage("lastpass:contentevent",{messagename:"set_url_prefix",url_prefix:getchromeurl("",!0),lplanguage:get_lplanguage()})}}}lpbackground=new lpbackgroundcontainer;
function onLoad(a){g_onload_started=!0;L("BG : loaded");migrate_from_old_firefox();if(!a){if(g_isopera)g_opera_button=opera.contexts.toolbar.createItem({disabled:!1,title:"LastPass",icon:"icon_gray2_opera.png",popup:{width:"1px",height:"1px",href:getchromeurl("lp_toolstrip.html?browseraction=1")}}),opera.contexts.toolbar.addItem(g_opera_button),opera.extension.tabs.onfocus=function(){var a=opera.extension.tabs.getFocused(),a=a?gettaburl(a):"";"string"==typeof a&&""!=a&&-1==a.indexOf("widget")?(g_generate_url_prev=
g_generate_url,g_generate_url=a,opera.postError("######################################################### Setting bg.g_generate_url="+g_generate_url)):""==g_generate_url&&""!=g_generate_url_prev?(g_generate_url=g_generate_url_prev,opera.postError("######################################################### Setting B bg.g_generate_url="+g_generate_url_prev)):opera.postError("######################################################### NOT changing bg.g_generate_url="+g_generate_url)};else if(g_isfirefoxsdk){if("undefined"!=
typeof g_ui_button_toggle)g_firefox_preload_menu&&create_firefox_panel(),g_firefox_button=g_ui_button_toggle.ToggleButton({id:"lastpass-button",label:"LastPass",icon:self.data.url("icon_gray2.png"),onChange:function(a){a.checked&&getsinglefactortype(function(a){!g_ask_native_messaging_from_button&&(lploggedin||null!=g_badgedata||""==a&&1==lpGetPref("enablenewlogin",1))?lploggedin||null!=g_badgedata?g_firefox_preload_menu?(g_firefox_button_clicked=!0,g_firefox_panel.port.emit("message",{messagetype:"runonload"})):
(create_firefox_panel(),g_firefox_panel.show({position:g_firefox_button})):open_login_panel():(g_firefox_button.state("window",{checked:!1}),open_login(!0))})}});else{var b=g_window_utils.getMostRecentBrowserWindow();"undefined"!=typeof b.NativeWindow&&(g_fennec_menu_id=b.NativeWindow.menu.add(gs("LastPass"),null,fennec_menu))}g_page_mod.PageMod({include:["*","about:*"],contentScriptFile:self.data.url("onloadwff.js"),contentScriptWhen:"start",attachTo:["existing","top","frame"],onAttach:function(a){a.port.on("lpmessage",
function(b){b.worker=a;message_handler(b)})}});g_page_mod.PageMod({include:getchromeurl("*",!0),contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",attachTo:["existing","top","frame"],onAttach:function(a){a.port.on("message",function(b){"undefined"!=typeof b.messagefromurl&&-1!=b.messagefromurl.indexOf("skip_pagemod=1")||(b.target=a,message_handler(b))})}});new g_deprecated_window_utils.WindowTracker({onTrack:function(a){g_window_utils.isBrowser(a)||("chrome://global/content/commonDialog.xul"==
a.location.href&&"function"==typeof LP.lphandlebasic?setTimeout(function(){LP.lphandlebasic(a.document,a)},0):"chrome://foxmarks/content/foxmarks-login.xul"==a.location.href&&setTimeout(function(){LP.lphandlexmarks(a.document,a)},0))}});b=g_chrome.Cc["@mozilla.org/globalmessagemanager;1"].getService(g_chrome.Ci.nsIMessageListenerManager);b.loadFrameScript(getchromeurl("content.js",!0),!0);b.addMessageListener("lastpass:lpevent",lpbackground);AwesomeBarSuggestion({icon:getchromeurl("icon2.png"),matches:/^lp /i,
onSearch:function(a,b){var d=a.substring(3).trim();if(lploggedin&&0!=d.length){var g=[],h=g_prompts.edit_sn_prompt?!1:get_searchNotesPref(),d=search_results(d.toLowerCase(),h);typeof("undefined"!==d)&&d.sort(lp_sort_case_insensitive_name);var h=0,k;for(k in d){var l=d[k],j;l.sn?j=of(l.name):(j=of(l.name),l=getusernamefromacct(l),""!=l&&(j+=" ("+of(l)+")"));l=LP.is_application(d[k])?d[k].appname:d[k].url;g.push({url:getchromeurl("launch.html?aid="+encodeURIComponent(get_record_id(d[k]))),title:j,favicon:geticonurlfromrecord(d[k]),
label:"http://sn"==l?gs("Secure Note"):l});if(7<h++)break}b(g,!0)}}})}g_issafari?(g_hidemenubar&&"undefined"!=typeof SafariExtensionPopover&&toggle_menu(!0),safari.application.addEventListener("message",message_handler,!1),safari.application.addEventListener("command",command_handler,!1),safari.application.addEventListener("navigate",navigate_handler,!1)):g_isopera?opera.extension.addEventListener("message",message_handler,!1):g_ismaxthon&&window.external.mxGetRuntime().listen("lpbackground",message_handler)}have_binary_function("lpvt_setup_if")&&
!is_guiless()&&call_binary_function("lpvt_setup_if");have_binary_function("file_exists")&&(call_binary_function("file_exists","LPISLOC",function(a){a&&call_binary_function("read_file","LPISLOC",function(a){call_binary_function("lpvt_verify_file_contents",a,function(a){a?LPISLOC=!0:alert_reinstall()})})}),call_binary_function("file_exists","LPISUPEK",function(a){a&&call_binary_function("read_file","LPISUPEK",function(a){call_binary_function("lpvt_verify_file_contents",a,function(a){a?LPISUPEK=!0:alert_reinstall()})})}),
call_binary_function("file_exists","LPISUPEKCAPABLE",function(a){a&&call_binary_function("read_file","LPISUPEKCAPABLE",function(a){call_binary_function("lpvt_verify_file_contents",a,function(a){a?LPISUPEKCAPABLE=!0:alert_reinstall()})})}));!a&&(g_ischrome&&!is_guiless())&&("function"==typeof chrome.browserAction.setPopup&&chrome.browserAction.onClicked.addListener(function(){g_ask_native_messaging_from_button?(g_ask_native_messaging_from_button=!1,request_native_messaging(),drawIconAtRotation(0)):
open_login(!0)}),chrome.tabs.onUpdated.addListener(function(a,b,d){"loading"==b.status&&(a=gettabid(d),b.url&&(g_badgedata&&g_badgedata.type&&"alert"==g_badgedata.type&&g_badgedata.tabid&&g_badgedata.tabid==a)&&!compare_tlds(lp_gettld_url(b.url),g_badgedata.tld)&&(g_badgedata=null,drawIconAtRotation(0)))}),chrome.tabs.onCreated.addListener(function(){clear_badge_text();lastcontexturl=""}));drawIconAtRotation(0);get_reg_bool("hidevault",g_hidevault,function(a){g_hidevault=a});get_reg_bool("hidenotes",
g_hidenotes,function(a){g_hidenotes=a});get_reg_bool("hideidentities",g_hideidentities,function(a){g_hideidentities=a});get_reg_bool("hideexport",g_hideexport,function(a){g_hideexport=a});get_reg_bool("hideimport",g_hideimport,function(a){g_hideimport=a});get_reg_bool("hidesharing",g_hidesharing,function(a){g_hidesharing=a});get_reg_bool("hideprint",g_hideprint,function(a){g_hideprint=a});LPISLOC&&(g_hideidentities=g_hidesharing=g_hideprint=!0);a?1==lpGetPref("enablenamedpipes",1)&&have_binary()&&
lpnp_init():(lpReadAllPrefs(function(a){createContextMenus();lplog("base_url="+base_url);get_all_windows({populate:!0},function(a){for(var b=0;b<a.length;b++)for(var c=0;c<get_tabs_length(a[b]);c++){var d=get_tabs(a[b])[c],k=gettabid(d);if((d=gettaburl(d))&&(-1!=d.indexOf("https://lastpass.com/install.php")||-1!=d.indexOf(base_url+"install.php")))lplog("Reloading install.php page"),chrome.tabs.reload(k)}});0==a?g_ischrome?(lpPutGblPref("welcomedone",1),lpWriteAllPrefs(),!LPISLOC&&!is_guiless()&&!g_hidecreate&&
!g_hidecreatepop?check_show_welcome():open_native_messaging_html_if()):g_issafari&&"undefined"!=typeof SafariExtensionPopover&&toggle_menu(!0):open_native_messaging_html_if();1==lpGetPref("enablenamedpipes",1)&&have_binary()&&lpnp_init();if(g_is_mac&&(g_issafari||g_ischrome))lp_ws.setup(),g_issafari&&new WebSocket("ws://127.0.0.1:19537","lp2");g_offer_popupfill&&(do_experimental_popupfill=1==lpGetPref("usepopupfill",1));(LPISLOC||!g_np_init)&&httptest()}),setup_poll_timer(),DeleteOldDynamicFiles(),
-1!=getchromeurl("needtoreinstall.html").indexOf("kegdhfdpgckamaoikbjiemmikleploeh")&&openURL(base_url+"/needtoreinstall.html"));g_ischrome&&(!g_basicauth_timer_started&&have_binary_function("setup_basicauth_timer"))&&(g_basicauth_timer_started=!0,call_binary_function("setup_basicauth_timer"));if(!a){LoadSpecialSites();setTimeout(check_key_for_changes,6E4);try{g_ischrome&&chrome.webRequest.onAuthRequired.addListener(function(a){var b={};try{if("undefined"!=typeof g_launches[a.tabId]&&g_launches[a.tabId]){var d=
g_launches[a.tabId];if("undefined"!=typeof g_sites[d]){var g=g_sites[d];compare_tlds(lp_gettld_url(g.url),lp_gettld_url(gettaburl(a)))&&(b.authCredentials={username:getusernamefromacct(g),password:getpasswordfromacct(g)},g_launches[a.tabId]=null)}}else{var h=gettaburl(a),k=reorderOnURL(getsites(lp_gettld_url(h)),h,!0),l;for(l in k)if(1==k[l].basic_auth&&write_history({cmd:"check_autologin3",tabid:tabid,aid:k[l].aid,submit:"tbd"}),1==k[l].basic_auth&&check_autologin(!1,k[l])){b.authCredentials={username:getusernamefromacct(k[l]),
password:getpasswordfromacct(k[l])};break}}}catch(j){}return b},{urls:["<all_urls>"]},["blocking"])}catch(d){}}}function chromeGetSelf(a){chrome&&chrome.management&&"function"==typeof chrome.management.getSelf?chrome.management.getSelf(a):a(null)}
function check_show_welcome(){g_ischrome&&chromeGetSelf(function(a){get_registry_value("Software\\LastPass","LoginUsers","",function(b){var d=""!=b;get_registry_value("Software\\LastPass","UniversalInstaller","",function(b){universalinstaller=""!=b;!d&&!g_hidecreate&&!universalinstaller?get_all_windows({populate:!0},function(b){for(var c="",d=!1,h=0;h<b.length;h++){for(var k=0;k<get_tabs_length(b[h]);k++){var l=get_tabs(b[h])[k];gettabid(l);var j=gettaburl(l);if(-1!=j.indexOf("https://lastpass.com/install.php")||
-1!=j.indexOf(base_url+"install.php"))d=!0;if(-1!=j.indexOf("https://lastpass.com/dl/inline/")||-1!=j.indexOf(base_url+"dl/inline/"))if(close_tab(l),c=getQueryVariable("hasaccount",j),""!=c)break}if(""!=c)break}d=d&&a&&"sideload"==a.installType;d||(j="welcome.html",""!=c&&(set_default_login_username(c),j+="?hasaccount="+encodeURIComponent(c)),openURL(getchromeurl(j)))}):(console.log("skipping wizard, looks like someone has logged in before"),open_native_messaging_html_if())})})})}
function get_reg_bool(a,b,d){get_registry_value("Software\\LastPass",a,"-1",function(a){-1==a?d(b):d("1"==a)})}function onUnload(){close_lpctypeslib();deleteallattachments(!0);if(g_fennec_menu_id){var a=g_window_utils.getMostRecentBrowserWindow();"undefined"!=typeof a.NativeWindow&&a.NativeWindow.menu.remove(g_fennec_menu_id)}}
function check_key_for_changes(){if(!(null==g_local_key_hash||""==g_local_key)&&null!=g_local_key_hash&&SHA256(g_local_key)!=g_local_key_hash)L("LOGGING OFF : cosmicrays"),loggedOut(),lpReportError("INVESTIGATE! KEY_HASH IS WRONG! COSMIC RAYS?");this.setTimeout(check_key_for_changes,6E4)}
if(g_ischrome){var onconnect_listener=function(a){var b=!1;a.sender.tab&&(gettaburl(a.sender.tab)&&punycode.URLToASCII(a.name)==gettaburl(a.sender.tab))&&(g_loggedLogins=[],b=!0,g_datacache[a.sender.tab.id]={html:"",extra:""},g_popupforminput[a.sender.tab.id]=[],g_popupform_active[a.sender.tab.id]=0,g_popupform_active_choose[a.sender.tab.id]=0,g_popupform_more_open[a.sender.tab.id]=0,g_popupform_shownavbar[a.sender.tab.id]=0);a.sender.tab&&(L("RAW TAB URL CS["+a.sender.tab.id+"] = "+a.sender.tab.url),
L("RAW TAB URL NAME CS["+a.sender.tab.id+"] = "+a.name),L("CS["+a.sender.tab.id+"] -> BG : CONNECT from tab with url="+gettaburl(a.sender.tab)));if(!("undefined"==typeof a.sender||"undefined"==typeof a.sender.tab||"undefined"==typeof a.sender.tab.id)){var d=a.sender.tab.id;if("undefined"==typeof g_CS[a.sender.tab.id]||!g_CS[a.sender.tab.id])g_CS[a.sender.tab.id]=[],g_CS_count[a.sender.tab.id]=0;var c=g_CS[a.sender.tab.id].length;g_CS[a.sender.tab.id][c]=a;g_CS_count[a.sender.tab.id]++;var e={cmd:"setdocnum",
docnum:c};!do_experimental_popupfill&&0==lpGetPref("showNotificationsAfterClick",1)&&(e={cmd:"setdocnum",docnum:c,ff:g_cachedffdat});if(2<=g_CS_count[a.sender.tab.id]&&("http://chat.major-design.ru/"==a.name||0<a.name.indexOf("facebook.com/ajax/")))d=a.sender.tab.id,lpdbg("connect","skipping connect to document with tabcount="+g_CS_count[a.sender.tab.id]+", istop="+b+", url="+a.name),sendCS(d,{cmd:"remove_event_listener"},c),delete g_CS[d][c];else{register_new_cs(d,c,a.name,b);if(!b&&is_max_frames_exceeded(a.sender.tab.id,
g_CS_count)||hasNeverEnableLP(a.name,lp_gettld_url(a.name)))L("set killswitch for tab:"+a.sender.tab.id+" url:"+a.name),e.killswitch=1,set_killswitch_value(d,c,e.killswitch);else if(!b&&g_skip_ad_frames&&skip_CS_by_score(d,c))console.warn("EXPERIMENT: skipping ads/rich content frame "+a.name),e.killswitch=1,set_killswitch_value(d,c,e.killswitch);else{var f=lp_gettld_url(a.name),f=0<f.lastIndexOf(".")?f.substr(f.lastIndexOf(".")+1):"";e.tld=f;e.tlddata=LPJSON.stringify("undefined"==typeof lp_all_tlds[f]?
[]:lp_all_tlds[f]);set_killswitch_value(d,c,0)}sendCS(a.sender.tab.id,e,c);b?(g_CS_tops[a.sender.tab.id]=c,"undefined"!=typeof g_persistent_notifications[a.sender.tab.id]&&g_persistent_notifications[a.sender.tab.id]&&sendCS(a.sender.tab.id,g_persistent_notifications[a.sender.tab.id]),g_cpwbot&&CPWbot_bg&&CPWbot_bg.score_topdoc(a.sender.tab.id,c,a.name)):(g_CS_tops[a.sender.tab.id]==c&&(console.warn("page reload case, new topdoc != old topdoc, new topdoc has not registered yet"),console.warn("delete g_CS_tops["+
a.sender.tab.id+"]"),delete g_CS_tops[a.sender.tab.id],g_cpwbot&&CPWbot_bg&&(CPWbot_bg.clear_frame_score(a.sender.tab.id,c,a.name),CPWbot_bg.in_validate()&&CPWbot_bg.force_validate_retry(!0))),"undefined"!=typeof g_persistent_notifications[a.sender.tab.id]&&(g_persistent_notifications[a.sender.tab.id]&&-1!=a.name.indexOf("streetscape.com"))&&setTimeout(function(){sendCS(a.sender.tab.id,g_persistent_notifications[a.sender.tab.id],"all")},10));!b&&is_max_frames_exceeded(a.sender.tab.id,g_CS_count)?
delete g_CS[a.sender.tab.id][c]:(a.onMessage.addListener(function(b,c){receiveCS(c.sender.tab.id,b,0,a)}),a.onDisconnect.addListener(function(b){receiveCS(b.sender.tab.id,null,1,a)}))}}};"undefined"!=typeof chrome.runtime&&"undefined"!=typeof chrome.runtime.onConnect?chrome.runtime.onConnect.addListener(onconnect_listener):chrome.extension.onConnect.addListener(onconnect_listener);var listener=function(a,b,d){if("undefined"!=typeof a.cmd)if("getnotificationdata"==a.cmd)"undefined"!=typeof g_datacache[b.tab.id]&&
d(g_datacache[b.tab.id]);else if("hideoverlay"==a.cmd||"slidedownoverlay"==a.cmd||"slideupoverlay"==a.cmd||"hidecontext"==a.cmd)sendCS(b.tab.id,{cmd:a.cmd}),"hideoverlay"==a.cmd&&(g_persistent_notifications[b.tab.id]=null,clear_badge());else if("popupfillscreateack"==a.cmd){if(do_experimental_popupfill&&"undefined"!=typeof b.tab&&lploggedin){var c=b.tab.id;null!=typeof g_popup_tab_docnum[c]?sendCS(b.tab.id,{cmd:a.cmd},g_popup_tab_docnum[c]):sendCS(b.tab.id,{cmd:a.cmd},"all");has_popup_heartbeat(c)||
(do_popup_heartbeat(c),popup_heartbeat_fn(c))}}else if("closepopupfills"==a.cmd)do_experimental_popupfill&&"undefined"!=typeof b.tab&&(c=b.tab.id,null!=typeof g_popup_tab_docnum[c]?sendCS(b.tab.id,{cmd:a.cmd},g_popup_tab_docnum[c]):sendCS(b.tab.id,{cmd:a.cmd},"all"),delete g_popup_tab_docnum[c],clear_popup_heartbeat(c));else if("autofillaid"==a.cmd||"autologinaid"==a.cmd)a.topurl=gettaburl(b.tab),handleFill(b.tab.id,a);else if("undefined"!=typeof a.action&&"never"==a.action){if(handleNever(b.tab.id,
a),"undefined"!=typeof a.fromsave&&(g_persistent_notifications[b.tab.id]=null,clear_badge()),do_experimental_popupfill&&(d=gettaburl(b.tab),hasNeverAutologin(d,lp_gettld_url(d))||hasNeverFormFill(d,lp_gettld_url(d))||hasNeverGenerate(d,lp_gettld_url(d))||hasNeverShowIcon(d,lp_gettld_url(d))||hasNeverSave(d,lp_gettld_url(d))))handleGetNevers(c,d),closeclickables(c),g_popupform_active[c]=0,g_popupform_active_choose[c]=0,recheckpage(!0)}else if("getpopupfilldata"==a.cmd)do_experimental_popupfill&&("undefined"!=
typeof b.tab&&"undefined"!=typeof g_datacache[b.tab.id]&&lploggedin?null!=b.tab.id&&(c=cobble_popup_iframe_data(b.tab.id),d(c),c=b.tab.id,sendCS(c,{cmd:"popupfillscreateack"},"all"),has_popup_heartbeat(c)||(do_popup_heartbeat(c),popup_heartbeat_fn(c))):d(null));else if("popupfillinputget"==a.cmd)do_experimental_popupfill&&("undefined"!=typeof b.tab&&lploggedin)&&("undefined"==typeof g_popupform_active[b.tab.id]&&(g_popupform_active[b.tab.id]=0),"undefined"==typeof g_popupform_active_choose[b.tab.id]&&
(g_popupform_active_choose[b.tab.id]=0),"undefined"==typeof g_popupforminput[b.tab.id]&&(g_popupforminput[b.tab.id]={value:"",id:"",issaveall:0,inputtype:""}),"undefined"==typeof g_popupform_more_open[b.tab.id]&&(g_popupform_more_open[b.tab.id]=0),"undefined"==typeof g_popupform_shownavbar[b.tab.id]&&(g_popupform_shownavbar[b.tab.id]=0),c={inputstr:g_popupforminput[b.tab.id].value,inputid:g_popupforminput[b.tab.id].id,active:g_popupform_active[b.tab.id],choose:g_popupform_active_choose[b.tab.id],
issaveall:g_popupforminput[b.tab.id].issaveall,inputtype:g_popupforminput[b.tab.id].inputtype,moreopen:g_popupform_more_open[b.tab.id],shownavbar:g_popupform_shownavbar[b.tab.id]},d(c),g_popupform_active[b.tab.id]=0,g_popupform_active_choose[b.tab.id]=0,g_popupform_more_open[b.tab.id]=0,g_popupform_shownavbar[b.tab.id]=0);else if("dosaveiframe"==a.cmd)do_experimental_popupfill&&("undefined"!=typeof b.tab&&lploggedin)&&(c=savesite_from_iframe(a,b.tab.id),d(c));else if("popupfillsaveget"==a.cmd){if(do_experimental_popupfill&&
"undefined"!=typeof b.tab&&lploggedin){c=g_popupfill_save_data;if(c.formdata2){b=[];for(var e in g_sites)if(check_ident_aid(e)){var f=g_sites[e].group;""!=f&&!lp_in_array(f,b)&&(b[b.length]=f)}b.sort(function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1});c.groups=b;"undefined"!=typeof a.url&&(c.group=get_default_group(a.url))}d(c);g_popupfill_save_data={}}}else if("popupfillgetgenerateprefs"==a.cmd)do_experimental_popupfill&&(a=LPJSON.stringify({generate_advanced:parseInt(lpGetPref("generate_advanced",
0)),generate_length:parseInt(lpGetPref("generate_length",12)),generate_upper:parseInt(lpGetPref("generate_upper",1)),generate_lower:parseInt(lpGetPref("generate_lower",1)),generate_digits:parseInt(lpGetPref("generate_digits",1)),generate_special:parseInt(lpGetPref("generate_special",0)),generate_mindigits:parseInt(lpGetPref("generate_mindigits",1)),generate_ambig:parseInt(lpGetPref("generate_ambig",0)),generate_reqevery:parseInt(lpGetPref("generate_reqevery",1)),generate_pronounceable:parseInt(lpGetPref("generate_pronounceable",
0))}),e=LPJSON.stringify(g_genpws),c=b.tab.id,(b=g_generate_pw_pattern_hints[c])||(b=""),b=LPJSON.stringify(b),c={prefstr:a,genpwstr:e,genpwpattern:b},d(c));else if("popupfillsetgenerateprefs"==a.cmd){if(do_experimental_popupfill){d=LPJSON.parse(a.prefstr);lpPutUserPref("generate_advanced",parseInt(d.generate_advanced));lpPutUserPref("generate_length",parseInt(d.generate_length));lpPutUserPref("generate_upper",parseInt(d.generate_upper));lpPutUserPref("generate_lower",parseInt(d.generate_lower));
lpPutUserPref("generate_digits",parseInt(d.generate_digits));lpPutUserPref("generate_special",parseInt(d.generate_special));lpPutUserPref("generate_mindigits",parseInt(d.generate_mindigits));lpPutUserPref("generate_ambig",parseInt(d.generate_ambig));lpPutUserPref("generate_reqevery",parseInt(d.generate_reqevery));lpPutUserPref("generate_pronounceable",parseInt(d.generate_pronounceable));if("undefined"!=typeof a.genpwstr&&(d=LPJSON.parse(a.genpwstr),null!=d&&!isEmptyObject(d)))for(f in g_genpws=[],
d)d.hasOwnProperty(f)&&g_genpws.push(d[f]);lpWriteAllPrefs()}}else"savePassword"==a.cmd?do_experimental_popupfill&&("undefined"!=typeof b.tab&&lploggedin)&&savePassword(a.pass,gettaburl(b.tab),b.tab.id,!1):"dopwchallenge"==a.cmd?(g_popupfill_pw_challenge=null,security_prompt(function(){g_popupfill_pw_challenge=!0},function(){g_popupfill_pw_challenge=!1},!1)):"getpwchallengeresult"==a.cmd?(d(g_popupfill_pw_challenge),typeof("undefined"!=a.reset)&&(g_popupfill_pw_challenge=null),null!==g_popupfill_pw_challenge&&
(g_popupfill_pw_challenge=null)):"getcpwmsg"==a.cmd?CPWbot_bg&&d({msg:CPWbot_bg.get_last_overlay_message(),minimize_state:cpwbot_get_minimize_dialog_state()}):receiveCS(b.tab.id,a,0,{tab:b.tab})};"undefined"!=typeof chrome.runtime&&"undefined"!=typeof chrome.runtime.onMessage?chrome.runtime.onMessage.addListener(listener):chrome.extension.onRequest.addListener(listener)}
function disconnectCS(a){if("undefined"!=typeof g_CS[a]&&g_CS[a]){for(var b in g_CS[a])g_CS[a][b].disconnect(),g_CS[a][b]=null,delete_cs_for_docnum(a,b);g_CS_count[a]=0;g_cpwbot&&CPWbot_bg&&(L("disconnect clear score [tabid:"+a+"]"),CPWbot_bg.reset_scores(a))}}var MAX_RETRY_SEND_CS=5;
function sendCS(a,b,d,c){b&&("string"==typeof b.cmd&&b.cmd.match(/show.*notification/))&&(b.notificationsBottom=getInt(lpGetPref("notificationsBottom",0)));"undefined"==typeof c||!1==c?c=0:!0==c&&(c=1);debug&&("loadurl"==b.cmd?L("BG -> CS["+a+"] : initial "+b.cmd+" url:"+b.url):"gotpopupfillinput"!=b.cmd&&L("BG -> CS["+a+"] : initial "+b.cmd));0<c&&"undefined"==typeof b.cmd&&L("BG -> CS["+a+"] : retry="+c);if("all"==a)for(var e in g_CS)for(var f in g_CS[a])try{debug&&L("calling sendCS["+e+"]["+f+
"] cmd="+b.cmd),sendCS(e[f],b)}catch(g){"saveall"==b.cmd&&g_saveall_framestotal--}else if("undefined"==typeof g_CS[a]||!g_CS[a])0>c||c>=MAX_RETRY_SEND_CS||setTimeout(function(){sendCS(a,b,d,c+1)},150*c);else for(e in b.urlprefix=getchromeurl("",!0),b.lplanguage=get_lplanguage(),f=!0,g_CS[a]){if("undefined"==typeof d||null==d){if(!f)continue;f=!1}else if("all"!=d&&d!=e)continue;if(0<get_killswitch_value(a,e)){var h=getcsinfo(a,e),h=h?h.url:"unknown";write_history({cmd:"info",msg:sprintf("killswitch, ignoring %s to %s",
b.cmd,h),tabid:a,docnum:e});is_human_initiated_action(b)&&hasNeverEnableLP(h,lp_gettld_url(h))&&60<g_last_ui_warning-LPPerl.time()&&(g_last_ui_warning=LPPerl.time(),alertfrombg("manual fill blocked due to never rule"))}else try{g_ischrome?g_CS[a][e].postMessage(b):g_issafari?(b.docnum=e,g_CS[a][e].page.dispatchMessage("message",b),"loadurl"==b.cmd&&delete g_CS[a][e]):g_isopera?(b.docnum=e,b.messagetype="message",g_CS[a][e].postMessage(b)):g_ismaxthon?(b.docnum=e,b.messagetype="message",window.external.mxGetRuntime().post(e,
b)):g_isfirefoxsdk&&(b.docnum=e,b.messagetype="message",g_CS[a][e].port.emit("lpmessage",b))}catch(k){}}}function receiveCS(a,b,d,c){if(d){if(0>=--g_CS_count[a]||punycode.URLToASCII(c.name)==gettaburl(c.sender.tab))g_CS[a]=null,delete_cs_for_tab(a),g_cpwbot&&CPWbot_bg&&(L("disconnect clear score [tabid:"+a+"]"),CPWbot_bg.reset_scores(a))}else"undefined"==typeof b.cmd?L("CS["+a+"] -> BG : INVALIDMSG"):processCS(a,b,c)||L("CS["+a+"] -> BG : INVALIDMSG")}var g_safari_error_notifications=!0;
function sendTS(a,b){if(!g_isopera&&!g_ismaxthon&&(!g_issafari||g_can_open_popover&&g_safari_error_notifications))try{if("notification"==a.cmd&&"upgrade"!=a.type&&set_badge(a),!("notification"!=a.cmd||"upgrade"!=a.type||g_isfirefoxsdk||g_issafari)){var d="undefined"==typeof b?"all":b,c=!1,e=chrome.extension.getViews(),f;for(f in e)if("function"==typeof e[f].receiveBG&&("all"==d||"undefined"!=typeof e[f].g_toolstripid&&d==e[f].g_toolstripid))if(L("BG -> TS : cmd="+a.cmd),e[f].receiveBG(a),c=!0,"all"!=
d)break;c||L("BG -> TS : FAILED")}}catch(g){L("BG -> TS : FAILED error="+g)}}function set_badge(a){g_issafari&&"alert"!=g_notification_type&&"lpalert"!=g_notification_type&&"error"!=g_notification_type||g_isopera||g_ismaxthon||is_guiless()?g_badgedata=null:(g_badgedata=a,currrotation=0,animateFlip())}function clear_badge(){!g_issafari&&(!g_isopera&&!g_ismaxthon&&!is_guiless())&&(currrotation=numrotations,g_badgedata=null,drawIconAtRotation(0))}
function set_badge_text(a){!g_issafari&&(!g_isopera&&!g_ismaxthon&&!is_guiless())&&(do_experimental_popupfill&&0!=lpGetPref("showmatchingbadge",1))&&("string"!=typeof a&&(a=""+a),g_isfirefoxsdk?g_firefox_button&&(g_firefox_button.badgeColor="#555",g_firefox_button.badge=a):(chrome.browserAction.setBadgeBackgroundColor({color:"#555"}),chrome.browserAction.setBadgeText({text:a})))}
function clear_badge_text(){!g_issafari&&(!g_isopera&&!g_ismaxthon&&!is_guiless()&&!g_iscasper)&&(g_isfirefoxsdk?g_firefox_button&&(g_firefox_button.badge=""):chrome.browserAction.setBadgeText({text:""}))}
function receiveTS(a,b){if("undefined"==typeof b.cmd)return L("TS["+a+"] -> BG : INVALIDMSG"),null;L("TS["+a+"] -> BG : cmd="+b.cmd);switch(b.cmd){case "getloginstate":lploggedin&&sendTS({cmd:"login"},a);break;case "sesameauth":sesame_auth(b.otp,b.label);break;case "yubikeyauth":yubikey_auth(b.otp,b.label);break;case "googleauthauth":googleauth_auth(b.otp,b.label);break;case "outofbandauth":outofband_auth(b.otp,b.label);break;case "settrustlabel":g_trustlabel=b.trustlabel;break;case "securityquestionauth":securityquestion_auth(b.otp,
b.label);break;case "gridauth":grid_auth(b.gridvalues,b.label);break;case "multifactorauth":multifactor_auth(["multifactorresponse"],b.label);break;case "lostkey":lostkey();break;case "googleauthlostkey":googleauthlostkey();break;case "outofbandlostkey":outofbandlostkey();break;case "securityquestionlostkey":securityquestionlostkey();break;case "sesamelostkey":sesamelostkey();break;case "gridlostkey":gridlostkey();break;case "multifactorlostkey":multifactorlostkey(b.type);break;case "turnofficon":lpTurnOffIcon();
break;case "of":of(b.a);break;default:return L("TS["+g_toolstripid+"] -> BG : INVALIDMSG"),null}}function omnikey_get_pin(a){g_omnikey_callback=a;openURL(getchromeurl("omnikey.html"))}
function processCS(a,b,d){"undefined"!=typeof b.url&&(b.url=punycode.URLToASCII(b.url));"undefined"!=typeof b.timestamp&&update_cs_timestamp(a,b);switch(b.cmd){case "set_possiblemax":var c=typeof("undefined"!==b.max)?b.max:-1;g_possiblemax_tuple=0>c||100<c?[]:[a,c];break;case "rsadecrypt":if(lp_url_is_lastpass(b.url)){var e=b.sharerpublickeyhex,f=b.sharekeyenchex,g="",g=c="";!e||!f?c="rsaerror":(g=lprsa_rsadecrypt(f),c=null==g||""==g?"rsaerror":"ok");sendCS(a,{cmd:"rsadecrypt",rc:c,sharekeyhex:g})}break;
case "rsaencryptmultiple":lp_url_is_lastpass(b.url)&&(e=b.data,f=c="",e?(f=lprsa_encryptmultiple(e),c=null==f||""==f?"rsaerror":"ok"):c="rsaerror",sendCS(a,{cmd:"rsaencryptmultiple",rc:c,dataout:f}));break;case "ipcgetdata":case "plug2web":if(lp_url_is_lastpass(b.url)){if(g_protect_plug2web&&g_plug2web_last_initiated<lp_get_gmt_timestamp()-g_plug2web_timeout)break;else g_plug2web_last_initiated=0;e=lpParseUri(b.url);c=e.directory;e=e.file;c=c.replace(/^\/~[^/]*/,"");if(""!=c&&"/"!=c&&"/sso/"!=c&&
"/sso/webroot/"!=c&&"/sso/aso/"!=c){lpdbg("error","Keyplug2web request from invalid directory: "+c);break}e=e.replace(/#/,"");if(""!=e&&"index.php"!=e&&"misc_login.php"!=e&&"import.php"!=e&&"export.php"!=e&&"otp.php"!=e&&"frameset.php"!=e&&"frame_login.php"!=e&&"gettopost.php"!=e&&"misc_challenge.php"!=e&&"misc_challenge2.php"!=e&&"enterprise_users.php"!=e&&"share_overview.php"!=e&&"acctsiframe.php"!=e){lpdbg("error","Keyplug2web request from invalid file: "+e);break}null!=g_username&&""!=g_username&&
(b.username&&""!=b.username&&fix_username(b.username)!=fix_username(g_username)?loggedOut(!1,"plug2webA"):"ipcgetdata"==b.cmd?(c={cmd:"ipcgotdata",username:g_username,key:btoa(g_local_key),version:lpversion,identity:g_identity,iterations:get_key_iterations(g_username)},"undefined"!=typeof b.callback?b.callback(c):sendCS(a,c,b.docnum)):(sendCS(a,{cmd:"plug2web",username:g_username,key:AES.bin2hex(g_local_key),version:lpversion,identity:g_identity,hash:g_local_hash,g_cpwbot:g_cpwbot},b.docnum),"gettopost.php"==
e&&unlock_plug2web()))}break;case "openlogindialog":open_login();break;case "getversion":sendCS(a,{cmd:"getversion",version:lpversion,builddate:build_date,versionpre:lpversionpre,isloggedin:lploggedin?1:0},b.docnum);break;case "setdefaultloginusername":set_default_login_username(b.username);break;case "getdebuginfo":sendCS(a,{cmd:"getdebuginfo",info:""},b.docnum);break;case "web2plug":lp_url_is_lastpass(b.url)&&web2plug(b);break;case "savesiteicon":g_popupfill_save_data={};savesiteicon_real(a,b);
break;case "logout":case "logoff":lp_url_is_lastpass(b.url)&&lploggedin&&loggedOut(!1,"logoff");break;case "login":lp_url_is_lastpass(b.url)&&loginfromwebsite(b);break;case "fill":case "autofillaid":case "autologinaid":"undefined"!=typeof b.docstate&&update_cs_docstate(a,b);b.topurl=g_ischrome?gettaburl(d.sender.tab):gettaburl(d.tab);handleFill(a,b);break;case "checkgenpwfillforms":lploggedin&&checkgenpwfillforms(a,b.url,b.hasff);break;case "neverautofill":case "neverpage":case "neverdomain":c=gettaburl(d.tab);
handleNever(a,b);"undefined"!=typeof b.fromsave&&"undefined"==typeof b.frompopupiframe&&(g_persistent_notifications[a]=null,b.notificationdata=LPJSON.parse(b.notificationdata),e=b.notificationdata.username,f=b.notificationdata.password,lpAddRejectedSite(e,f,b.tld),clear_badge());if(do_experimental_popupfill&&(hasNeverAutologin(c,lp_gettld_url(c))||hasNeverFormFill(c,lp_gettld_url(c))||hasNeverGenerate(c,lp_gettld_url(c))||hasNeverShowIcon(c,lp_gettld_url(c))||hasNeverSave(c,lp_gettld_url(c))))handleGetNevers(a,
c),closeclickables(a),g_popupform_active[a]=0,g_popupform_active_choose[a]=0,recheckpage(!0);break;case "clearnotification":clear_badge();g_persistent_notifications[a]=null;break;case "notnow":b.notificationdata=LPJSON.parse(b.notificationdata);e=b.notificationdata.username;f=b.notificationdata.password;lpAddRejectedSite(e,f,b.tld);g_persistent_notifications[a]=null;clear_badge();break;case "startsaveall":"undefined"!=typeof b.iframe&&1==b.iframe&&(g_ischrome&&(g_popupfill_save_data={close:1}),g_issafari&&
(g_popupfill_save_data={close:1}));saveall();break;case "savethesite":var h=b.notificationdata;if("undefined"!=typeof b.iframe&&1==b.iframe&&g_popup_tabid_save){g_popup_tab_docnum[a]!=g_CS_tops[a]&&(c=g_ischrome?gettaburl(d.sender.tab):gettaburl(d.tab))&&0<c.length&&(h.url=c);g_popupfill_save_data=h;break}"object"!=typeof h&&(h=LPJSON.parse(h));"undefined"!=typeof h.formdata2&&parse_formdata(h);h.addsite=1;shouldUseSaveAll(h.url)?(g_saveall_url=h.url,g_saveall_done=!0,g_saveall_tabid=a,h.url.indexOf("streetscape.com")&&
(h.formdata=h.formdata.replace(/logon2/g,"logon1")),g_saveall_formdata=h.formdata,handleSaveAll(g_saveall_tabid,{cmd:"saveall",addsite:1,url:g_saveall_url,formdata:g_saveall_formdata})):(g_site_data=h,openURL(getchromeurl("site.html")));g_persistent_notifications[a]=null;clear_badge();break;case "changepw":h=b.notificationdata;"undefined"==typeof h.sitecount&&(h=LPJSON.parse(b.notificationdata));d=0;"undefined"!=typeof h.fromiframe&&(d=h.fromiframe);g_didchangepw[SHA256(h.newpw+h.tld)]=(new Date).getTime();
var k=getsites(h.tld,!0),l="",j=0,q=0;if(""!=h.oldpw){for(g in k)q++,f=getpasswordfromacct(g_sites[g]),f!=h.oldpw&&(j++,l+=","+g+",");1==q-j?(h.singleaid=matchingaid,h.sitecount=1):q!=j&&(h.excludeid=l)}if(1==h.sitecount){f=!0;for(c in g_sites)c==h.singleaid&&g_sites[c].pwprotect&&(f=!1);if(!check_for_frame_mismatch_ok(a,d,gs("Are you sure you would like to change your LastPass password for this site?"),"replace password"))return;f?changepw_wrapper(h):security_prompt(function(){changepw_wrapper(h)})}else{f=
!0;for(e in k)if(g_sites[e].pwprotect){f=!1;break}if(!check_for_frame_mismatch_ok(a,d,gs("Are you sure you would like to change your LastPass password for this site?"),"replace password(s)"))return;f?openchangepw_wrapper(h):security_prompt(function(){openchangepw_wrapper(h)})}g_persistent_notifications[a]=null;clear_badge();break;case "save":handleSave(a,b);break;case "updatefields":handleUpdateFields(a,b);break;case "addurid":handleAddUrid(a,b);break;case "saveall":"undefined"==typeof g_saveall_docnumsdone[b.docnum]&&
(g_saveall_docnumsdone[b.docnum]=1,g_saveall_formdata+=b.formdata,++g_saveall_framesdone>=g_saveall_framestotal&&finish_saveall());break;case "clearcache":lp_url_is_lastpass(b.url)&&clearCache(!0,!1,!1);break;case "getimportdata":if(lp_url_is_lastpass(b.url)){e=lpParseUri(b.url);c=e.directory;e=e.file;c=c.replace(/^\/~[^/]*/,"");if(""!=c&&"/"!=c&&"/sso/"!=c)break;if("import.php"!=e)break;sendCS(a,{cmd:"gotimportdata",source:lpimportsource,data:btoa(AES._utf8_encode(lpimportdata))});lpimportsource=
lpimportdata=""}break;case "get_tutorial_flags":sendCS(a,{cmd:"tutorial_flags",flags:localStorage[g_lp_mpw_user+"LPTFS"]},"all");break;case "set_tutorial_flags":localStorage[g_lp_mpw_user+"LPTFS"]=b.flags;break;case "initmpw":g_lp_mpw_user=localStorage.LPMPU;g_lp_iterations=localStorage[g_lp_mpw_user+"_key_iter"];unprotect_data(localStorage[g_lp_mpw_user+"LPMPS"],!0,function(a){g_lp_mpw_salt=a});unprotect_data(localStorage[g_lp_mpw_user+"LPMPH"],!0,function(a){g_lp_mpw_hash=a});unprotect_data(localStorage[g_lp_mpw_user+
"LPMPD"],!0,function(a){g_lp_mpw_uid=a});unprotect_data(localStorage[g_lp_mpw_user+"LPMNN"],!0,function(a){g_lp_mpw_nonag=1==a});unprotect_data(localStorage[g_lp_mpw_user+"LPMEX"],!0,function(a){g_lp_mpw_exclude=JSON.parse(a);null===g_lp_mpw_exclude&&(g_lp_mpw_exclude={})});unprotect_data(localStorage[g_lp_mpw_user+"LPMDD"],!0,function(a){g_lp_mpw_dedupe=JSON.parse(a);null===g_lp_mpw_dedupe&&(g_lp_mpw_dedupe={})});break;case "chkmpw":!lp_url_is_lastpass(b.url)&&"undefined"!=typeof g_lp_iterations&&
make_lp_key_hash_iterations(g_lp_mpw_salt,b.pw,g_lp_iterations,function(c,d){if(d==g_lp_mpw_hash){g_lp_mpw_bad_url=lp_gettld_url(b.url);if("undefined"==b.vaultscan&&!g_lp_mpw_nonag&&!(g_lp_mpw_bad_url in g_lp_mpw_exclude)){chrome.notifications.create("mpw_alert",{type:"basic",iconUrl:"icon2@2x.png",title:gs("Security Alert"),message:gs("This site has the same password as your LastPass account. To protect all of your online accounts, it is recommended that you change your LastPass Master Password."),
buttons:[{title:gs("Change Password")}],priority:0},function(a){myNotificationID=a});chrome.notifications.onClicked.addListener(function(a){a===myNotificationID&&window.open(base_url+"?ac=1&opensettings=1")});chrome.notifications.onButtonClicked.addListener(function(a){a===myNotificationID&&window.open(base_url+"?ac=1&opensettings=1")});var e={cmd:"lpshownotification",type:"error",data:{text:gs("Security Alert: This site has the same password as your LastPass account. To protect all of your online accounts, it is recommended that you change your LastPass Master Password."),
notificationdata:{custombutton:"More Information",customaction:"mpwchange.html"}}};sendCS(a,e,"all");g_persistent_notifications[a]=e}g_enterpriseuser&&(lploggedin&&!(g_lp_mpw_bad_url in g_lp_mpw_dedupe))&&(logmpwreuse(g_lp_mpw_bad_url),g_lp_mpw_dedupe[g_lp_mpw_bad_url]=1,localStorage_setItem(g_lp_mpw_user+"LPMDD",JSON.stringify(g_lp_mpw_dedupe)))}});break;case "recover":lp_url_is_lastpass(b.url)&&(g_is_recovery_login=!0,recover(a,b.url,b.username,b.docnum));break;case "launchautologin":lp_url_is_lastpass(b.url)&&
launchautologin(b.aid);break;case "getprefs":g_username_vals[b.url]=b.username_val;"undefined"!=typeof b.docstate&&update_cs_docstate(a,b);setprefs(a,b.docnum,b.url);break;case "getuuid":getuuid(function(c){sendCS(a,{cmd:"setuuid",uuid:c},b.docnum)});break;case "setuuid":setuuid(b.uuid);break;case "clearuuid":clearuuid();break;case "setupmultifactor":b.tabid=a;if(b.username==g_username){var n="type="+LP.en(b.type)+"&username="+LP.en(b.username);lpMakeRequest(base_url+"setupmultifactor.php",n,lpSetupMultifactorResponse,
function(){lpSetupMultifactorError(b)},b)}else sendCS(a,{cmd:"setupmultifactor",result:"error"},b.docnum);break;case "setupsinglefactor":lpdbg("singlefactor","setting up single factor");b.tabid=a;if(b.username==g_username||"1"==b.silent){var n="type="+LP.en(b.type)+"&username="+LP.en(b.username),m=!0,u=function(){lpdbg("singlefactor","make_request_if: "+m);if(m)lpdbg("singlefactor","making request"),lpMakeRequest(base_url+"setupmultifactor.php",n,lpSetupMultifactorResponse,function(){lpSetupMultifactorError(b)},
b);else if("1"!=b.silent){var c={cmd:"setupsinglefactor",result:"error"};"undefined"!=typeof b.callback?b.callback(c):sendCS(a,c,b.docnum)}};"omnikey"==b.type?omnikey_get_pin(function(a){var b="",c=function(){""==b?m=!1:n+="&secret="+encodeURIComponent(b);u()};have_binary_function("omnikey_get_public_key")?call_binary_function("omnikey_get_public_key",a,function(a){b=a;c()}):c()}):u()}else"1"!=b.silent&&(c={cmd:"setupsinglefactor",result:"error"},"undefined"!=typeof b.callback?b.callback(c):sendCS(a,
c,b.docnum));break;case "checkmultifactorsupport":var y="",B="error",r=function(){var c={cmd:"checkmultifactorsupport",type:y,result:B};"undefined"!=typeof b.callback?b.callback(c):sendCS(a,c,b.docnum)};if(have_binary()){var p=[];call_binary_function_if("nymi_supported",function(a){a&&(p[p.length]="nymi");call_binary_function_if("omnikey_supported",function(a){a&&(p[p.length]="omnikey");call_binary_function_if("winbio_supported",function(a){a&&(p[p.length]="winbio");0<p.length&&(y=p.join(),B="done");
r()})})})}else{if(g_is_win||g_is_mac||g_is_linux)y=g_do_native_messaging&&!g_have_native_messaging_permission&&supports_native_messaging()?"needs_native_messaging":"nobinary";r()}break;case "verifymultifactor":y=b.eventdata1;"winbio"==y?have_binary_function("winbio_verify_user")&&call_binary_function("winbio_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(b){sendCS(a,{cmd:"verifymultifactor",eventdata3:lpenc(b),eventdata2:"done"},b.docnum)}):
"nymi"==y&&have_binary_function("nymi_validate")&&call_binary_function("nymi_validate",function(b){sendCS(a,{cmd:"verifymultifactor",eventdata3:lpenc(b),eventdata2:"done"},b.docnum)});break;case "multifactorauth":var v="",r=function(){sendCS(a,{cmd:"multifactorauth",multifactorresponse:v,result:""!=v?"done":"error"},b.docnum)};if("trueapi"==b.type){var t=SHA256(SHA256(fix_username(b.username)+b.type));if(64!=t.length&&have_binary_function("trueapi_get_hash")){call_binary_function("trueapi_get_hash",
b.username,function(a){t=a;""!=t&&(v=SHA256(t+b.challenge));r()});return}""!=t&&(v=SHA256(t+b.challenge));r()}else"omnikey"==b.type&&omnikey_get_pin(function(a){have_binary_function("omnikey_decrypt")?call_binary_function("omnikey_decrypt",b.challenge,a,function(a){v=a;r()}):r()});break;case "multifactorreprompt":security_prompt(function(){sendCS(a,{cmd:"multifactorauth",result:"done"},b.docnum)},function(){sendCS(a,{cmd:"multifactorauth",result:"error"},b.docnum)});break;case "refresh":lp_url_is_lastpass(b.url)&&
("settings"==b.from?lplogincheck("2"==b.type?"websiterefreshrsa":"websiterefresh"):get_accts());break;case "switchidentity":lp_url_is_lastpass(b.url)&&switch_identity(b.iid,!0,!0);break;case "fillfieldconfirm":b.topurl=g_ischrome?gettaburl(d.sender.tab):gettaburl(d.tab);write_history({cmd:"fillfieldconfirm",tabid:a,url:b.url,aid:b.aid,result:b.result,docnum:b.docnum,manualfill:b.manualfill,allowforce:b.allowforce,name:b.name,force_fillbest:b.force_fillbest});fillfieldsconfirm(b);break;case "deleteaid":d=
"undefined"!=typeof b.fromiframe&&b.fromiframe?1:0;do_experimental_popupfill?deleteAid(b.aid,null,!1,!0,function(){recheckpage(!0)},null,d,a):deleteAid(b.aid,null,!1,!0);break;case "savenotificationhtml":do_experimental_popupfill?"undefined"==typeof g_datacache[a]?g_datacache[a]={html:b.text,extra:b.extra}:(c="",null!=a&&(null!=g_popupfill_hint[a]&&null!=g_popupfill_last_active[a]&&null!=g_popupfill_hint[a][g_popupfill_last_active[a]])&&(c=g_popupfill_hint[a][g_popupfill_last_active[a]]),g_datacache[a]=
{html:b.text,extra:b.extra,popuphtml:g_datacache[a].popuphtml,url:g_datacache[a].url,rowtype:c},g_popupforminput[a]=[],g_popupform_active[a]=0,g_popupform_active_choose[a]=0):g_datacache[a]={html:b.text,extra:b.extra};break;case "savepopupfillhtml":do_experimental_popupfill&&(c=g_ischrome?gettaburl(d.sender.tab):gettaburl(d.tab),verbose_log("received popuphtml from tabid "+a+" url="+b.url+" but using url="+c),g_datacache[a]="undefined"==typeof g_datacache[a]?{popuphtml:b.text,url:c,rowtype:b.rowtype}:
{html:g_datacache[a].html,extra:g_datacache[a].extra,popuphtml:b.text,url:c,rowtype:b.rowtype},g_popupforminput[a]=[],g_popupform_active[a]=0,g_popupform_active_choose[a]=0);break;case "rebuildcontext":rebuildcontext(b.url);break;case "setbadgetext":setbadgetext(b.url);break;case "rebuildcontextonload":rebuildcontextonload();break;case "setbadgetextonload":setbadgetextonload();break;case "runhotkey":if(g_isfirefoxsdk&&(c=getcurrenturl(),ischromeurl(c)&&-1!=c.indexOf("prefs.html")||g_firefox_html_panel&&
g_firefox_html_panel.isShowing&&ischromeurl(g_firefox_html_panel.url)&&-1!=g_firefox_html_panel.url.indexOf("prefs.html")))return;switch(b.hotkey){case "generateHk":opengenpw();break;case "recheckHk":recheckpage();break;case "searchHk":opensearch();break;case "nextHk":fillnext(1);break;case "prevHk":fillnext(-1);break;case "homeHk":openvault();break;case "submitHk":fillnext(0,!0);break;case "saveallHk":saveall();break;case "logoffHk":loggedOut(!1,"hotkey");break;case "defaultffidHk":fill_default_ffid();
break;case "openpopoverHk":buttonclick()}break;case "reporterror":lpReportError(b.e,"");break;case "recheckpage":recheckpage(!0);break;case "copyusername":d="undefined"!=typeof b.fromiframe&&b.fromiframe?1:0;copyusername(b.aid,d,a);break;case "copypassword":d="undefined"!=typeof b.fromiframe&&b.fromiframe?1:0;copypassword(b.aid,null,d,a);break;case "copyurl":d="undefined"!=typeof b.fromiframe&&b.fromiframe?1:0;copyurl(b.aid,d,a);break;case "editprofile":editprofile(b.ffid);break;case "fillformffid":c=
"undefined"!=typeof b.fromiframe?b.fromiframe:0;e=null;if(c&&!frame_and_topdoc_has_same_domain(a)){ftd_report_error(a,"fillform");if(!lpConfirmYesNo(gs("Are you sure you would like your LastPass Form Fill information to be filled into the following site?")+"\n\n"+lp_gettld_url(ftd_get_frameparenturl(a))))return!1;e=!0}fillform(b.ffid,null,null,null,c,e);break;case "addprofile":addprofile();break;case "addcreditcard":addcreditcard();break;case "clearforms":clearforms();break;case "chooseprofilecc":openchooseprofilecc();
break;case "generate":opengenpw();break;case "fillcurrentaid":fillcurrent(b.aid);break;case "generatepasswordfound":g_checkgeneratepasswordcallback&&(g_checkgeneratepasswordcallback(),g_checkgeneratepasswordcallback=null);break;case "log":console_log(b.msg);break;case "disablebtn":c="string"==typeof b.notificationdata?JSON.parse(b.notificationdata):b.notificationdata;openURL(base_url+c.multifactor_disable_url);break;case "createaccountbtn":g_hidecreate||openURL(getchromeurl("welcome.html"));break;
case "tryagainbtn":open_login();break;case "custombtn":openURL(LPJSON.parse(b.notificationdata).customaction);break;case "feedbackbtn":openfeedback();break;case "starttrialbtn":start_trial();break;case "basicauthneverbtn":lpPutUserPref("basicauthnever","1");lpWriteAllPrefs();break;case "basicauthmoreinfobtn":have_binary()?openURL(base_url+"chromebasicauth.php"):install_binary(!1,!0);break;case "gohome":c="";"undefined"!=typeof b.cmd2&&(c="?cmd="+encodeURIComponent(b.cmd2));g_ischrome?chrome.tabs.update(a,
{url:getchromeurl(VaultToggle.getVaultPage()+c)}):g_issafari||g_isfirefoxsdk?d.tab.url=getchromeurl(VaultToggle.getVaultPage()+c):g_isopera?d.tab.update({url:getchromeurl(VaultToggle.getVaultPage()+c)}):g_ismaxthon&&d.tab.navigate(getchromeurl(VaultToggle.getVaultPage()+c));""!=b.email&&""!=b.sesameotp&&(lplog("LOGGING OFF : gohome"),lplogoff(!1,"gohome"),sesame_setotp(b.sesameotp),openURL(getchromeurl("login.html?sesameusername="+encodeURIComponent(b.email))));break;case "checkattach":have_binary_function("choose_file")&&
sendCS(a,{cmd:"canattach"},b.docnum);break;case "getattach":addAttach(function(){var c={};addattachcb(c);if("undefined"!=typeof c.mimetype){var d=enccbc(c.filename,AES.hex2bin(b.attachkey));enccbc(c.bytes,AES.hex2bin(b.attachkey),function(e){sendCS(a,{cmd:"gotattach",mimetype:c.mimetype,bytes:c.bytes,filename:d,encbytes:e},b.docnum)})}});break;case "openattach":openAttach(null,null,null,b.attachkey,b.data,b.mimetype);break;case "saveattach":exportAttachment(null,null,null,b.attachkey,b.data,b.mimetype);
break;case "lpshownotificationtop":sendCS(a,{cmd:"lpshownotification",type:b.type,data:b.data},"all");break;case "getpopupfillsites":if(do_experimental_popupfill){d=b.tld;c=b.url;verbose_log("get ste & form fill data for tld="+d+" url="+c+" docnum="+b.docnum);g=f=e="";if((c=assemble_popup_data_payload(c,d))&&c.sites)e=c.sites;c&&c.favicons&&(f=c.favicons);c&&c.formfills&&(g=c.formfills);sendCS(a,{cmd:"gotpopupfillsites",sites:e,formfills:g,favicons:f},"all")}break;case "getpopupfillforms":break;case "setpopupfilllastactive":g_popupfill_last_active[a]=
b.active;g_popupfill_last_active_fieldid[a]=b.activefieldid;g_popupfill_last_active_fieldtype[a]=b.activefieldtype;"undefined"!=typeof b.ask_generate&&(g_popupfill_hint_generate[a]=b.ask_generate);"undefined"!=typeof b.opentosave&&(g_popupfill_hint_save[a]=b.opentosave);"undefined"!=typeof b.start_type&&(g_popupfill_hint_type[a]=b.start_type);break;case "addnevercrossdomain":lplog("XDOMAIN:Adding addnevercrossdomain url="+b.url);c=lpcanonizeUrl(b.url);n="url="+en(AES.url2hex(c));n+="&type=3";g_neverurls.neverautologins.push(c);
lpMakeRequest(base_url+"add_never.php",n,null,null);g_local_accts_version++;rewritelocalfile();break;case "deletenevercrossdomain":c=b.url;"https://"==c.substring(0,8)?c=c.substring(8):"http://"==c.substring(0,7)&&(c=c.substring(7));lplog("XDOMAIN:Deleting addnevercrossdomain url="+c);e=[];e.type="neverautologins";e.url=c;deleteNever(e,!0);break;case "setpopupfillhint":if(do_experimental_popupfill){if(null==b.formid||""==b.formid)b.formid="none";if(null==b.rowtype||""==b.rowtype)b.rowtype="sites";
null==g_popupfill_hint[a]&&(g_popupfill_hint[a]={});g_popupfill_hint_generate[a]=b.ask_generate?b.ask_generate:!1;g_popupfill_hint[a][b.formid]=b.rowtype;verbose_log("["+a+"] set hint on "+b.formid+" to "+b.rowtype)}break;case "getisadmin":sendCS(a,{cmd:"gotisadmin",isadmin:g_isadmin},b.docnum);break;case "getloggedin":sendCS(a,{cmd:"gotloggedin",lploggedin:lploggedin},b.docnum);break;case "popupfillinputsave":do_experimental_popupfill&&(null==g_popupforminput&&(g_popupforminput={}),null==g_popupforminput[a]&&
(g_popupforminput[a]={}),g_popupforminput[a].value=null==b.inputstr||0==b.inputstr.length?"":b.inputstr,g_popupforminput[a].id=null==b.inputid||0==b.inputid.length?"":b.inputid,g_popupforminput[a].issaveall=null==b.issaveall||0==b.issaveall.length?"":b.issaveall,g_popupforminput[a].inputtype=null==b.inputtype||0==b.inputtype.length?"":b.inputtype);break;case "popupregister":do_experimental_popupfill&&(g_popup_tab_docnum[a]=b.docnum,g_popup_url_by_tabid[a]=null!=a&&"undefined"!=typeof g_iframe_hack_src[a]?
g_iframe_hack_src[a]:b.url);break;case "getnevers":handleGetNevers(a,b.url);break;case "popupfillresize":doPopupResize(a,b.width,b.height);break;case "popupfilliconnumber":null==b&&(e=c=-1);c=null==b.sitenumber?-1:parseInt(b.sitenumber);e=null==b.formfillsnumber?-1:parseInt(b.formfillsnumber);doPopupIconHint(a,c,e);break;case "popupfillinputfocusdecrement":do_experimental_popupfill&&(c=1,"undefined"==typeof g_popupform_active[a]&&(g_popupform_active[a]=0),"undefined"!=typeof b.count&&(e=parseInt(b.count),
isNaN(e)||(c=e)),g_popupform_active[a]-=c);break;case "popupfillinputfocusincrement":do_experimental_popupfill&&(c=1,"undefined"==typeof g_popupform_active[a]&&(g_popupform_active[a]=0),"undefined"!=typeof b.count&&(e=parseInt(b.count),isNaN(e)||(c=e)),g_popupform_active[a]+=c);break;case "popupfillinputfocuschoose":do_experimental_popupfill&&(g_popupform_active_choose[a]=1);break;case "popupfillinputmoreopen":do_experimental_popupfill&&(g_popupform_more_open[a]=1);break;case "editaid":editAid(b.aid);
break;case "openchooseprofilecc":openchooseprofilecc();break;case "popupfillinputshownavbar":g_popupform_shownavbar[a]=1;break;case "iframescrollenable":sendCS(a,{cmd:"iframescrollenable",href:b.href},g_CS_tops[a]);verbose_log("set scrolling=auto for iframe on tabid "+a);sendCS(a,{cmd:"iframebodyscrollenable",href:b.href},"all");break;case "dologinaction":lploggedin||open_login();break;case "deleteformfill":d="undefined"!=typeof b.fromiframe&&b.fromiframe?1:0;deleteformfill(b.ffid,null,d,a);break;
case "setboolpref":b.includeuser?lpPutUserPref(b.name,b.value):lpPutGblPref(b.name,b.value);lpWriteAllPrefs();break;case "request_native_messaging":openURL(getchromeurl("native_messaging.html?hidenever=1"));break;case "checkduo":"undefined"!=typeof b.uuid&&(b.uuid&&""!=b.uuid)&&setuuid(b.uuid);closecurrenttab("duo.php");outofband_auth("checkduo"+encodeURIComponent(b.code),"");break;case "closepopuptoplevel":closepopuptoplevel_handler(a,b);break;case "createpopuptoplevelfromframe":createpopuptoplevel_handler(a,
b);break;case "cpwbot_click_ack":g_cpwbot&&CPWbot_bg&&CPWbot_bg.push_event_queue("click_ack",a,b);break;case "cpwbot_fill_ack":g_cpwbot&&CPWbot_bg&&CPWbot_bg.push_event_queue("fill_ack",a,b);break;case "cpwbot_finish_ack":g_cpwbot&&CPWbot_bg&&(g_v2engine&&!CPWbot_bg.in_bagration()&&!CPWbot_bg.get_okstate()&&!CPWbot_bg.get_failstate()?CPWbot_bg.push_event_queue("finish_ack",a,b):CPWbot_bg.cpwbot_finish_ack_handler(a,b));break;case "cpwbot_validate_state_result":g_cpwbot&&CPWbot_bg&&CPWbot_bg.push_event_queue("validate_response",
a,b);break;case "ping_ack":ping_ack_handler(a,b);break;case "got_inner_text":got_inner_text_handler(a,b);break;case "got_inner_html":got_inner_html_handler(a,b);break;case "CS_unload":e=b.docnum;c=b.url;f=b.docstate;write_history({cmd:"CS_unload",docnum:e,tabid:a,docstate:f});L("received CS_unload from [tabid:"+a+"][docnum:"+e+"] docstate="+f+" url="+c);null===e&&(e=find_docnum_for_tabid_by_url(a,c),L("CS_unload guessing assigned docnum to "+c+" is "+e),b.docnum=e);delete_cs_for_docnum(a,e);g_cpwbot&&
CPWbot_bg&&(L("CS_unload clear score [tabid:"+a+"][docnum:"+e+"]"),CPWbot_bg.clear_frame_score(a,e,null),CPWbot_bg.push_event_queue("unload",a,b));g_CS_tops&&g_CS_tops[a]===e&&clear_popup_heartbeat(a);break;case "cpwbot_js_ack":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.js_ack_handler(a,b),CPWbot_bg.push_event_queue("js_ack",a,b));break;case "minimize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=1);break;case "maximize_cpw_dialog":g_cpwbot&&CPWbot_bg&&(CPWbot_bg.cpw_dialog_minimize_state=
0);break;case "copytoclipboard":"undefined"!==typeof b.g_data&&copytoclipboard(b.g_data);break;case "debug_checkpoint":debug_checkpoint_handler(a,b);break;case "support_pwchg":if(!lploggedin)return!1;sendCS(a,{cmd:"support_pwchg",support:g_cpwbot,answer_loc:b.answer_location},g_CS_tops[a]);break;case "support_pwchg_batch":if(!lploggedin)return!1;sendCS(a,{cmd:"support_pwchg_batch",support:g_cpwbot_batch,answer_loc:b.answer_location},g_CS_tops[a]);break;case "auto_pwchg":if(!lploggedin)return!1;g_cpwbot&&
lp_url_is_lastpass(b.url)&&(g_cpw_server_initiated_tabid=a,b.keep_in_frame?start_pwchange_from_server(a,b.aid):editAid(b.aid,null,!1,1));break;case "auto_pwchg_batch_alive":if(!lploggedin)return!1;if("undefined"==typeof g_batchpagealive)return;g_batchpagealive=!0;break;case "auto_pwchg_batch":if(!lploggedin)return!1;g_cpwfast=!0;if(g_cpwbot&&lp_url_is_lastpass(b.url)){CPWbatch||(CPWbatch=new CPWbatch_lib);b.n&&(c=parseInt(b.n),isNaN(c)||(CPWbatch.m_max_workers=c));c={};try{c=JSON.parse(b.aids)}catch(A){c=
{},console.error("JSON error, auto_pwchg_batch: "+A)}for(f in c)c.hasOwnProperty(f)&&CPWbatch.cpw_queue_push(c[f]);g_cpw_server_initiated_tabid=a;b.keep_in_frame?CPWbatch.cpw_batch_begin():pass}break;case "kill_batch_background":if(!lploggedin)return!1;CPWbatch&&CPWbatch.cpw_batch_end();break;case "auto_pwchg_hide":if(!lploggedin)return!1;g_cpwbot&&CPWbatch&&(end_pwchange_from_server(a,b.aid),CPWbatch.cpw_get_batchjob_state()&&CPWbatch.cpw_batch_end());break;case "auto_pwchg_status_update_ack":if(!lploggedin)return!1;
g_cpwbot&&CPWbatch&&CPWbatch.cpw_set_status_update_ack();break;case "clear_popup_heartbeat":clear_popup_heartbeat(a);break;case "got_generate_pattern":c=b.pattern_cooked;e=b.desc_cooked;g=f="";c&&(f=JSON.parse(c));e&&(g=JSON.parse(e));g_generate_pw_pattern_hints[a]={pattern:f,desc:g};break;case "get_browser_history_tlds":get_browser_history_tlds(function(b){sendCS(a,{cmd:"got_browser_history_tlds",tlds:b.join()},g_CS_tops[a])});break;case "starttrial":start_trial()&&sendCS(a,{cmd:"trialstarted"},
g_CS_tops[a]);break;case "from_selenium":g_cpwbot&&(!g_is_selenium&&CPWbot_bg&&CPWbot_bg.userlog(0,"Detected Selenium"),write_history({cmd:"SELENIUM",tabid:a,docnum:b.docnum,url:b.url,docstate:b.docstate,msg:"Selenium Bits: "+f}),g_is_selenium=!0,"undefined"!=typeof b.bits&&(f=parseInt(b.bits),isNaN(f)||(g_selenium_bits!=f&&CPWbot_bg.userlog(0,"Selenium Bits: "+f),g_selenium_bits=f)));break;case "resizeIframe":case "moveIframe":a&&("undefined"!=typeof g_iframe_hack_src[a]?sendCS(a,b,g_CS_tops[a]):
sendCS(a,b,"all"));break;case "get_plugin_capabilities":get_plugin_capabilities_handler(a);break;default:return L("CS["+a+"] -> BG : INVALIDMSG"),!1}return!0}
function open_login(a,b){skiplogin()||getsinglefactortype(function(d){if(!b&&"trueapi"==d&&have_binary_function("trueapi_default_login_exists"))call_binary_function("trueapi_default_login_exists",function(b){b?call_binary_function("trueapi_get_default_login",function(b){if(""!=b){var c=b.split("|");if(3==c.length){b=atob(c[0]);var e=atob(c[1]),c=atob(c[2]);multifactor_setdata("password_offline",c);multifactor_setdata("type",d);g_manual_login=!0;LP_do_login(b,e,null,null,!0);return}}open_login(a,!0)}):
open_login(a,!0)});else if(!b&&(LPISUPEK||"vtapi"==d)&&have_binary_function("lpvt_verify_user")){var c=encodeURIComponent(lpCreatePass(8,1,1,1,0,1,0,1));call_binary_function("lpvt_verify_user",c,gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),gs("Swipe current user's finger"),function(b){if(""!=b&&(b=b.split("|"),2==b.length)){g_manual_login=!0;LP_do_login(decodeURIComponent(b[0]),decodeURIComponent(b[1]));return}LPISUPEK&&LPISLOC?call_binary_function("lpvt_has_data",
function(a){a?lpshowError("LoginError",!1,!0):lpshowError("Before you can use LastPass, you must first connect your fingerprint reader and enroll one or more fingers.",!1,!0)}):open_login(a,!0)})}else if(!b&&"validity"==d&&have_binary_function("validity_verify_user"))call_binary_function("validity_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(b){if(""!=b&&(b=b.split("|"),2==b.length)){g_manual_login=!0;LP_do_login(decodeURIComponent(b[0]),
decodeURIComponent(b[1]));return}open_login(a,!0)});else if(!b&&"winbio"==d&&have_binary_function("winbio_verify_user"))call_binary_function("winbio_verify_user","",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(b){if(""!=b&&(b=b.split("|"),2==b.length)){g_manual_login=!0;LP_do_login(decodeURIComponent(b[0]),decodeURIComponent(b[1]));return}open_login(a,!0)});else if(!b&&"nymi"==d&&have_binary_function("nymi_validate"))call_binary_function("nymi_validate",
function(b){if(""!=b&&(b=b.split("|"),2==b.length)){g_manual_login=!0;LP_do_login(decodeURIComponent(b[0]),decodeURIComponent(b[1]));return}open_login(a,!0)});else{try{if(g_issafari&&"undefined"!=typeof SafariExtensionPopover)for(var c=safari.application.activeBrowserWindow,e=0;e<safari.extension.toolbarItems.length;e++){var f=safari.extension.toolbarItems[e];if(c==f.browserWindow&&-1!=f.identifier.indexOf("LPToolButton")){if(VaultToggle.useVault4_0()){if(f.popover){var g=f.popover.identifier;f.popover=
null;safari.extension.removePopover(g)}f.popover=safari.extension.createPopover("extensionLogin",safari.extension.baseURI+"extensionLogin.html")}else f.popover.width=310,f.popover.height=380,f.popover.contentWindow.showwin(f.popover.width,f.popover.height,getchromeurl("login.html?inline=1"));f.showPopover();return}}}catch(h){g_can_open_popover=!1}g_isfirefoxsdk&&"undefined"!=typeof g_panel?open_login_panel():VaultToggle.useVault4_0()?LPPlatform.openTabDialog("login"):openURL(getchromeurl("login.html"))}})}
function open_login_panel(){g_firefox_login_panel=g_panel.Panel({width:400,height:g_is_linux?425:400,contentURL:getchromeurl("login.html?skip_pagemod=1&inline=1"),contentScriptFile:self.data.url("message_shim.js"),contentScriptWhen:"start",onHide:function(){g_firefox_button.state("window",{checked:!1});closePop()},contextMenu:!0});g_firefox_login_panel.port.on("message",function(a){a.target=g_firefox_login_panel;message_handler(a)});g_firefox_login_panel.show({position:g_firefox_button})}
function closePop(){if(g_issafari&&"undefined"!=typeof SafariExtensionPopover)for(var a=0;a<safari.extension.toolbarItems.length;a++)-1!=safari.extension.toolbarItems[a].identifier.indexOf("LPToolButton")&&safari.extension.toolbarItems[a].popover.hide();else g_isfirefoxsdk&&(g_firefox_login_panel&&(g_firefox_login_panel.destroy(),g_firefox_login_panel=null),g_firefox_panel&&(g_firefox_preload_menu?g_firefox_panel.hide():(g_firefox_panel.destroy(),g_firefox_panel=null)))}
function fillnext(a,b){lploggedin?get_selected_tab(null,function(d){var c=getBG();c.setcurrenttabid(gettabid(d));c.setcurrenturl(gettaburl(d));d=getmatchingsites(1);if(0<d.length){for(c=0;c<d.length&&d[c].aid!=g_curr_fill_aid;c++);c==d.length?g_curr_fill_aid=-1==a?d[d.length-1].aid:d[0].aid:(1==a?++c>=d.length&&(c=0):-1==a&&0>--c&&(c=d.length-1),g_curr_fill_aid=d[c].aid);b?fill({tabid:getcurrenttabid(),acct:g_sites[g_curr_fill_aid],docid:null,submit:!0,doconfirm:!1,docnum:"all",allowforce:!1,skip_pwprotect:!1,
manualfill:!0,desc:"fill_A1"}):fillaid(g_curr_fill_aid)}}):open_login()}function getInt(a){a=parseInt(a);if(""==a||NaN==a)a=0;return a}
function loggedIn(a){L("BG : loggedIn");lploggedin=!0;server_tries=0;lpReadAllPrefs(postlogin);if("undefined"!=typeof localStorage){var b=localStorage.getItem(db_prepend("lastversion")),d=!1;localStorage_setItem(db_prepend("lastversion"),lpversion)||(d=!0);d||checkOpenUpgradePage(b);b=opendb();createSavedLoginsTable(b);b&&(g_indexeddb?b.transaction("LastPassSavedLogins2","readonly").objectStore("LastPassSavedLogins2").openCursor(IDBKeyRange.only(g_username)).onsuccess=function(a){a.target.result&&
""!=a.target.result.value.password&&(g_master_password_saved=!0)}:b.transaction(function(a){a.executeSql("SELECT * FROM LastPassSavedLogins2 WHERE username = ? AND password != ''",[g_username],function(a,b){0<b.rows.length&&(g_master_password_saved=!0)},function(){})}));a&&setTimeout(function(){refresh_windows()},500);CPWbot_bg=new CPWbot_bg_lib;drawIconAtRotation(0);sendTS({cmd:"login"})}}
function checkOpenUpgradePage(a){if(g_showupgradenotes){var b=lpversion,d=0,c=0,e=0,f=0;if(a)for(var g=a.split("."),h=0;h<g.length;h++)0==h?d=parseInt(g[h]):1==h?c=parseInt(g[h]):2==h&&parseInt(g[h]);b=b.split(".");for(h=0;h<b.length;h++)0==h?e=parseInt(b[h]):1==h?f=parseInt(b[h]):2==h&&parseInt(b[h]);if(a&&"null"!=a&&(e>d||f>c))L("Lastversion: "+a+" this version: "+lpversion+" amaj:"+d+" aminor:"+c+" bmaj:"+e+" bminor:"+f),openURL(base_url+"upgrade.php?ver="+lpversion+"&lastver="+a+"&type="+encodeURIComponent(get_method())+
"&upgrade="+a)}}function get_searchNotesPref(){return 1==lpGetPref("searchNotes",1)?!0:!1}
function postlogin(){g_lastpollcheck=lastlogin=(new Date).getTime();1==lpGetPref("logoffWhenCloseBrowser",0)&&0<lpGetPref("logoffWhenCloseBrowserVal",0)&&(lpPutUserPref("lastpollcheck",g_lastpollcheck),lpWriteAllPrefs());if(g_offer_popupfill&&(do_experimental_popupfill=1==lpGetPref("usepopupfill",1))&&0==lpGetPref("changedpopupfill",0))lpPutUserPref("showFormFillNotifications",0),lpPutUserPref("showFillNotificationBar",0),lpPutUserPref("showGenerateNotifications",0),lpPutUserPref("showNotificationsAfterClick",
0),lpPutUserPref("changedpopupfill",1),lpWriteAllPrefs()}function lplogin(){open_login()}function lplogoff(a,b){loggedOut(!1,"undefined"!=typeof b?b:"lplogoff")}function lplogoff_if(){lploggedin&&loggedOut(!1,"lplogoff_if")}var rotation=0,numrotations=0,currrotation=0;function animateFlip(){rotation+=1/36;1<=rotation&&(rotation-=1);++currrotation>=numrotations?rotation=0:setTimeout(function(){animateFlip()},10);drawIconAtRotation(rotation)}
var ICON_GRAY=0,ICON_RED=1,ICON_GREEN=2,ICON_YELLOW=3,ICON_BREACH=4,ICON_GRAY_CHROME=5,ICON_RED_CHROME=6,ICON_GREEN_CHROME=7,ICON_YELLOW_CHROME=8,ICON_BREACH_CHROME=9;
function get_icon(a){switch(parseInt(lpGetPref("Icon",0))){case 1:return a!=ICON_GRAY?"images/icon2_alt.gif":"images/icon_gray2_alt.gif";case 2:return a!=ICON_GRAY?"images/icon3.gif":"images/icon_gray3.gif";case 3:return a!=ICON_GRAY?"images/icon4.gif":"images/icon_gray4.gif";case 4:return a!=ICON_GRAY?"images/icon5.gif":"images/icon_gray5.gif";case 5:return a!=ICON_GRAY?"images/icon6.gif":"images/icon_gray6.gif";case 6:return a!=ICON_GRAY?"images/icon7.png":"images/icon_gray7.png";default:switch(a){case ICON_GRAY:return g_isopera?
"icon_gray2_opera.png":"icon_gray2.png";case ICON_GRAY_CHROME:return g_isopera?"icon_gray2.png":"icon_gray2@2x.png";case ICON_RED:return g_isopera?"icon2_opera.png":"icon2.png";case ICON_RED_CHROME:return g_isopera?"icon2_opera.png":"icon2@2x.png";case ICON_GREEN:return"icon_green2.png";case ICON_GREEN_CHROME:return"icon_green2@2x.png";case ICON_YELLOW:return"icon_yellow2.png";case ICON_YELLOW_CHROME:return"icon_yellow2@2x.png";case ICON_BREACH:return"images/breach.png";case ICON_BREACH_CHROME:return"images/breach.png"}}}
function drawIconAtRotation(){if(!is_guiless())if(g_issafari){for(var a=0;a<safari.extension.toolbarItems.length;a++)-1!=safari.extension.toolbarItems[a].identifier.indexOf("LPToolButton")&&(safari.extension.toolbarItems[a].image=lploggedin&&g_badgedata&&"notification"==g_badgedata.cmd&&"alert"==g_badgedata.type?getchromeurl(6>get_safari_version()?"icon_breach_safari_16px.png":"icon_breach_safari.png"):lploggedin&&g_badgedata&&"notification"==g_badgedata.cmd&&"lpalert"==g_badgedata.type?getchromeurl(6>
get_safari_version()?"icon_breach_safari_16px.png":"icon_breach_safari.png"):g_badgedata&&"notification"==g_badgedata.cmd&&"error"==g_badgedata.type?getchromeurl(6>get_safari_version()?"icon_breach_safari_16px.png":"icon_breach_safari.png"):6>get_safari_version()?getchromeurl(lploggedin?"icon_on_16px.png":"icon_off_16px.png"):getchromeurl(lploggedin?"icon_on.png":"icon_off.png"));update_menus()}else if(g_isopera)setTimeout(function(){lploggedin?g_opera_button.icon!=get_icon(ICON_RED)&&(g_opera_button.icon=
get_icon(ICON_RED),g_opera_button.popup.width="450px",g_opera_button.popup.height="450px",g_opera_button.popup.href=getchromeurl("lp_toolstrip.html?browseraction=1")):g_opera_button.icon!=get_icon(ICON_GRAY)&&(g_opera_button.icon=get_icon(ICON_GRAY),g_opera_button.popup.width="1px",g_opera_button.popup.height="1px",g_opera_button.popup.href=getchromeurl("lp_toolstrip.html?browseraction=1"))},0);else if(g_ismaxthon)window.external.mxGetRuntime().icon.setIconImage(lploggedin?"icon":"icon_gray");else if(g_isfirefoxsdk)g_firefox_button&&
(g_firefox_button.icon=null!=g_badgedata?"notification"==g_badgedata.cmd&&"save"==g_badgedata.type?self.data.url(get_icon(ICON_GREEN)):"notification"==g_badgedata.cmd&&"lpalert"==g_badgedata.type?self.data.url(get_icon(ICON_BREACH)):self.data.url(get_icon(ICON_YELLOW)):lploggedin?self.data.url(get_icon(ICON_RED)):self.data.url(get_icon(ICON_GRAY)));else if(!g_iscasper){var b;null!=g_badgedata?"notification"==g_badgedata.cmd&&"save"==g_badgedata.type?(b=get_icon(ICON_GREEN_CHROME),a=get_icon(ICON_GREEN)):
"notification"==g_badgedata.cmd&&"alert"==g_badgedata.type?(a=get_icon(ICON_YELLOW),b=get_icon(ICON_YELLOW_CHROME)):"notification"==g_badgedata.cmd&&"lpalert"==g_badgedata.type?(a=get_icon(ICON_BREACH),b=get_icon(ICON_BREACH_CHROME),set_badge_text("")):(a=get_icon(ICON_YELLOW),b=get_icon(ICON_YELLOW_CHROME)):lploggedin?(a=get_icon(ICON_RED),b=get_icon(ICON_RED_CHROME)):(a=get_icon(ICON_GRAY),b=get_icon(ICON_GRAY_CHROME));chrome.browserAction.setIcon({path:{19:a,38:b}});"function"==typeof chrome.browserAction.setPopup&&
getsinglefactortype(function(a){chrome.browserAction.setPopup({popup:!g_ask_native_messaging_from_button&&(lploggedin||null!=g_badgedata||""==a&&1==lpGetPref("enablenewlogin",1))?VaultToggle.useVault4_0()?"extensionLogin.html":"lp_toolstrip.html?browseraction=1":""})})}}function ease(a){return(1-Math.sin(Math.PI/2+a*Math.PI))/2}
function lpAddRejectedSite(a,b,d){var c=new lpobjrejectedaddsite;c.username=a;c.encryptedPassword=lpenc(b);c.tld=d;c.rejectedTime=lp_get_gmt_timestamp();g_rejectedaddsites[g_rejectedaddsites.length]=c}
function loggedOut(a,b){L("BG : loggedOut from="+b);var d=lpGetPref("clearfilledfieldsonlogoff",0);g_manual_login=!1;get_all_windows({populate:!0},function(a){for(var b=0;b<a.length;b++)for(var c=0;c<get_tabs_length(a[b]);c++){var d=gettaburl(get_tabs(a[b])[c]);d&&(lp_url_is_lastpassext(d)&&-1==d.indexOf(VaultToggle.getVaultPage())&&-1==d.indexOf("welcome.html")&&-1==d.indexOf("mathfail.html")&&-1==d.indexOf("login.html")&&-1==d.indexOf("native_messaging.html"))&&close_tab(get_tabs(a[b])[c])}});lploggedin&&
lpnp_notify("logout");notifications_closeall();closeallnotifications();closeallclickables();deleteallattachments(!0);yubikey_cleardata();googleauth_cleardata();outofband_cleardata();securityquestion_cleardata();sesame_cleardata();grid_cleardata();multifactor_cleardata();lpSaveData("","key");var c=!1;lploggedin||(c=!0);lploggedin=!1;last_idle_check=0;lpmpstrength=lpusername_hash=g_username_hash=lphash=g_username=lpusername=g_local_key_hash=g_local_hash=lphash=g_local_key_hex=g_local_key=null;lpsendchallengescore=
lpsendmpstrength=!1;g_pwdeckey=g_uid=lpuid=null;g_sites=[];g_tlds=[];g_securenotes=[];g_applications=[];g_prompts=[];g_icons=[];g_bigicons=[];g_multifactorscore=g_icons_length=0;lp_local_attach_version=lp_server_attach_version=g_server_accts_version=g_local_accts_version=g_disablepwalerts=-1;g_identities=[];g_pendings=[];g_shareeautopushes=[];g_formfills=[];g_neverurls=[];g_equivalentdomains=[];g_urlrules=[];g_prefoverrides=[];g_showcredmon=g_iscompanyadmin=g_isadmin=g_loglogins=!1;g_launches=[];
g_fillfieldsmatches=[];g_fillfieldsmatchescurridx=[];g_loggedinonline=g_loggedinoffline=!1;lp_phpsessid="";g_enterpriseuser=g_premium_exp=0;g_loginstarted=!1;lpReadAllPrefs();rotation=0;drawIconAtRotation();null!=g_badgedata&&("notification"!=g_badgedata.cmd||"error"!=g_badgedata.type)&&clear_badge();rsa_clearvars();rsa_setpendingsharests(!0);g_genpws=[];g_master_password_saved=!1;g_persistent_notifications=[];g_rejectedaddsites=[];g_shares=[];lp_attaches=[];g_datacache=[];lpdisableoffline=!1;countryfromip=
"";g_flags={};g_privkeyattempts=0;sendTS({cmd:"logoff"});g_generate_pw_pattern_hints={};g_popupfill_hint={};g_popupfill_hint_generate={};g_popupfill_hint_save={};g_popupfill_hint_type={};g_popupfill_last_active={};g_popupfill_last_active_fieldid={};g_popupfill_last_active_fieldtype={};g_popup_tab_docnum=[];g_popup_url_by_tabid=[];g_iframe_hack_src=[];g_pending_pw_change={};OVERRIDENOREFRESH=!0;c||setTimeout(function(){refresh_windows(OVERRIDENOREFRESH)},500);a||lpMakeRequest(base_url+"logout.php?chrome_plugin=1&noredirect=1",
"",null,null);"undefined"!=typeof g_oldpbkdf2&&(g_oldpbkdf2=0);update_menus(!0);0!=d&&clear_all_filled_fields();g_fillfield_confirm_perfield={};g_fillfield_did_fillbest={};g_popupfill_hint={};g_popupfill_hint_generate={};g_popupfill_hint_save={};g_popupfill_last_active={};g_popupfill_last_active_fieldid={};g_popupfill_last_active_fieldtype={};g_popupfill_save_data={};g_popupforminput=[];g_cpwbot&&(CPWbot_bg&&"object"==typeof CPWbot_bg)&&(CPWbot_bg.logout(),CPWbot_bg=null);g_cpw_server_initiated_tabid=
null;g_cpw_aid_queue=[];g_cpwbot&&(CPWbatch&&"object"==typeof CPWbatch)&&(CPWbatch.cpw_set_batchjob_state(F_NONE),CPWbatch.logout(),CPWbatch=null);cleardeccache();clear_badge_text();shutdown_push_listener()}var g_last_openattach=0;function deleteallattachments(a){have_binary_function("delete_files_by_extension")&&(a||lp_get_gmt_timestamp()>g_last_openattach+25)&&call_binary_function("delete_files_by_extension","","*",!0)}function getmenurowheight(){return 20}
function getmatchingsitesheight(a){a=a.length*getmenurowheight();200<a&&(a=200);return a}function getmenuheight(a,b,d,c){var e=15;(g_premium_exp>lp_get_local_timestamp()||g_enterpriseuser)&&--e;var f=getmenurowheight(),e=e*f;if("undefined"==typeof a||a)a=getmatchingsites(),0<a.length&&(e=e+f+getmatchingsitesheight(a));if("undefined"==typeof b||b)e+=32;if("undefined"==typeof d||d)e+=15;c&&(e-=50);return e}
function fillaid(a,b){if(!g_sites||!lploggedin)return!1;write_history({cmd:"fillaid",aid:a});var d=b?!0:!1;g_last_launch[a]=(new Date).getTime();var c=g_sites[a];return"undefined"!=typeof c&&c&&"1"==c.basic_auth?(setTimeout(function(){fill({tabid:getcurrenttabid(),acct:g_sites[a],docid:null,submit:!1,doconfirm:!0,docnum:"all",allowforce:!0,skip_pwprotect:d,manualfill:!0,desc:"fill_A2"})},100),!0):fill({tabid:getcurrenttabid(),acct:g_sites[a],docid:null,submit:!1,doconfirm:!0,docnum:"all",allowforce:!0,
skip_pwprotect:d,manualfill:!0,desc:"fill_A3"})}function setcurrenturl(a){g_currenturl=a}function setcurrenttabid(a){g_currenttabid=a}function getmatchingsites(a,b,d){var c=getcurrenturl();lpcanonizeUrl(c);a=lp_gettld_url(c);a=getsites(a);a=reorderOnURL(a,c,b,d);var e;b=[];for(e in a)d=a[e].aid,"undefined"!=typeof g_sites[d]&&(d=g_sites[d],b.push({aid:d.aid,name:d.name,username:getusernamefromacct(d),fiid:d.fiid}));return b}
function getnevers(){var a=getcurrenturl(),b=lp_gettld_url(a),a=lpcanonizeUrl(a),d=[];getneverfor(d,"neveraccounts",a,b);getneverfor(d,"neverautologins",a,b);getneverfor(d,"neverformfills",a,b);getneverfor(d,"nevergenerates",a,b);getneverfor(d,"neverautofills",a,b);getneverfor(d,"nevershowicons",a,b);getneverfor(d,"neverenablelp",a,b);return d}
function getneverfor(a,b,d,c){if(g_neverurls[b]&&0<g_neverurls[b].length)for(var e=0;g_neverurls[b]&&e<g_neverurls[b].length;e++){var f=g_neverurls[b][e];f==d?a.push({type:b,url:f,domain:0}):f==c&&a.push({type:b,url:f,domain:1})}}
function getsites(a,b,d){var c;if("undefined"==typeof a||null===a||"undefined"==typeof g_equivalentdomains||null===g_equivalentdomains)return[];"undefined"!=typeof g_equivalentdomains[a]?(a=g_equivalentdomains[a],"undefined"!=typeof g_equivalentdomains[a]&&(c=g_equivalentdomains[a])):c=Array(a);a=[];if("undefined"!==typeof c)for(var e=0;e<c.length;e++)if("undefined"!=typeof g_tlds[c[e]])for(var f in g_tlds[c[e]])if("undefined"!=typeof g_sites[f]){if(b){if(g_sites[f].genpw)continue;var g=issharedfolder(g_shares,
g_sites[f].group);if(!checkreadonly(g,!0))continue}check_ident_aid(g_sites[f].aid)&&(d&&g_sites[f].aid==d||d&&-1!=d.indexOf(","+g_sites[f].aid+",")||(a[f]=g_tlds[c[e]][f]))}return a}function accthaspassword(a){if(!a)return!1;if(a.save_all){for(var b=0;b<a.fields.length;b++)if("password"==a.fields[b].type&&""!=a.fields[b].value)return!0;return!1}return""!=a.password}
function lp_url_is_lastpass(a,b){if(null==a||g_skipurltest&&b)return!1;if(0==a.indexOf(base_url)||0==a.indexOf("https://lastpass.com/"))return!0;if("undefined"!=typeof g_loosebasematching){var d=lp_gettld_url(a);return RegExp(d+"/$").test(base_url)}return/^https:\/\/([a-z0-9-]+\.)?lastpass\.(eu|com)\//i.test(a)}function lp_url_is_lastpassext(a){var b=getchromeurl("");return a&&0==a.indexOf(b)?!0:!1}
function openvault(a){if(!a&&!lploggedin)open_login();else{var b=""==g_vaulturloverride?getchromeurl(VaultToggle.getVaultPage()):g_vaulturloverride;a?get_all_windows({populate:!0},function(a){for(var c=0;c<a.length;c++)for(var e=0;e<get_tabs_length(a[c]);e++)if(gettaburl(get_tabs(a[c])[e])==b)return;openURL(b)}):openURL(b)}}
function openurlifnotopen(a){get_all_windows({populate:!0},function(b){for(var d=0;d<b.length;d++)for(var c=0;c<get_tabs_length(b[d]);c++)if(gettaburl(get_tabs(b[d])[c])==a)return;openURL(a)})}
function openimport(){if(lploggedin)if((g_is_win||g_is_mac||g_is_linux)&&have_binary_function("choose_file")){var a;openURL(getchromeurl("import_other.html"))}else unlock_plug2web(),a=base_url+"import.php?hasplugin="+LP.en(lpversion)+get_identity_param(),lppassusernamehash&&(a=base_url+"gettopost.php?posturl="+LP.en(a)),openURL(a)}function csv_encode(a){if("string"!=typeof a)return"";a.match(/,|\r|\n|"/)&&(a='"'+a.replace(/"/g,'""')+'"');return a}
function doimport(a,b){var d=function(c){lpimportdata=c;""!=lpimportdata&&null!=lpimportdata?(lpimportsource=a,unlock_plug2web(),c=base_url+"import.php?fromplugin=1"+get_identity_param(),lppassusernamehash&&(c=base_url+"gettopost.php?posturl="+LP.en(c)),openURL(c)):b&&alertfrombg(gs("That file is missing or empty.  Please enter the full path of the file to import."))};"wlan"==a?(a="csv",call_binary_function("wlan_pull_csv",d)):"safari"==a?(a="csv",call_binary_function("get_safari_passwords",d)):"opera"==
a?(a="csv",call_binary_function("get_opera_passwords",d)):"firefox"==a?(a="csv",g_passwords.search({onComplete:function(a){for(var b="url,username_field,username,password_field,password\n",f=0;f<a.length;f++)b+=csv_encode(a[f].url?a[f].url:"")+","+csv_encode(a[f].usernameField?a[f].usernameField:"")+","+csv_encode(a[f].username?a[f].username:"")+","+csv_encode(a[f].passwordField?a[f].passwordField:"")+","+csv_encode(a[f].password?a[f].password:"")+"\n";d(b)}})):b?call_binary_function("read_file",
b,!0,d):call_binary_function("choose_file",null,null,null,!0,function(a){a&&(a=atob(a));d(a)})}function openimportchrome(){openURL(getchromeurl("import.html"))}function openexport(){lploggedin&&doexport()}
function wlanexport(a){if(1==lpGetPref("noexport",0))alertfrombg(gs("CompanyPolicyProhibits"));else if(have_binary())if(g_wlan_works)if(!g_generatedpw&&!a)security_prompt(function(){wlanexport(!0)});else{a="";for(var b in g_securenotes)if(check_ident_aid(b)){var d=lpmdec_acct(g_securenotes[b].extra,!0,g_securenotes[b],g_shares);"Wi-Fi Password"==getNoteValue("NoteType",d)&&(a+=d+"\n\n")}""!=a&&(loglogin("export"),call_binary_function("wlan_push",a))}else g_wlan_has_exe?alertfrombg(gs("No Wi-Fi adapter was detected on this computer.  This feature requires a Wi-Fi adapter.")):
confirm(gs("The LastPass Wi-Fi utility was not detected on this computer.  Would you like to run the LastPass Universal Installer in order to install it?"))&&openbaseurl("installer/");else confirm(gs("This feature requires the binary version of this browser extension.  Would you like to install it now?"))&&install_binary()}
function openlastpassexport(a){1==lpGetPref("noexport",0)?alertfrombg(gs("CompanyPolicyProhibits")):have_binary_function("write_file")&&have_binary_function("get_path")?!g_generatedpw&&!a?security_prompt(function(){openlastpassexport(!0)}):(a=rewritelocalfile(!1,!0,!0),loglogin("export"),can_save_file()?call_binary_function("save_file",a,gs("XML Files"),"*.xml",!1,"xml",gs("If not specified, will use a file extension of:")):(call_binary_function("write_file","lpexport.xml",a),call_binary_function("get_path",
function(a){alertfrombg(gs("Your data has been exported to")+"\n"+a+"lpexport.xml")}))):alertfrombg(gs("The binary version of the LastPass plugin is required for this operation. It can be downloaded from lastpass.com."))}function openprint(a){unlock_plug2web();var b=base_url+"export.php?plug=1&print=1&hasplugin="+LP.en(lpversion)+get_identity_param();a&&(b+="&notes=1");lppassusernamehash&&(b=base_url+"gettopost.php?posturl="+LP.en(b));openURL(b)}g_pref_tab=null;
function openprefs(a){a&&(g_pref_tab=a);openURL(getchromeurl(g_isopera?"options.html":"prefs.html"))}function openhelp(){openURL(g_helpurl)}function openpremium(){openURL(base_url+"premium.php")}function openentconsole(){openURL(base_url+"enterprise_home.php")}
function openall(a,b){var d=null;if(a==gs("favorites"))openfavorites();else if(a==gs("recently usedlower"))openallrecent();else{var c=[],e=!1,f;for(f in g_sites)check_ident_aid(g_sites[f].aid)&&(g_sites[f].group==a&&"http://group"!=g_sites[f].url)&&(c.push(g_sites[f]),e|=g_sites[f].pwprotect,null==d&&g_sites[f].pwprotect&&(d=f));if(0!=c.length)if(!b&&(e||g_prompts.login_site_prompt))security_prompt(function(){openall(a,!0)},null,!0,!0,d,!1);else for(f=0;f<c.length;f++)d=c[f],g_last_launch[d.aid]=
(new Date).getTime(),openURL(d.url,function(a,b){console_log("setting aid "+gettabid(a)+" "+b);g_launches[gettabid(a)]=b},d.aid,!0)}}
function openallrecent(a){var b=[],d;for(d in g_sites)check_ident_aid(g_sites[d].aid)&&b.push(g_sites[d]);b.sort(function(a,b){return a.last_touch>b.last_touch?1:-1});var c=[],e=!1;for(d=0;10>c.length&&d<b.length;d++)"http://group"!=b[b.length-d-1].url&&(e|=b[b.length-d-1].pwprotect,c[c.length]=b[b.length-d-1]);if(0!=c.length)if(!a&&(e||g_prompts.login_site_prompt))security_prompt(function(){openallrecent(!0)});else for(d=0;d<c.length;d++)a=c[d],g_last_launch[a.aid]=(new Date).getTime(),openURL(a.url,
function(a,b){console_log("setting aid "+gettabid(a)+" "+b);g_launches[gettabid(a)]=b},a.aid,!0)}
function openfavorites(a){var b=[],d=!1,c;for(c in g_sites)check_ident_aid(g_sites[c].aid)&&"1"==g_sites[c].fav&&(b.push(g_sites[c]),d|=g_sites[c].pwprotect);if(0==b.length)alertfrombg(gs("NoFavorites"));else if(!a&&(d||g_prompts.login_site_prompt))security_prompt(function(){openfavorites(!0)});else for(c=0;c<b.length;c++)a=b[c],g_last_launch[a.aid]=(new Date).getTime(),openURL(a.url,function(a,b){console_log("setting aid "+gettabid(a)+" "+b);g_launches[gettabid(a)]=b},a.aid,!0)}
function addAttach(a){(g_is_win||g_is_mac||g_is_linux)&&have_binary_function("choose_file")?call_binary_function("choose_file",!0,"","",!0,function(b){if("string"==typeof b&&b.length){var d=b.indexOf("\n"),c=b.substr(0,d);b=b.substr(d+1);10485762<3*b.length/4?alertfrombg(gs("File too large, it must be less than 10MB.")):(g_attachname=c.replace(/\\/g,"/").replace(/.*\//,""),g_attachbytes=b)}a&&a()}):confirm(gs("This feature requires the binary version of this browser extension.  Would you like to install it now?"))&&
install_binary()}function showImageAttach(a){g_img_data=a;openURL(getchromeurl("img.html"))}function canSaveAttach(){return!have_binary_function("write_file")?!1:!0}
function openAttach(a,b,d,c,e,f){console.error("OpenAttach: Opening attachid "+b+" for site "+a);if(!have_binary_function("run_file")||!have_binary_function("write_file"))alertfrombg(gs("This feature is not available in this version. Please install the binary extension by going to https://lastpass.com/dl"));else if(d&&""!=d)alertfrombg(gs("This attachment needs to be saved first."));else{var g=function(h){console.error("OpenAttach: In callback, decrypting");var k="undefined"==typeof h||!h?"unknown":
h;lpdec(e,AES.hex2bin(c),function(l){console.error("OpenAttach: in dec cb");if(l){if(!f){f="";for(var j in lp_attaches)if(lp_attaches.hasOwnProperty(j)&&lp_attaches[j].id==b){f=lp_attaches[j].mimetype;break}}console.error("OpenAttach: mimetype: "+f);j="";0==f.indexOf("other:application/octet-stream")?j="":0==f.indexOf("other:")?j="."+f.substring(6):0==f.indexOf("data:audio")?j="."+f.substring(11):console.error("Do not know extension for: "+f);d=lpcreaterandomhexstring(30)+j;console.error("OpenAttach: filename: "+
d);call_binary_function("write_file",d,l,!0,!0);g_is_linux?call_binary_function("get_path",!0,function(a){alertfrombg(gs("Your attachment is located at:")+"\n\n"+a+d+"\n\n"+gs("It is recommended that you delete the attachment file after you use it."))}):(call_binary_function("get_path",!0,function(a){console.error("OpenAttach: running file");call_binary_function("run_file",a+d)}),0==g_last_openattach&&setInterval(function(){deleteallattachments()},1E4),g_last_openattach=lp_get_gmt_timestamp())}else!e||
0==e.length?(l=get_attach_info(b),j=getacct(a),l&&j&&"retry"!=h?(j=issharedfolder(g_shares,j.group),get_individual_attachment(l.storagekey,b,!1==j?null:j.id,function(a){e=a;g("retry")})):(console.error("OpenAttach: FAILED TO GET INFO"),alertfrombg(gs("Error opening attachment.")+"\nError C\nfrom="+k+"\nattachsize="+("undefined"!=typeof e&&null!=e&&"undefined"!=typeof e.length?e.length:"undefined")+"\nattachkeysize="+("undefined"!=typeof c&&"undefined"!=typeof c.length?c.length:"undefined")))):(console.error("OpenAttach: FAILED TO DECRYPT"),
alertfrombg(gs("Error opening attachment.")+"\nError A\nfrom="+k+"\nattachsize="+("undefined"!=typeof e&&null!=e&&"undefined"!=typeof e.length?e.length:"undefined")+"\nattachkeysize="+("undefined"!=typeof c&&"undefined"!=typeof c.length?c.length:"undefined")))})};c?g("B attachkey is invalid"):(console.error("OpenAttach: Reading from disk"),lpReadAttach(b,function(d){d&&console.error("OpenAttach: Read from disk. Size="+d.length);e=d;var f=getacct(a),l=issharedfolder(g_shares,f.group);console.error("OpenAttach: Is share: "+
l);l=!1==l?g_local_key:l.sharekey;console.error("OpenAttach: attachkey: "+f.attachkey);c=lpdec(f.attachkey,l);console.error("OpenAttach: decrypted attachkey: "+c);g("lpReadAttach attachid="+b+" id="+a+" "+(null==d?"READ_FAILED":"READ_OK"))}))}}
function saveall(){lploggedin?get_selected_tab(null,function(a){g_saveall_url=gettaburl(a);g_saveall_framestotal=g_CS_count[gettabid(a)];g_saveall_framesdone=0;g_saveall_docnumsdone=[];g_saveall_formdata="";g_saveall_tabid=gettabid(a);g_saveall_done=!1;sendCS(g_saveall_tabid,{cmd:"saveall"},"all");setTimeout(function(){finish_saveall()},1E3)}):open_login()}
function finish_saveall(){g_saveall_done||(g_saveall_done=!0,handleSaveAll(g_saveall_tabid,{cmd:"saveall",addsite:1,url:g_saveall_url,formdata:g_saveall_formdata}))}function alertfrombg(a){"undefined"!=typeof webkitNotifications&&webkitNotifications&&0==webkitNotifications.checkPermission()?handlenotifications("LastPass",a):alert(a)}function openfeedback(){openURL(base_url+"feedback.php")}
function opengenpw(){get_selected_tab(null,function(a){""!=g_generate_url&&(g_generate_url_prev=g_generate_url);g_generate_url=gettaburl(a);try{if(g_issafari&&"undefined"!=typeof SafariExtensionPopover){openpopover(3);return}}catch(b){g_can_open_popover=!1}g_isfirefoxsdk?(g_firefox_button_clicked=!0,g_firefox_panel.port.emit("message",{messagetype:"runonload",generate:!0})):VaultToggle.useVault4_0()?LPPlatform.openTabDialog("generatePassword",a):openURL(getchromeurl("lp_toolstrip.html?browseraction=1&generate=1&tabid="+
en(gettabid(a))))})}function openchooseprofilecc(){get_selected_tab(null,function(a){a=gettabid(a);openURL(getchromeurl("lp_toolstrip.html?browseraction=1&chooseprofilecc=1&tabid="+en(a)))})}function openchangepw(a,b,d){g_changepwnewpw=a;g_changepwtld=b;g_changepwexcludeid=d?d:0;openURL(getchromeurl("lp_toolstrip.html?browseraction=1&changepw=1"))}function opensearch(a){if(lploggedin){var b="home.html";a&&""!=a&&(b+="?searchstr="+encodeURIComponent(a));openURL(getchromeurl(b))}else open_login()}
function recheckpage(a){if(lploggedin||!a)lploggedin?get_selected_tab(null,function(a){a=gettabid(a);sendCS(a,{cmd:"recheck"},"all")}):open_login()}function refreshsites(){cleardeccache();get_accts()}
function clearAllData(){var a=opendb();createDataTable(a);a&&(g_indexeddb?a.transaction("LastPassData","readwrite").objectStore("LastPassData").clear():a.transaction(function(a){a.executeSql("DELETE FROM LastPassData",[],function(){console_log("DESTROYING LastPassData Table")},function(a,b){console_log(b)})}))}function strEndsWith(a,b){return a.match(b+"$")==b}
function clearCache(a,b,d,c){"undefined"==typeof b&&(b=!0);"undefined"==typeof d&&(d=!0);d&&lplog("clearCache : clearing otp");if(!(null==g_username||""==g_username)){if(!LPISLOC){if("undefined"!=typeof localStorage){b&&(localStorage.removeItem("lp.uid"),localStorage.removeItem(db_prepend(g_username_hash)));localStorage.removeItem(db_prepend(g_username_hash+"_lt.cac"));for(var e=0;e<localStorage.length;e++){var f=localStorage.key(e);(strEndsWith(f,".att")||b&&(strEndsWith(f,".savedtree")||strEndsWith(f,
".sch")))&&localStorage.removeItem(localStorage.key(e))}b&&(e=localStorage.LPMPU,localStorage.removeItem("LPMPU"),localStorage.removeItem(e+"_key_iter"),localStorage.removeItem(e+"LPMPS"),localStorage.removeItem(e+"LPMPH"),localStorage.removeItem(e+"LPMPD"),localStorage.removeItem(e+"LPMNN"),localStorage.removeItem(e+"LPMEX"),localStorage.removeItem(e+"LPMDD"))}have_binary_function("delete_file")&&(call_binary_function("delete_file",db_prepend(g_username_hash)+"_lt.cac"),c||(call_binary_function("delete_file",
db_prepend(g_username_hash)+"_lpall.slps"),call_binary_function("delete_file",db_prepend(g_username_hash)+"_lpall.lps")));b&&have_binary_function("delete_files_by_extension")&&call_binary_function("delete_files_by_extension",db_prepend(g_username_hash),".att");lp_local_attach_version=-1}var g={},h="";b||(g.icons=!0,g.rsakey=!0,h+=" AND type != 'icons' AND type != 'rsakey'");d||(g.otp=!0,h+=" AND type != 'otp'");LPISLOC&&(g.key=!0,g.accts=!0,h+=" AND type != 'key' AND type != 'accts'");c&&(g.key=!0,
h+=" AND type != 'key'");var k=opendb();createDataTable(k);k&&(g_indexeddb?k.transaction("LastPassData","readonly").objectStore("LastPassData").index("username_hash").openCursor(IDBKeyRange.only(g_username_hash)).onsuccess=function(a){if(a=a.target.result){if("undefined"==typeof g[a.value.type])k.transaction("LastPassData","readwrite").objectStore("LastPassData")["delete"](g_username_hash+"_"+a.value.type);a["continue"]()}}:k.transaction(function(a){a.executeSql("UPDATE LastPassData SET username_hash=? WHERE username_hash=?"+
h,["deleteme",db_prepend(g_username_hash)],function(){var a=opendb();createDataTable(a);a&&a.transaction(function(a){a.executeSql("DELETE FROM LastPassData WHERE username_hash=?"+h,["deleteme"],function(){},function(a,b){console_log(b)})})},function(a,b){console_log(b)})}));b&&(b=lpreadretryfile(),null!=b&&0<b.length&&(b=gs("A retry file has been found. This likely means that not all of your site changes have been saved. Would you like to delete this file and potentially lose some changes?"),(a||
confirm(b))&&lpdeleteretry()))}}function openabout(){g_isdebug&&have_binary_function("debug_windows")&&call_binary_function("debug_windows");openURL(getchromeurl("about.html"))}function opensessions(){openURL(base_url+"sess.php")}function openmyaccount(){openURL(base_url+"my.php")}function openseccheck(){unlock_plug2web();openURL(base_url+"?securitychallenge=1&lpnorefresh=1")}
function openaddsite(){g_site_data=createNewAcct();g_site_data.addsite="1";g_site_data.noreplace="1";get_selected_tab(null,function(a){g_site_data.url=gettaburl(a);openURL(getchromeurl("site.html"))})||(g_site_data.url="",openURL(getchromeurl("site.html")))}function openaddsecurenote(){lploggedin?(g_site_data=createNewAcct(),g_site_data.sn=1,g_site_data.url="http://sn",openURL(getchromeurl("site.html"))):open_login(1)}
function checkforupdates(){g_notification_type="upgrade";g_notification_data={checking:!0};sendTS({cmd:"notification",type:"upgrade"});setTimeout(function(){lpMakeRequest(base_url+"upgrade.php?binary="+(have_nplastpass()?1:0)+"&x=1&ver="+LP.en(lpversion)+(g_issafari?"&safarijs=1":"")+(g_isopera?"&opera=1":"")+(g_ismaxthon?"&maxthon=1":"")+(g_isfirefoxsdk?"&firefox=1":""),"",upgrade_response,null)},250)}
function fillform(a,b,d,c,e,f){if(check_ident_ffid(a)&&(!c||check_ident_ffid(c))){verbose_log("fillform entered");for(var g=0;g<g_formfills.length&&g_formfills[g].ffid!=a;g++);if(g!=g_formfills.length){var h;if(c){for(h=0;h<g_formfills.length&&g_formfills[h].ffid!=c;h++);if(h==g_formfills.length)return}!b&&(g_formfills[g].pwprotect||c&&g_formfills[h].pwprotect||g_prompts.view_ff_prompt)?get_selected_tab(null,function(b){var f=d?d:gettabid(b);security_prompt(function(){fillform(a,!0,f,c,e)})}):get_selected_tab(null,
function(b){var l=d?d:gettabid(b),j=g_formfills[g],q=c?g_formfills[h]:null,n=[],m=[],u;for(u in j)if("ffid"==u||"profiletype"==u||"pwprotect"==u||"creditmon"==u||"decprofilename"==u||"group"==u||"sharefolderid"==u)n[u]=j[u];else if("custom_fields"==u){n[u]=[];for(var y=0;y<j[u].length;y++){var B="custom_field"+y;n[B]=[];n[B].cfid=j[u][y].cfid;n[B].text=lpmdec_acct(j[u][y].text,!0,j,g_shares);n[B].value=lpmdec_acct(j[u][y].value,!0,j,g_shares);n[B].alttext=lpmdec_acct(j[u][y].alttext,!0,j,g_shares)}}else c&&
0==u.indexOf("cc")?n[u]=lpmdec_acct(q[u],!0,q,g_shares):(n[u]=lpmdec_acct(j[u],!0,j,g_shares),"profilelanguage"==u&&"undefined"!=typeof translations[n[u]]&&(m[n[u]]=translations[n[u]]));"undefined"==typeof m["en-US"]&&(m["en-US"]=translations["en-US"]);j=LPJSON.stringify(n);if("undefined"==typeof f||null===f)f=!1;sendCS(l,{cmd:"fillform",toformfill:j,translations:LPJSON.stringify(translations),fromiframe:e,xdomasked:f},"all");l=document.createElement("a");l.href=b.url;logformfill(a,l.hostname)})}}}
function getacceptabletlds(a){var b=a=lp_gettld_url(a),d=null;"undefined"!=typeof g_equivalentdomains[a]&&(d=g_equivalentdomains[a]);if(d)for(var c in g_equivalentdomains)c==d&&(b+=","+g_equivalentdomains[c]);return b}
function fillcurrent(a,b,d){!b&&(g_sites[a].pwprotect||g_prompts.login_site_prompt)?get_selected_tab(null,function(b){var e=d?d:gettabid(b);security_prompt(function(){fillcurrent(a,!0,e)})}):get_selected_tab(null,function(b){b=d?d:gettabid(b);sendCS(b,{cmd:"fillcurrent",password:getpasswordfromacct(g_sites[a]),domains:getacceptabletlds(g_sites[a].url)},"all")})}function openbaseurl(a){g_isfirefoxsdk?setTimeout(function(){openURL(base_url+a)},0):openURL(base_url+a)}
function addprofile(a){lploggedin?!a&&g_prompts.view_ff_prompt?security_prompt(function(){addprofile(!0)}):(g_formfill_data={cmd:"add",type:0,data:null},openURL(getchromeurl("formfill.html"))):open_login(1)}function addcreditcard(a){lploggedin?!a&&g_prompts.view_ff_prompt?security_prompt(function(){addcreditcard(!0)}):(g_formfill_data={cmd:"add",type:1,data:null},openURL(getchromeurl("formfill.html"))):open_login(1)}
function editprofile(a,b){if(lploggedin)for(var d=0;d<g_formfills.length;++d){if(a==g_formfills[d].ffid){if(!b&&(g_formfills[d].pwprotect||g_prompts.view_ff_prompt)){security_prompt(function(){editprofile(a,!0)});break}g_formfill_data={cmd:"edit"};g_formfill_data.type=g_formfills[d].profiletype;g_formfill_data.data=g_formfills[d];openURL(getchromeurl("formfill.html"));break}}else open_login(1)}
function clearforms(){get_selected_tab(null,function(a){a=gettabid(a);sendCS(a,{cmd:"clearforms"},"all")})}function lostkey(){openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username))}function googleauthlostkey(){openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username)+"&type=googleauth")}function outofbandlostkey(){openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username)+"&type=outofband")}
function securityquestionlostkey(){var a=securityquestion_getdata("reseturl");a&&""!=a?openURL(a):openURL(base_url+"lostkey.php?cmd=sendemail&username="+en(g_username)+"&type=securityquestion")}function sesamelostkey(){openURL(base_url+"sesamedisable.php?cmd=sendemail&username="+en(g_username))}function gridlostkey(){openURL(base_url+"griddisable.php?cmd=sendemail&username="+en(g_username))}
function multifactorlostkey(a){openURL(base_url+"multifactordisable.php?cmd=sendemail&username="+en(g_username)+"&type="+en(a))}var g_showerrorlastmsg="",g_showerrorlastts=0;
function lpshowError(a,b,d,c,e,f,g,h,k){g_hidecreate&&(c=!1);g_notification_type="error";var l=a;a=gs(a);a=a.replace(/\n/g,"<br/>");g_notification_data={msg:a,showFeedback:b,showLogin:d,showCreateAccount:c,multifactor_disable_url:e,yellow:f,custombutton:g,customaction:h,showStartTrial:k};sendTS({cmd:"notification",type:"error"});setTimeout(function(){get_selected_tab(null,function(a){sendCS(gettabid(a),{cmd:"showerrornotification",text:gs(l).replace(/\n/g," "),notificationdata:g_notification_data})})},
100);if((!g_safari_error_notifications||!g_can_open_popover)&&g_issafari)if(g_showerrorlastmsg!=a||3E3<(new Date).getTime()-g_showerrorlastts)g_showerrorlastmsg=a,g_showerrorlastts=(new Date).getTime(),alert(gs(l)),g_showerrorlastts=(new Date).getTime();console_log(a)}
function launch(a,b){if(is_application(a))g_is_win&&have_binary()?lpnp_notify("launch",{data0:LP.get_appaid(a)}):editAid(a,null,b);else if(is_formfill(a))fillform(LP.get_ffid(a));else if(check_ident_aid(a)){var d=get_record(a);if(d)if(d.sn)editAid(a);else{var c=d.pwprotect;!b&&(c||g_prompts.login_site_prompt)?c?security_prompt(function(){launch(a,!0)},null,null,!0,a,!1):security_prompt(function(){launch(a,!0)}):(c=d.url,c.match(/^[a-z]+?\:\/\//i)||(c="http://"+c),g_last_launch[d.aid]=(new Date).getTime(),
g_pending_launch=d.aid,openURL(c,function(a,b){g_launches[gettabid(a)]=b},d.aid))}}}
function security_prompt(a,b,d,c,e,f){getsinglefactortype(function(g){if(!d&&(g_prompts.multifactor_reprompt||LPISUPEK)){var h=multifactor_getdata("password_offline");if(h&&""!=h&&"trueapi"==multifactor_getdata("type")&&have_binary_function("trueapi_get_hash")){call_binary_function("trueapi_get_hash",g_username,function(d){hash_check==d?a():security_prompt(a,b,!0,c,e,f)});return}if((LPISUPEK||"vtapi"==g)&&have_binary_function("lpvt_verify_user")){call_binary_function("lpvt_verify_user","",gs("Swipe finger"),
gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),gs("Swipe current user's finger"),function(d){if(""!=d&&(d=d.split("|"),2==d.length&&null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(d[0])),decodeURIComponent(d[1]),get_key_iterations(fix_username(decodeURIComponent(d[0])))))){a();return}LPISUPEK&&LPISLOC?"function"==typeof b&&b():security_prompt(a,b,!0,c,e,f)});return}if("validity"==g&&have_binary_function("validity_verify_user")){call_binary_function("validity_verify_user",
"",gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(d){if(""!=d&&(d=d.split("|"),2==d.length&&null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(d[0])),decodeURIComponent(d[1]),get_key_iterations(fix_username(decodeURIComponent(d[0])))))){a();return}security_prompt(a,b,!0,c,e,f)});return}if("winbio"==g&&have_binary_function("winbio_verify_user")){call_binary_function("winbio_verify_user","",gs("Swipe finger"),
gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),function(d){if(""!=d&&(d=d.split("|"),2==d.length&&null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(d[0])),decodeURIComponent(d[1]),get_key_iterations(fix_username(decodeURIComponent(d[0])))))){a();return}security_prompt(a,b,!0,c,e,f)});return}if("nymi"==g&&have_binary_function("nymi_validate")){call_binary_function("nymi_validate",function(d){if(""!=d&&(d=d.split("|"),2==d.length&&
null!=g_local_key&&""!=g_local_key&&g_local_key==make_lp_key_iterations(fix_username(decodeURIComponent(d[0])),decodeURIComponent(d[1]),get_key_iterations(fix_username(decodeURIComponent(d[0])))))){a();return}security_prompt(a,b,!0,c,e,f)});return}}g=lpGetPref("reprompttime",0);var h=(new Date).getTime(),k=get_record(e);h>g_last_reprompt_time&&h-g_last_reprompt_time<=1E3*g&&!needs_secure_reprompt(k)?a():(reprompt_callback=g_reprompt_callback=a,g_reprompt_error_callback=b,c=!1,k&&(k.pwprotect&&needs_secure_reprompt(k))&&
(c=!0),VaultToggle.useVault4_0()?LPPlatform.openTabDialog("reprompt"):(g="login.html?isreprompt=1","undefined"!==typeof c&&(c&&"undefined"!==typeof e)&&(g+="&securereprompt=1&aid="+e,typeof("undefined"!==f&&f)&&(g+="&fromcs=1")),openURL(getchromeurl(g))))})}function get_identity_param(){return"&iid="+LP.en(g_identity)}
function add_ident_aid(a){if(""!=g_identity){for(var b=0;b<g_identities.length&&g_identities[b].iid!=g_identity;b++);b>=g_identities.length||(b=g_identities[b],""!=b.aids&&(b.aids+=","),b.aids+=a,b.aidarr=b.aids.split(","))}}function add_ident_ffid(a){if(""!=g_identity){for(var b=0;b<g_identities.length&&g_identities[b].iid!=g_identity;b++);b>=g_identities.length||(b=g_identities[b],""!=b.ffids&&(b.ffids+=","),b.ffids+=a,b.ffidarr=b.ffids.split(","))}}
function check_ident_aid(a){if(""==g_identity)return!0;for(var b=0;b<g_identities.length&&g_identities[b].iid!=g_identity;b++);if(b>=g_identities.length)return!1;b=g_identities[b];"undefined"==typeof b.aidarr&&(b.aidarr=b.aids.split(","));return lp_in_array(a,b.aidarr)}
function check_ident_appaid(a){if(""==g_identity)return!0;for(var b=0;b<g_identities.length&&g_identities[b].iid!=g_identity;b++);if(b>=g_identities.length)return!1;b=g_identities[b];"undefined"==typeof b.appaidarr&&(b.appaidarr=b.appaids.split(","));return lp_in_array(a,b.appaidarr)}
function check_ident_ffid(a){if(""==g_identity)return!0;for(var b=0;b<g_identities.length&&g_identities[b].iid!=g_identity;b++);if(b>=g_identities.length)return!1;b=g_identities[b];"undefined"==typeof b.ffidarr&&(b.ffidarr=b.ffids.split(","));return lp_in_array(a,b.ffidarr)}
function switch_identity(a,b,d,c,e){if(!(a==g_identity||"undefined"==typeof a)){var f=!1;if(""!=a){for(var g=0;g<g_identities.length;g++)if(g_identities[g].iid==a){g_identities[g].pw_prompt&&(f=!0);break}if(g>=g_identities.length)return}else for(g=0;g<g_identities.length;g++)if(g_identities[g].pw_prompt){f=!0;break}!b&&(f||g_prompts.switch_identity_prompt)?(e&&closePop(),security_prompt(function(){switch_identity(a,!0)})):(g_identity=""+a,c||lpnp_notify("switchidentity",{data0:g_identity}),lpPutUserPref("identity",
g_identity),lpWriteAllPrefs(),d||refresh_windows(),update_menus(!0))}}function add_identity(){unlock_plug2web();openURL(base_url+"?ac=1&addidentity=1")}function setup_poll_timer(){setTimeout(function(){poll_server()},6E4)}function set_last_reprompt_time(){g_last_reprompt_time=(new Date).getTime()}
function compare_tlds(a,b){if("string"!=typeof a||"string"!=typeof b)return!1;a=a.toLowerCase();b=b.toLowerCase();return a==b?!0:"undefined"!=typeof g_equivalentdomains[a]&&"undefined"!=typeof g_equivalentdomains[b]&&g_equivalentdomains[a]==g_equivalentdomains[b]?!0:!1}var LP=this;function lpreadretry(){return"undefined"==typeof localStorage?null:localStorage.getItem(db_prepend(g_username_hash+".retry"))}
function lpdeleteretry(){if("undefined"==typeof localStorage)return null;localStorage.removeItem(db_prepend(g_username_hash+".retry"))}function lpwriteretry(a){return""==g_username_hash||null==g_username_hash||"undefined"==typeof localStorage||!localStorage_setItem(db_prepend(g_username_hash+".retry"),a)?!1:!0}
function getuuid(a){if(LPISLOC)a("");else if("undefined"==typeof localStorage)a("");else try{var b=function(c,d){console_log("In get_uuid callback2");if(null==c||""==c){console_log("empty uuid data");if(!d&&have_binary_function("read_file")&&g_is_win){call_binary_function("read_file",db_prepend("lp.uid"),function(a){null!=a&&""!=a&&protect_data(a,!0,null,function(a){call_binary_function("write_file",db_prepend("lp.suid"),a)});b(a,!0)});return}if(null==c||""==c)console_log("Creating new uuid"),c=lpCreatePass(32,
1,1,1,1,1,1,1),have_binary_function("write_file")?protect_data(c,!0,null,function(a){call_binary_function("write_file",db_prepend("lp.suid"),a)}):localStorage_setItem(db_prepend("lp.uid"),c)}console_log("Calling getuuid callback");a(c)};have_binary_function("read_file")?call_binary_function("read_file",db_prepend("lp.suid"),function(a){unprotect_data(a,!0,b)}):b(localStorage.getItem(db_prepend("lp.uid")))}catch(d){console_log("Error in getuuid: "+d),a("")}}
function setuuid(a){have_binary_function("write_file")?protect_data(a,!0,null,function(a){call_binary_function("write_file",db_prepend("lp.suid"),a)}):localStorage_setItem(db_prepend("lp.uid"),a)}function clearuuid(){delete_file("lp.suid");delete_file("lp.uid");"undefined"!=typeof localStorage&&localStorage.removeItem("lp.uid")}var lperrorcount=0;
function lpReportError(a){if(!1!=g_prompts.improve&&(lperrorcount++,!(100<lperrorcount))){var b=a.match(/^(.*)location:\s+/);b&&(a=b[1]);a="msg=cr() lp("+lpversion+") errors("+lperrorcount+"): "+LP.en(a);lpMakeRequest(base_url+"error.php?",a,null,null)}}function lpatob(a){return atob(a)}function lpbtoa(a){return btoa(a)}function lpGetCurrentWindow(){return window}function bin2hex(a){return AES.bin2hex(a)}function url2hex(a){return AES.url2hex(a)}function hex2url(a){return AES.hex2url(a)}
function hex2bin(a){return AES.hex2bin(a)}function lp_hex2bin(a){return AES.hex2bin(a)}var lastopenauthwin=0;function ismultifactortaburl(a){return-1!=a.indexOf("browseraction=1&yubikey=1")||-1!=a.indexOf("browseraction=1&googleauth=1")||-1!=a.indexOf("browseraction=1&outofband=1")||-1!=a.indexOf("browseraction=1&securityquestion=1")||-1!=a.indexOf("browseraction=1&sesame=1")||-1!=a.indexOf("browseraction=1&grid=1")?!0:!1}
function getLanguage(){var a=lpGetPref("language","");""==a&&(a=navigator.language);return a}
function openURL(a,b,d,c,e,f,g){if(a)if(g_isfirefoxsdk&&1==lpGetPref("htmlindialog",0)&&ischromeurl(a)&&"undefined"!=typeof g_panel&&-1==a.indexOf(VaultToggle.getVaultPage())){-1!=a.indexOf("site.html")&&(g_window_before_dialog=g_window_utils.getMostRecentBrowserWindow());var h=800,k=600;if(-1!=a.indexOf("login.html")||-1!=a.indexOf("lp_toolstrip.html?browseraction=1&generate=1"))h=k=400;a+=(-1==a.indexOf("?")?"?":"&")+"lpindialog=1";var l="chrome,centerscreen,titlebar,resizable,scrollbars,screenX=0,screenY=0,width="+
h+",height="+k;setTimeout(function(){g_firefox_html_dialog=g_window_utils.openDialog({features:l});g_firefox_html_dialog.addEventListener("load",function(){g_tabs.activeTab.url=a})},0)}else{h=!1;if(g_isfirefoxsdk&&(k=getcurrenturl(),ischromeurl(k)&&-1!=k.indexOf("lpindialog=1")))if(g)h=c=e=!0;else{g_tabs.activeTab.close();setTimeout(function(){openURL(a,b,d,c,e,f,g)},100);return}"undefined"==typeof e&&(e=!1);"undefined"==typeof c&&(c=!1);"undefined"==typeof f&&(f=!1);if(0==a.indexOf(base_url))a+=
-1==a.indexOf("?")?"?":"&",a+="lang="+LP.en(getLanguage());else if(a==g_forgotpwurl||a==g_helpurl)a+=-1==a.indexOf("?")?"?":"&",(k=getLanguage())&&(a+="lang="+LP.en(g_useshortlang?k.substring(0,2):k));get_selected_tab(null,function(a){g_selectedtabid=gettabid(a);g_selectedtab=a});0<a.indexOf("sesameusername")&&get_all_windows({populate:!0},function(a){for(var b=a.length-1;0<=b;--b)for(var c=get_tabs_length(a[b])-1;0<=c;--c){var d=gettaburl(get_tabs(a[b])[c]);d&&lp_url_is_lastpassext(d)&&close_tab(get_tabs(a[b])[c])}});
k=!1;ismultifactortaburl(a)?lastopenauthwin=(new Date).getTime():-1!=a.indexOf(VaultToggle.getVaultPage())&&(new Date).getTime()-1E3<lastopenauthwin&&(k=!0);b||(b=function(){});var j=lpGetPref("openpref","tabs");if("same"==j&&(c||6==a.indexOf("-extension://")||0==a.indexOf("mxaddon-pkg://")))j="tabs";"windows"==j&&e&&(j="tabs");if(g_isfirefoxsdk&&h&&(void 0==typeof g_window_before_dialog||g_window_before_dialog.closed))j="windows";var q=getcurrenturl();q&&0==q.indexOf(getchromeurl("launch.html",!0))&&
(j="same");if("same"==j)if(g_ischrome)get_selected_tab(null,function(c){chrome.tabs.update(c.id,{url:a},function(c){L("call openURL:loadurl with "+a);b(c,d)})});else if(g_issafari){var n=safari.application.activeBrowserWindow.activeTab;b(n,d);n.url=a}else g_isopera?(n=opera.extension.tabs.getFocused())?(b(n,d),n.update({url:a})):(n=opera.extension.tabs.create({focused:!0,url:a}),b(n,d)):g_ismaxthon?(n=window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab(),b(n,d),n.navigate(a)):g_isfirefoxsdk&&
(n=g_tabs.activeTab,n.url=a,b(n,d));else"windows"==j?g_ischrome?chrome.windows.create({url:a},function(a){0<a.tabs.length&&b(a.tabs[0],d)}):g_issafari?(n=safari.application.openBrowserWindow().activeTab,b(n,d),n.url=a):g_isopera?(n=opera.extension.windows.create({focused:!0,url:a}),b(n,d)):g_ismaxthon?(n=window.external.mxGetRuntime().create("mx.browser").tabs.newTab({url:a}),b(n,d)):g_isfirefoxsdk&&g_windows.browserWindows.open({url:a,onOpen:function(a){"undefined"==typeof a.lponreadydone&&(a.lponreadydone=
!0,0<a.tabs.length&&(n=a.tabs[0],b(n,d)))}}):(j=k?!1:!0,g_ischrome?chrome.tabs.create({url:a,selected:j,active:!f},function(a){b(a,d)}):g_issafari?(h=k?"background":"foreground",f&&(h="background"),n=safari.application.activeBrowserWindow.openTab(h),b(n,d),n.url=a):g_isopera?(n=opera.extension.tabs.create({focused:!0,url:a}),b(n,d)):g_ismaxthon?(n=window.external.mxGetRuntime().create("mx.browser").tabs.newTab({url:a}),b(n,d)):g_isfirefoxsdk&&(h?(n=g_model_core.modelFor(g_tabs_utils.openTab(g_window_before_dialog,
a,{inBackground:f})),b(n,d)):setTimeout(function(){g_tabs.open({url:a,inBackground:f,onReady:function(a){"undefined"==typeof a.lponreadydone&&(a.lponreadydone=!0,b(a,d))}})},0)))}}function copyusername(a,b,d){if(!lploggedin)return!1;a=get_record(a);return null===a||b&&d&&!check_for_frame_mismatch_ok(d,b,gs("Are you sure you would like to copy your LastPass site's username to the clipboard?"),"copyusername")?!1:copytoclipboard(getusernamefromacct(a))}
function copypassword(a,b,d,c){if(!lploggedin)return!1;var e=get_record(a);if(null===e||d&&c&&!check_for_frame_mismatch_ok(c,d,gs("Are you sure you would like to copy your LastPass site's password to the clipboard?"),"copypassword"))return!1;if(null!=e.sharedfromaid&&""!=e.sharedfromaid&&"0"!=e.sharedfromaid&&"null"!=e.sharedfromaid)return alertfrombg(gs("This is a shared site. You are not permitted to view the password.")),!1;if(!b&&(e.pwprotect||g_prompts.view_pw_prompt||g_prompts.login_site_prompt))return security_prompt(function(){copypassword(a,
!0,d,c)}),!1;loglogin(a);return copytoclipboard(getpasswordfromacct(e))}function copyurl(a,b,d){if(!lploggedin)return!1;a=get_record(a);return null===a||b&&d&&!check_for_frame_mismatch_ok(d,b,gs("Are you sure you would like to copy your LastPass site's URL to the clipboard?"),"copyurl")?!1:copytoclipboard(geturlfromacct(a))}
function copynote(a,b){var d=get_record(a);!b&&(d.pwprotect||g_prompts.edit_sn_prompt)?security_prompt(function(){copynote(a,!0)}):(issharedfolder(g_shares,d.group)&&loglogin(get_record_id(d)),d="undefined"!=typeof d.extra?lpmdec_acct(d.extra,!0,d,g_shares):"",copytoclipboard(d))}
function refresh_windows(a){var b=!1;"undefined"!==typeof a&&a&&(b=!0);g_issafari&&(g_hidemenubar&&g_can_open_popover)&&toggle_menu(!0);get_all_windows({populate:!0},function(a){for(var c=0;c<a.length;c++)for(var e=0;e<get_tabs_length(a[c]);e++)if(lp_url_is_lastpass(gettaburl(get_tabs(a[c])[e]),!0)&&(-1==gettaburl(get_tabs(a[c])[e]).indexOf("lpnorefresh=1")||b)){var f=gettaburl(get_tabs(a[c])[e]),f=f.replace("&nk=1",""),f=f.replace("&showdeleted=1","");L("refresh_windows() loadurl url:"+f);sendCS(gettabid(get_tabs(a[c])[e]),
{cmd:"loadurl",url:f})}})}function clear_all_filled_fields(){get_all_windows({populate:!0},function(a){for(var b=0;b<a.length;b++)for(var d=0;d<get_tabs_length(a[b]);d++)sendCS(gettabid(get_tabs(a[b])[d]),{cmd:"clearfilledfields"},"all")})}
function closeallnotifications(a,b){"undefined"==typeof a&&(a=!1);"undefined"==typeof b&&(b=!1);get_all_windows({populate:!0},function(d){for(var c=0;c<d.length;c++)for(var e=0;e<get_tabs_length(d[c]);e++)sendCS(gettabid(get_tabs(d[c])[e]),{cmd:"closenotification",includeerror:a,excludeother:b})})}
function recheckall(){L("BG : recheckall()");get_all_windows({populate:!0},function(a){for(var b=0;b<a.length;b++)for(var d=0;d<get_tabs_length(a[b]);d++)sendCS(gettabid(get_tabs(a[b])[d]),{cmd:"recheck"},"all")});setprefs("all","all")}
function closecurrenttab(a){get_selected_tab(null,function(b){""!=a&&-1==gettaburl(b).indexOf(a)||close_tab(b)});select_selectedtabid();g_isfirefoxsdk&&g_firefox_html_panel&&!(""!=a&&-1==g_firefox_html_panel.url.indexOf(a))&&(g_firefox_html_panel.destroy(),g_firefox_html_panel=null)}function MPWNoNag(){confirm(gs("Are you sure you do not want LastPass to tell you when your Master Password is at risk?"))&&(localStorage_setItem(g_lp_mpw_user+"LPMNN",1),g_lp_mpw_nonag=!0)}
function addDomainToMPWNever(){confirm(gs("Disable LastPass Master Password risk warning on this site?"))&&(g_lp_mpw_exclude[g_lp_mpw_bad_url]=1,localStorage_setItem(g_lp_mpw_user+"LPMEX",JSON.stringify(g_lp_mpw_exclude)))}var mpw_num_sites,mpw_retval;
function mpw_checkVault(a,b,d){d&&(mpw_num_sites=a.length,mpw_retval="");if(a.length){var c=a.pop();d=c.passworddec;""===d?mpw_num_sites--:make_lp_key_hash_iterations(g_lp_mpw_salt,d,100,function(a,b){b==g_lp_loggedinhsh&&(mpw_retval=""===mpw_retval?c.id:mpw_retval+("."+c.id));mpw_num_sites--})}0!==mpw_num_sites?setTimeout(function(){mpw_checkVault(a,b,!1)},0):b(mpw_retval)}
function fill_default_ffid(){if(lploggedin){var a=lpGetPref("defaultffid","0");if(check_ident_ffid(a))for(var b=0;b<g_formfills.length;b++)if(g_formfills[b].ffid==a){fillform(a);return}confirm(gs("You have not yet chosen a default form fill profile.  Would you like to choose one now?"))&&openprefs()}else open_login()}
function setprefs(a,b,d){var c=getInt(lpGetPref("highlightFields",1)),e=getInt(lpGetPref("warninsecureforms",0)),f=getInt(lpGetPref("dontfillautocompleteoff",0)),g=getInt(lpGetPref("donotoverwritefilledfields",0)),h=getInt(lpGetPref("showGenerateNotifications",1)),k=getInt(lpGetPref("showFormFillNotifications",1)),l=getInt(lpGetPref("showNotificationsAfterClick",1)),j=getInt(lpGetPref("alwayschooseprofilecc",0)),q=getInt(lpGetPref("automaticallyFill",1)),n=getInt(lpGetPref("notificationsBottom",0));
is_guiless()&&(c=e=l=h=k=0);for(var m={cmd:"setprefs",highlightFields:c,warninsecureforms:e,dontfillautocompleteoff:f,donotoverwritefilledfields:g,showGenerateNotifications:h,showFormFillNotifications:k,showNotificationsAfterClick:l,alwayschooseprofilecc:j,automaticallyFill:q,g_cpwbot:g_cpwbot,notificationsBottom:n},c=0;c<g_lp_hotkeys.length;c++)e=g_lp_hotkeys[c],m[e+"KeyCode"]=lpGetPref(e+"KeyCode"),m[e+"Mods"]=lpGetPref(e+"Mods");m.do_hotkeys=!g_isfirefoxsdk||"undefined"==typeof g_ff_hotkeys;d&&
isSpecialSite(d)&&(m.specialsite="1");g_cpwbot&&CPWbot_bg&&null!==CPWbot_bg.get_pwchangestate()&&!CPWbot_bg.get_okstate()&&!CPWbot_bg.get_failstate()&&!CPWbot_bg.in_bagration()&&CPWbot_bg.get_pwchangetabid()==a?(m.in_cpwbot=1,m.docaptcha=CPWbot_bg.get_docaptchastate()?1:0,CPWbot_bg&&g_CS_tops&&g_CS_tops[a]==b&&(c=CPWbot_bg.get_last_overlay_message())&&(m.msg=JSON.stringify({msg:c})),CPWbot_bg.show_cpwbot_overlay(a,null,null)):g_cpwbot&&(m.in_cpwbot=0);if((debug||g_isdebug)&&(CPWbot_bg&&(!0===CPWbot_bg.get_failstate()||
!0===CPWbot_bg.get_okstate()))&&a==CPWbot_bg.get_selenium_tabid())L("force result div again WTF"),!0===CPWbot_bg.get_failstate()?CPWbot_bg.show_selenium_fail(a):!0===CPWbot_bg.get_okstate()&&CPWbot_bg.show_selenium_ok(a);m.do_experimental_popupfill=do_experimental_popupfill;m.lploggedin=lploggedin;m.ff_currpass_regexp=get_ff_translation("ff_currpass_regexp");m.ff_username_regexp=get_ff_translation("ff_username_regexp");m.ff_loginform_regexp=get_ff_translation("ff_loginform_regexp");m.ff_bankacctnum_regexp=
get_ff_translation("ff_bankacctnum_regexp");m.ff_email_regexp=get_ff_translation("ff_email_regexp");m.ff_company_regexp=get_ff_translation("ff_company_regexp");m.ff_firstname_regexp=get_ff_translation("ff_firstname_regexp");m.ff_search_regexp=get_ff_translation("ff_search_regexp");m.ff_captcha_regexp=get_ff_translation("ff_captcha_regexp");m.ff_cctype_regexp=get_ff_translation("ff_cctype_regexp");m.ff_lastname_regexp=get_ff_translation("ff_lastname_regexp");m.ff_address1_regexp=get_ff_translation("ff_address1_regexp");
m.ff_forgot_regexp=get_ff_translation("ff_forgot_regexp");m.ff_remember_regexp=get_ff_translation("ff_remember_regexp");m.ff_combineddummy_regexp=get_ff_translation("ff_combineddummy_regexp");m.ff_password_regexp=get_ff_translation("ff_password_regexp");m.ff_question_answer_regexp=get_ff_translation("ff_question_answer_regexp");m.ff_country_regexp=get_ff_translation("ff_country_regexp");m.ff_city_regexp=get_ff_translation("ff_city_regexp");m.ff_forgot_regexp=get_ff_translation("ff_forgot_regexp");
d&&(setcurrenturl(d),LPJSON.stringify(getnevers()),m.nevers=LPJSON.stringify(getnevers()),e=g_CS_tops[a],g_CS_tops&&("undefined"!=typeof e&&null!==e&&e!=b)&&(c=g_CS[a][e],e=gettaburl(g_CS[a][e]),!e&&(c&&c.name)&&(e=punycode.URLToASCII(c.name)),e&&(c=getnevers(),getnevers_given(e,c),m.nevers=LPJSON.stringify(c))),do_experimental_popupfill&&(c=lp_gettld_url(d),c=getsites(c),c=reorderOnURL(c,d,!0),m.sitescount=c.length));"all"==a?(get_all_windows({populate:!0},function(a){for(var b=0;b<a.length;b++)for(var c=
0;c<get_tabs_length(a[b]);c++)sendCS(gettabid(get_tabs(a[b])[c]),m,"all")}),g_generate_pw_pattern_hints={}):(sendCS(a,m,b),g_cpwbot&&CPWbot_bg&&(b={cmd:"loadurl",docnum:b,tld:lp_gettld_url(d),url:d},CPWbot_bg.push_event_queue("loadurl",a,b)),g_generate_pw_pattern_hints[a]=null)}function get_registry_value(a,b,d,c){g_is_win&&have_binary_function("get_registry_value")?call_binary_function("get_registry_value",a,b,d,function(a){"string"!=typeof a&&(a=d);c(a)}):c(d)}
function gotourl(a){if(a=get_record(a))a=geturlfromacct(a),""!=a&&(a.match(/^[a-z]+?\:\/\//i)||(a="http://"+a),openURL(a))}
function deleteNever(a,b){var d="undefined"==typeof b?!1:b,c=0;switch(a.type){case "nevergenerates":c=1;break;case "neverformfills":c=2;break;case "neverautologins":c=3;break;case "neverautofills":c=4;break;case "nevershowicons":c=6;break;case "neverenablelp":c=8}c="delete=1&type="+LP.en(c)+"&url="+LP.en(a.url);lpMakeRequest(base_url+"add_never.php",c,function(b){if(4==b.readyState&&200==b.status&&null!=b.responseXML&&null!=b.responseXML.documentElement){var c=b.responseXML.documentElement;b=c.getElementsByTagName("ok");
c=c.getElementsByTagName("error");if(0<b.length){b=[];for(c=0;g_neverurls[a.type]&&c<g_neverurls[a.type].length;c++){var g=g_neverurls[a.type][c];g!=a.url&&b.push(g)}g_neverurls[a.type]=b;g_local_accts_version++;rewritelocalfile()}else c.length&&(b=c[0].getAttribute("message"))&&(d||LP.alert(b))}},function(){},null)}function db_prepend(a){LPISLOC&&(a="local_"+a);return a}function changemasterpassword(){LPISLOC?openURL(getchromeurl("changemasterpw.html")):openbaseurl("?ac=1&opensettings=1")}
function change_master_password(a,b,d,c){var e=get_key_iterations(a),f=make_lp_key_iterations(a,b,e),g=[],h=[],k=[],l=[],j=getBG();if(!j.reencrypt(g,j.g_sites,f)||!j.reencrypt(h,j.g_securenotes,f)||!j.reencrypt(k,j.g_applications,f)||!j.reencrypt(l,j.g_formfills,f))alertfrombg(gs("An error occurred")),d&&c&&c();else{if(d)return b=j.g_local_key,j.g_local_key=f,j.g_local_key_hex=AES.bin2hex(f),j.g_local_key_hash=SHA256(f),a=flattendata(g_local_accts_version+1,g,h,g_prompts,l,g_identities,g_equivalentdomains,
g_neverurls,g_premium_exp,lpenc(a),g_pendings,g_shareeautopushes,lpmaxid,g_urlrules,g_prefoverrides,g_shares,k,g_enterpriseuser,lp_attaches),j.g_local_key=b,j.g_local_key_hex=AES.bin2hex(b),j.g_local_key_hash=SHA256(b),c&&c(a),a;j.g_sites=g;j.g_securenotes=h;j.g_applications=k;j.g_formfills=l;j.g_local_accts_version++;j.g_local_key=make_lp_key_iterations(a,b,e);j.g_local_hash=lphash=make_lp_hash_iterations(j.g_local_key,b,e);j.g_local_key_hex=AES.bin2hex(j.g_local_key);j.g_local_key_hash=SHA256(j.g_local_key);
j.g_username=a;j.g_username_hash=lpusername_hash=SHA256(a);j.rewritelocalfile(!1,!0);j.g_pwdeckey=j.g_local_key;j.lpWriteKeyFile();j.lpnp_notify("local_pwchange",{data0:g_username,data1:b});alertfrombg(gs("Password updated!"));j.closecurrenttab("")}}function reencrypt(a,b,d){for(var c in b){var e=[];if(!reencryptArray(e,b[c],d,!1))return!1;a[c]=e}return!0}var keystoreencrypt="username password extra profilename firstname middlename lastname email company ssn birthday address1 address2 city state state_name zip country country_cc3l country_name mobilephone mobilephone3lcc mobileext evephone evephone3lcc eveext phone phone3lcc phoneext fax fax3lcc faxext ccnum ccexp cccsc address3 title gender driverslicensenum taxid bankname bankacctnum bankroutingnum timezone county ccstart ccname ccissuenum notes text alttext profilelanguage lastname2 mobileemail firstname2 firstname3 lastname3".split(" ");
function reencryptArray(a,b,d,c){try{for(var e in b)if("object"==typeof b[e]){var f=[];if(!reencryptArray(f,b[e],d,"custom_fields"==e?2:c||"fields"==e))return!1;a[e]=f}else if(lp_in_array(e,keystoreencrypt)||"value"==e&&(2==c||c&&fieldisencrypted(b))){var g=lpmdec(b[e],!0);if((null==g||""==g)&&null!=b[e]&&""!=b[e])return!1;var h=lpmenc(g,!0,d);a[e]=h}else a[e]=b[e]}catch(k){return console_error(k),!1}return!0}
function fieldisencrypted(a){for(var b in a)if("type"==b&&("password"==a[b]||"text"==a[b]||"hidden"==a[b]||"textarea"==a[b]||"email"==a[b]||"tel"==a[b])||"id"==b)return!0;return!1}var lpclearrecent=!1;function clearrecent(){"undefined"!=typeof localStorage&&(localStorage_setItem(g_username_hash+"recent",lp_get_gmt_timestamp()),lpclearrecent=!0)}function getClearRecentTime(){if("undefined"==typeof localStorage)return 0;var a=localStorage.getItem(g_username_hash+"recent");return null==a?0:a}
function getRecentCount(){return lpGetPref("recentUsedCount",10)}function IsIconsUpdated(a){return lpclearrecent?(lpclearrecent=!1,!0):g_icons_length!=a}
function upgradetoserver(){(g_isopera||confirm(gs("Please note that upgrading from LastPass Local to LastPass Online will result in your password data being uploaded in its encrypted format to LastPass servers.  You will be able to access your data from anywhere, and LastPass will not be able to read it.  Would you like to continue?")))&&security_prompt(function(){openURL(getchromeurl("welcome.html"))})}
function renameGroup(a,b){if(!(a==gs("favorites")||a==gs("recently usedlower"))){var d=issharedfolder(g_shares,a);if(!1!=d&&d.decsharename==a)alertfrombg("You cannot rename a top level Shared folder");else{var c=issharedfolder(g_shares,b);if(checkmove(c,d)&&checkreadonly(c)&&checkreadonly(d)){var e=!1==c?g_local_key:c.sharekey,f=b;c&&(f=b.substr(c.decsharename.length+1));if(c||d){var e=[],g=[],h=[g_sites,g_securenotes,g_applications];c&&b.substr(c.decsharename.length+1);for(var k in h){var l=h[k],
j;for(j in l)if(f=l[j],f.group==a||0==f.group.indexOf(a+"\\")){e[e.length]=get_record_id(f);var q=b;f.group!=a&&0<f.group.indexOf("\\")&&(q=b+f.group.substr(f.group.indexOf("\\")));g[get_record_id(f)]=q}}moveIntoSharedFolder(c,d,e,g,!1,!1,!1)}else{h=[g_sites,g_securenotes,g_applications];d=[];g=[];q=[];for(k in h)for(j in l=h[k],l)if(f=l[j],f.group==a)f.group=b,"undefined"==typeof d[a]?(q[q.length]=a,g[a]=get_record_id(f)):g[a]+=","+get_record_id(f),f=b,c&&(f=f.substr(c.decsharename.length+1)),d[a]=
f;else if(0==f.group.indexOf(a+"\\")){var n=f.group;f.group=f.group.replace(a+"\\",b+"\\");"undefined"==typeof d[n]?(q[q.length]=n,g[n]=get_record_id(f)):g[n]+=","+get_record_id(f);f=f.group;c&&(f=f.substr(c.decsharename.length+1));d[n]=f}g_local_accts_version++;rewritelocalfile();h="xml=1";for(k=0;k<q.length;k++)h+="&ids"+k+"="+LP.en(g[q[k]])+"&newgrp"+k+"="+LP.en(lpenc(d[q[k]],e));h+=!1==c?"":"&sharedfolderid="+en(c.id);lpMakeRequest(base_url+"groups.php",h,function(){},function(){},null)}}}}}
function getacct(a){return get_record(a)}
function moveIntoSharedFolder(a,b,d,c,e,f,g,h){var k="object"==typeof a&&"object"==typeof b&&a.id==b.id;if(!g&&!k){var l=gs("You are moving sites to a shared folder. This will potentially make them available to others.\n\nAre you sure you would like to continue?");"undefined"==typeof a||!a?l=gs("You are moving sites from a shared folder into your general vault. This will potentially make them unavailable to others.\n\n Do you want to continue?"):"undefined"!=typeof b&&b&&(l=gs("You are moving sites to a different shared folder. This may change who has access to the sites.\n\n Do you want to continue?"));
if(!confirm(l))return!1}var k="undefined"!=typeof a&&a?a.sharekey:g_local_key,j="undefined"!=typeof b&&b?b.sharekey:g_local_key,q="undefined"!=typeof a&&a?a.id:g_uid,n="undefined"!=typeof b&&b?b.id:"",m="cmd=uploadaccounts&username="+en(g_username),u="",y=[],B=[],r;for(r in d)if(d.hasOwnProperty(r)){if(!("number"==typeof r||"string"==typeof r&&r.match(/^\d+$/)))return alertfrombg(gs("An error occurred")+" i="+gs(r)+" type "+typeof r),!1;var p=getacct(d[r]),l=!1;if(null==p)return alertfrombg(gs("Error: This folder has already been moved?")),
!1;if("undefined"!=typeof p.individualshare&&p.individualshare){if(null!=p.sharedfromaid&&""!=p.sharedfromaid&&"0"!=p.sharedfromaid)return alertfrombg(gs("You cannot move individually shared sites into a shared folder.")),!1;if(e||g)l=!0;else if(l=gs("A site that has been previously shared cannot be moved to a shared folder.\n\nWould you like to make a copy?"),confirm(l))l=!0;else return!1}if(!f){if("undefined"!=typeof p.sharefolderid&&""!=n&&p.sharefolderid!=n&&p.sharefolderid!=q)return alertfrombg(gs("Please move sites from only one shared folder at a time.")),
!1;var v=[],t;for(t in p)p.hasOwnProperty(t)&&(v[t]=p[t]);t="undefined"!=typeof a&&a?c[d[r]].substr(a.decsharename.length+1):c[d[r]];var A;v.group="undefined"!=typeof a&&a?a.decsharename:"";""!=v.group&&""!=t&&(v.group+="\\");v.group+=t;v.extra=lpmenc(lpmdec(p.extra,!0,j),!0,k);is_application(p)?A="&appname"+r+"="+en(p.appname)+"&name"+r+"="+en(lpenc(p.name,k))+"&type"+r+"="+en("cr")+"&group"+r+"="+en(lpenc(t,k))+"&extra"+r+"="+en(crypto_btoa(v.extra))+"&script"+r+"="+en(p.script)+"&pwprotect"+r+
"="+en(p.pwprotect?1:0)+"&wininfo"+r+"="+en(p.wininfo)+"&wintitle"+r+"="+en(p.wintitle)+"&exeversion"+r+"="+en(p.exeversion)+"&exehash"+r+"="+en(p.exehash)+"&fiid"+r+"="+en(p.fiid):(v.username=lpmenc(lpmdec(p.username,!0,j),!0,k),v.password=lpmenc(lpmdec(p.password,!0,j),!0,k),v.realm_data=lpmenc(lpmdec(p.realm_data,!0,j),!0,k),A="&url"+r+"="+en(url2hex(p.url))+"&username"+r+"="+en(crypto_btoa(v.username))+"&password"+r+"="+en(crypto_btoa(v.password))+"&name"+r+"="+en(lpenc(p.name,k))+"&type"+r+"="+
en("cr")+"&grouping"+r+"="+en(lpenc(t,k))+"&extra"+r+"="+en(crypto_btoa(v.extra))+"&pwprotect"+r+"="+en(p.pwprotect?1:0)+"&realm"+r+"="+en(crypto_btoa(v.realm_data)),p.save_all&&(A+="&save_all"+r+"=1"),"undefined"!=typeof p.basic_auth&&"1"==p.basic_auth&&(A+="&basic_auth"+r+"=1"),"undefined"!=typeof p.notetype&&(p.notetype&&p.notetype.length)&&(A+="&notetype"+r+"="+en(p.notetype)));q!=g_uid?v.sharefolderid=q:"undefined"!=typeof v.sharefolderid&&delete v.sharefolderid;"undefined"!=typeof p.attachkey&&
""!=p.attachkey&&(v.attachkey=lpenc(lpdec(p.attachkey,j),k),A+="&attachkey"+r+"="+en(v.attachkey));A+="&origaid"+r+"="+LP.en(d[r]);var C="";v.fields=[];for(t=0;t<p.fields.length;t++){v.fields[t]=[];for(var w in p.fields[t])p.fields[t].hasOwnProperty(w)&&(v.fields[t][w]=p.fields[t][w]);var x=p.fields[t].value,s=p.fields[t].type;if(is_application(p)||"text"==s||"email"==s||"tel"==s||"password"==s||"textarea"==s||"hidden"==s)v.fields[t].value=lpmenc(lpmdec(x,!0,j),!0,k),x=crypto_btoa(v.fields[t].value);
else if("checkbox"==s||"radio"==s)x+=p.fields[t].checked?"-1":"-0";C=is_application(p)?C+("&fields"+r+"id"+t+"="+en(p.fields[t].id)+"&fields"+r+"type"+t+"="+en(p.fields[t].type)+"&fields"+r+"value"+t+"="+en(x)):C+("&fields"+r+"name"+t+"="+en(p.fields[t].name)+"&fields"+r+"type"+t+"="+en(p.fields[t].type)+"&fields"+r+"value"+t+"="+en(x)+"&fields"+r+"formname"+t+"="+en("undefined"==typeof p.fields[t].formname?"":p.fields[t].formname))}B[d[r]]=v;m+=A;m+=C;!l&&!e&&(u+=en(d[r])+",",y[y.length]=d[r])}}if(f)return!0;
m+="&sharedfolderid="+en(q);null!=typeof a&&b&&(m+="&origsharedfolderid="+en(b.id));e||(m+="&todelete="+u);lpMakeRequest(base_url+"lastpass/api.php",m,function(a,b,c){if(4==a.readyState&&200==a.status&&a.responseXML&&a.responseXML.documentElement)if(b=a.responseXML.documentElement.getElementsByTagName("result"),0<b.length){if(a=parseInt(b[0].getAttribute("accts_version")),compare_accounts_versions(a,parseInt(g_local_accts_version)+1)){var e=!0,f;for(f in d)if(d.hasOwnProperty(f)){var g=getacct(d[f]),
h=B[d[f]];if(g&&h)if(is_application(g)){lp_in_array(d[f],y)&&delete g_applications[get_appaid(d[f])];h.appaid=b[0].getAttribute("aidmap"+d[f]);if(!h.appaid){e=!1;break}h.appaid=get_appaid(h.appaid);g_applications[h.appaid]=h}else{var j=lp_gettld_url(g.url);lp_in_array(d[f],y)&&("http://sn"==g.url?delete g_securenotes[d[f]]:delete g_sites[d[f]],"undefined"!=typeof g_tlds[j]&&"undefined"!=typeof g_tlds[j][d[f]]&&delete g_tlds[j][d[f]]);h.aid=b[0].getAttribute("aidmap"+d[f]);if(!h.aid){e=!1;break}"http://sn"==
h.url?g_securenotes[h.aid]=h:g_sites[h.aid]=h;"undefined"==typeof g_tlds[j]&&(g_tlds[j]=[]);g_tlds[j][h.aid]=!0;for(var k in lp_attaches)if(lp_attaches.hasOwnProperty(k)&&lp_attaches[k].parent==d[f]){var g=lp_attaches[k],j=[],l;for(l in g)g.hasOwnProperty(l)&&(j[l]=g[l]);j.id=b[0].getAttribute("attachidmap"+g.id);if(!j.id){e=!1;break}j.parent=h.aid;lp_in_array(d[f],y)?lp_attaches[k]=j:lp_attaches[lp_attaches.length]=j}if(!e)break}}g_server_accts_version=g_local_accts_version=a;lp_server_attach_version=
parseInt(b[0].getAttribute("attachversion"));if(e){rewritelocalfile();refresh_windows();checkAttach();c&&c.successCallback&&c.successCallback(B);return}}}else b=a.responseXML.documentElement.getAttribute("rc"),f="SERVER_uploadfailed"==b?gs("Your Shared Folder action failed. Please check your permissions before trying again"):gs("Your Shared Folder action failed."),c&&c.errorCallback?c.errorCallback(f):alertfrombg(f);get_accts()},function(){var a=gs("An error occurred");h&&h.errorCallback?h.errorCallback(a):
alertfrombg(a)},h);return!0}
function moveSelectedToGroup(a,b,d,c,e){d=d||{};d.successCallback=c;d.errorCallback=e;var f=void 0!==d.skipConfirm?d.skipConfirm:!1;b=b.split(",");c=issharedfolder(g_shares,a);var g=null;if(checkreadonly(c)){var h=!1;for(e=0;e<b.length;e++){g=getacct(b[e]);g=issharedfolder(g_shares,g.group);if(!checkreadonly(g)||!checkmove(c,g))return;if(c||g)h=!0}if(h){h=[];for(e=0;e<b.length;e++)h[b[e]]=a;moveIntoSharedFolder(c,g,b,h,!1,!1,f,d)}else{f=[];g=[];if(a==gs("favorites"))for(e=0;e<b.length;e++)(h=getacct(b[e]))&&
"0"==h.fav&&(f[f.length]=b[e]);(0<b.length||0<f.length||0<g.length)&&changeGroupAndFavorites(b,f,g,a,c,d)}}}
function changeGroupAndFavorites(a,b,d,c,e,f){for(var g=d="",h="",k=0;k<a.length;k++){var l=a[k],j=getacct(l);j&&c!=gs("favorites")&&(j.group=c,d+=h+l,h=",")}h="";for(k=0;k<b.length;k++)if(l=b[k],j=getacct(l))j.fav="1",g+=h+l,h=",";g_local_accts_version++;g_server_accts_version++;rewritelocalfile();f&&f.successCallback&&f.successCallback();a=!1==e?g_local_key:e.sharekey;b=c;e&&(b=c.substr(e.decsharename.length+1));c="aids="+LP.en(d)+"&newfavaids="+LP.en(g)+"&oldfavaids="+LP.en("")+"&newgrp="+LP.en(lpenc(b,
a))+"&xml=1";c+=!1==e?"":"&sharedfolderid="+en(e.id);lpMakeRequest(base_url+"groups.php",c,lpChangeGroupResponse)}function lpChangeGroupResponse(){}function lpReadFile(a,b){have_binary_function("read_file")?call_binary_function("read_file",a,b):b("")}var g_is_chrome_portable=!1;function setup_is_chrome_portable(){have_binary_function("is_chrome_portable")&&call_binary_function("is_chrome_portable",function(a){g_is_chrome_portable=a})}function is_chrome_portable(){return g_is_chrome_portable}
function doexportchoose(){openURL(getchromeurl("export_choose.html"))}function doprintchoose(){openURL(getchromeurl("print_choose.html"))}
function exportAttachment(a,b,d,c,e,f){if(can_save_file())if(d&&""!=d)alertfrombg(gs("This attachment needs to be saved first."));else{var g=function(d){var h="undefined"==typeof d||!d?"unknown":d;lpdec(e,AES.hex2bin(c),function(j){if(j){if(!f){f="";for(var q in lp_attaches)if(lp_attaches.hasOwnProperty(q)&&lp_attaches[q].id==b){f=lp_attaches[q].mimetype;break}}q="";0==f.indexOf("other:application/octet-stream")?q="":0==f.indexOf("other:")?q=f.substring(6):0==f.indexOf("data:image")?q=f.substring(11):
0==f.indexOf("data:audio")?q=f.substring(11):alertfrombg(gs("Unexpected data type:")+" "+f);var n,m;""!=q?n=m="*."+q:(n=gs("Files"),m="");call_binary_function("save_file",j,n,m,!0,q,gs("If not specified, will use a file extension of:"));j=""}else!e||0==e.length?(j=get_attach_info(b),q=getacct(a),j&&q&&"retry"!=d?(q=issharedfolder(g_shares,q.group),get_individual_attachment(j.storagekey,b,!1==q?null:q.id,function(a){e=a;g("retry")})):alertfrombg(gs("Error opening attachment.")+"\nError C\nfrom="+h+
"\nattachsize="+("undefined"!=typeof e&&null!=e&&"undefined"!=typeof e.length?e.length:"undefined")+"\nattachkeysize="+("undefined"!=typeof c&&"undefined"!=typeof c.length?c.length:"undefined"))):(console.error("attach_callback: FAILED TO DECRYPT"),alertfrombg(gs("Error opening attachment.")+"\nError B\nattachsize="+("undefined"!=typeof e&&null!=e&&"undefined"!=typeof e.length?e.length:"undefined")+"\nattachkeysize="+("undefined"!=typeof c&&"undefined"!=typeof c.length?c.length:"undefined")))})};
if(c)g();else{var h=getacct(a);lpReadAttach(b,function(a){e=a;a=issharedfolder(g_shares,h.group);c=lpdec(h.attachkey,!1==a?g_local_key:a.sharekey);g()})}}else alertfrombg(gs("This feature is not available in this version. Please install the binary extension by going to https://lastpass.com/dl"))}
function doexport(a){if(1==lpGetPref("noexport",0))setTimeout(function(){alertfrombg(gs("CompanyPolicyProhibits"))},0);else if(!g_generatedpw&&!a)security_prompt(function(){doexport(!0)});else{a=can_save_file();g_export_output="url,username,password,extra,name,grouping,fav\n";var b=[],d;for(d in g_sites)check_ident_aid(d)&&"http://group"!=g_sites[d].url&&(b[b.length]=g_sites[d]);for(d in g_securenotes)check_ident_aid(d)&&(b[b.length]=g_securenotes[d]);for(d=0;d<b.length;d++){var c=b[d];if(!(null!=
c.sharedfromaid&&""!=c.sharedfromaid&&"0"!=c.sharedfromaid)){var e=[];e[0]=c.url;e[1]=getusernamefromacct(c);e[2]=getpasswordfromacct(c);e[3]=lpmdec_acct(c.extra,!0,c,g_shares);e[4]=c.name;e[5]=c.group;e[6]=c.fav;for(var f=c="",g=0;g<e.length;g++){var h=csv_encode(e[g]);a||(h=of(h));c+=f+h;f=","}c+="\n";g_export_output+=c}}a?(loglogin("export"),call_binary_function("save_file",g_export_output,gs("CSV Files"),"*.csv",!1,"csv",gs("If not specified, will use a file extension of:"))):openURL(getchromeurl("export.html"))}}
function formfillexport(a){if(1==lpGetPref("noexport",0))setTimeout(function(){alertfrombg(gs("CompanyPolicyProhibits"))},0);else if(!g_generatedpw&&!a)security_prompt(function(){formfillexport(!0)});else{a=can_save_file();var b="profilename profilelanguage title firstname firstname2 firstname3 middlename lastname lastname2 lastname3 username gender birthday ssn company address1 address2 address3 city county state state_name zip country country_cc3l country_name timezone email mobileemail phone3lcc phone phoneext fax3lcc fax faxext evephone3lcc evephone eveext mobilephone3lcc mobilephone mobileext ccname ccnum ccstart ccexp cccsc ccissuenum bankname bankacctnum bankroutingnum notes".split(" "),
d="",c="";g_export_output="";for(var e=!0,f=0,g=0;g<g_formfills.length;g++)if(check_ident_ffid(g_formfills[g].ffid)){for(var h="",k=0;k<b.length;k++){var l=b[k];e&&(d+=c+csv_encode(l),c=",");g_export_output+=h+csv_encode(lpmdec_acct(g_formfills[g][l],!0,g_formfills[g],g_shares));h=","}g_formfills[g].custom_fields.length>f&&(f=g_formfills[g].custom_fields.length);for(e=0;e<g_formfills[g].custom_fields.length;e++)g_export_output+=","+csv_encode(lpmdec_acct(g_formfills[g].custom_fields[e].text,!0,g_formfills[g],
g_shares))+","+csv_encode(lpmdec_acct(g_formfills[g].custom_fields[e].value,!0,g_formfills[g],g_shares))+","+csv_encode(lpmdec_acct(g_formfills[g].custom_fields[e].alttext,!0,g_formfills[g],g_shares));g_export_output+="\n";e=!1}for(e=1;e<=f;e++)d+=","+csv_encode("customfield"+e+"text")+","+csv_encode("customfield"+e+"value")+","+csv_encode("customfield"+e+"alttext");g_export_output=d+"\n"+g_export_output;a?(loglogin("export"),call_binary_function("save_file",g_export_output,gs("CSV Files"),"*.csv",
!1,"csv",gs("If not specified, will use a file extension of:"))):openURL(getchromeurl("export.html"))}}function can_save_file(){return have_binary_function("save_file")?!0:!1}function fix_tlds(a,b,d){delete g_tlds[a][d];"undefined"==typeof g_tlds[b]&&(g_tlds[b]=[]);g_tlds[b][d]=!0}function increment_local_accts_version(){g_local_accts_version++}function set_editfieldsopener(a){g_editfieldsopener=a}
function close_editfieldsopener(){g_editfieldsopener&&(g_editfieldsopener.close(),g_editfieldsopener=null)}function gettaburl(a){return punycode.URLToASCII(a?a.url:"")}
function getcurrenturl(){if(g_ischrome||g_iscasper)return punycode.URLToASCII(g_currenturl);if(g_issafari)return gettaburl(safari.application.activeBrowserWindow.activeTab);if(g_isopera)return opera.extension.tabs.getFocused()?gettaburl(opera.extension.tabs.getFocused()):"";if(g_ismaxthon)return gettaburl(window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab());if(g_isfirefoxsdk)return gettaburl(g_tabs.activeTab)}
function getcurrenttabid(){if(g_ischrome||g_iscasper)return g_currenttabid;if(g_issafari)return gettabid(safari.application.activeBrowserWindow.activeTab);if(g_isopera)return gettabid(opera.extension.tabs.getFocused());if(g_ismaxthon)return gettabid(window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab());if(g_isfirefoxsdk)return gettabid(g_tabs.activeTab)}
function getsinglefactortype(a){var b=function(b){var c=lpGetPref("singlefactortype","");g_prefs_read&&b!=c?have_binary_function("file_exists")?call_binary_function("file_exists","singlefactortype",function(e){e||(b=c);setsinglefactortype(b);a(b)}):(setsinglefactortype(c),a(c)):a(b)};have_binary_function("read_file")?call_binary_function("read_file","singlefactortype",function(a){b(lptrim(a))}):b("")}
function setsinglefactortype(a){have_binary_function("write_file")&&call_binary_function("write_file","singlefactortype",a);var b=getBG();b.lpPutGblPref("singlefactortype",a);b.lpWriteAllPrefs()}function get_method(){if(g_ischrome)return"cr";if(g_issafari)return"sfjs";if(g_isopera||is_opera_chromium())return"op";if(g_ismaxthon)return"mx";if(g_isfirefoxsdk)return is_fennec()?"fennec":"ff"}
function select_selectedtabid(){try{g_ischrome?-1!=g_selectedtabid&&(chrome.tabs.update(g_selectedtabid,{selected:!0}),chrome.runtime.lastError&&debug&&L(chrome.runtime.lastError)):g_issafari?g_selectedtab&&g_selectedtab.activate():g_isopera?opera.extension.tabs.getFocused().update({focused:!0}):g_ismaxthon?window.external.mxGetRuntime().create("mx.browser").tabs.getCurrentTab().activate():g_isfirefoxsdk&&g_tabs.activeTab.activate()}catch(a){}}
function addEmptyGroup(a,b,d){var c=issharedfolder(g_shares,a);if(checkreadonly(c)){var e=!1==c?g_local_key:c.sharekey,f=a;if(c){if(!checkreadonly(c))return;f=a.substr(c.decsharename.length+1)}var g=createNewAcct();g.url="http://group";g.group=a;g.aid="0";a="ajax=1&extjs=1&name=&url="+LP.en(url2hex(g.url))+"&grouping="+LP.en(lpenc(f,e))+"&username=&password=&extra=&aid=0&openid_url=&isbookmark=0";a+=!1==c?"":"&sharedfolderid="+en(c.id);lpMakeRequest(base_url+"show.php",a,lpSaveSiteResponse,null,{acct:g,
successCallback:b,errorCallback:d})}}function hassites(){for(var a in g_sites)return!0;for(a in g_securenotes)return!0;return!1}var g_basicauth_found=!1,g_basicauth_origurl="",g_basicauth_url="",g_basicauth_realm="",g_basicauth_tabid=0;
function basicauth_found(a,b,d){a!=g_basicauth_found&&(g_basicauth_found=a)&&get_selected_tab(null,function(a){compare_tlds(lp_gettld_url(d),lp_gettld_url(gettaburl(a)))?(g_basicauth_tabid=gettabid(a),g_basicauth_origurl=punycode.URLToASCII(d),g_basicauth_url=gettaburl(a),g_basicauth_realm=b,handleFill(gettabid(a),{url:gettaburl(a),topurl:gettaburl(a),docid:0,force:!1,docnum:0})):g_basicauth_found=!1})}
function basicauth_save(a,b,d,c,e){lpdbg("basicauth","basicauth_save called");if(lploggedin){if(!(""==a&&""==b)){d||(d=g_basicauth_realm);c||(c=g_basicauth_url);var f=lp_gettld_url(c);lpdbg("basicauth","tld is "+f);if(hasNeverSave(c,f))lpdbg("basicauth","have a never save for tld, aborting");else{var g="undefined"!=typeof g_tlds[f]?g_tlds[f]:[],h;for(h in g)if(check_ident_aid(h)&&"undefined"!=typeof g_sites[h]&&(g=g_sites[h],a==lpmdec_acct(g.username,!0,g,g_shares)&&b==lpmdec_acct(g.password,!0,g,
g_shares))){lpdbg("basicauth","already saved, aborting");return}g_notification_type="save";data={};data.username=a;data.password=b;e||(data.realm=d);data.url=c;data.tld=f;g_notification_data=data;0!=lpGetPref("showSaveSiteNotifications",0)&&(lpdbg("basicauth","showing notification"),sendTS({cmd:"notification",type:"save"}));if(0!=lpGetPref("showSaveNotificationBar",1)&&(lpdbg("basicauth","checking add site"),lpCheckAddSite(data.username,data.password,f))){lpdbg("basicauth","showing notification bar");
var k=function(a){sendCS(a,{cmd:"showaddnotification",text:gs("Should LastPass remember this password?"),notificationdata:LPJSON.stringify(data)});g_persistent_notifications[a]={cmd:"showaddnotification",text:gs("Should LastPass remember this password?"),notificationdata:LPJSON.stringify(data)}};g_basicauth_tabid?k(g_basicauth_tabid):get_selected_tab(null,function(a){k(gettabid(a))})}lpdbg("basicauth","basicauth_save done")}}}else lpdbg("basicauth","not logged in, aborting")}
var toplevelcontextmenu=null,lastcontexturl=null,lastbadgeurl=null,contextParents=[],contextMenuIdToId=[];function cmaction_autofill(a,b){var d,c,e;g_ischrome?(d=gettabid(b),e=contextMenuIdToId[a.menuItemId],c=gettaburl(b)):g_isopera?(d=getcurrenttabid(),e=a.target.id,c=a.documentURL):g_isfirefoxsdk&&(d=getcurrenttabid(),e=a,c=getcurrenturl());handleFill(d,{url:c,topurl:c,docid:0,force:!1,docnum:0,cmd:"autofillaid",aid:e})}
function cmaction_copyusername(a){var b;g_ischrome?b=contextMenuIdToId[a.menuItemId]:g_isopera?b=a.target.id:g_isfirefoxsdk&&(b=a);copyusername(b)}function cmaction_copypassword(a){var b;g_ischrome?b=contextMenuIdToId[a.menuItemId]:g_isopera?b=a.target.id:g_isfirefoxsdk&&(b=a);copypassword(b)}function cmaction_copyurl(a){var b;g_ischrome?b=contextMenuIdToId[a.menuItemId]:g_isopera?b=a.target.id:g_isfirefoxsdk&&(b=a);copyurl(b)}
function cmaction1(a){var b;g_ischrome?b=contextMenuIdToId[a.menuItemId]:g_isopera?b=a.target.id:g_isfirefoxsdk&&(b=a);fillform(b)}function cmaction2(a){var b;g_ischrome?b=contextMenuIdToId[a.menuItemId]:g_isopera?b=a.target.id:g_isfirefoxsdk&&(b=a);editprofile(b)}
function cmaction(a){a=a.split("|");if(2==a.length)switch(a[0]){case "cmaction_autofill":cmaction_autofill(a[1]);break;case "cmaction_copyusername":cmaction_copyusername(a[1]);break;case "cmaction_copypassword":cmaction_copypassword(a[1]);break;case "cmaction_copyurl":cmaction_copyurl(a[1]);break;case "cmaction1":cmaction1(a[1]);break;case "cmaction2":cmaction2(a[1])}}function rebuildcontextonload(){get_selected_tab(null,function(a){rebuildcontext(gettaburl(a))})}
function setbadgetextonload(){get_selected_tab(null,function(a){setbadgetext(gettaburl(a))})}
function rebuildcontext(a){setcurrenturl(a);if(!g_ischrome||!("undefined"==typeof chrome||"undefined"==typeof chrome.contextMenus))if(!g_isopera||opera.contexts.menu)if(!g_issafari&&!g_ismaxthon&&!(g_isfirefoxsdk&&"undefined"==typeof g_context_menu)&&!(is_guiless()||1==lpGetPref("hideContextMenus",0))&&lastcontexturl!=a){lastcontexturl=a;if(g_ischrome){if(contextParents.length){var b=contextParents.pop();chrome.contextMenus.remove(b,function(){lastcontexturl=null;rebuildcontext(a)});return}}else if(g_isopera){for(var d=
opera.contexts.menu.length-1;0<=d;d--)opera.contexts.menu.removeItem(d);contextParents=[]}else if(g_isfirefoxsdk){for(d=contextParents.length-1;0<=d;d--)contextParents[d].destroy();contextParents=[];toplevelcontextmenu&&(toplevelcontextmenu.destroy(),toplevelcontextmenu=null)}contextMenuIdToId=[];var c=can_copy_to_clipboard(),b=c?6:3;if(lploggedin){g_ischrome?(contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("AutoFill"),contexts:["all"],parentId:toplevelcontextmenu}),c&&
(contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Copy Username"),contexts:["all"],parentId:toplevelcontextmenu}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Copy Password"),contexts:["all"],parentId:toplevelcontextmenu}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Copy URL"),contexts:["all"],parentId:toplevelcontextmenu})),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Recheck Page"),
contexts:["all"],parentId:toplevelcontextmenu,onclick:function(){recheckpage()}}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Generate Secure Password"),contexts:["all"],parentId:toplevelcontextmenu,onclick:opengenpw}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Fill Forms"),contexts:["all"],parentId:toplevelcontextmenu})):g_isopera?(toplevelcontextmenu=opera.contexts.menu.createItem({title:gs("LastPass"),icon:"images/icon16.png",type:"folder"}),
opera.contexts.menu.addItem(toplevelcontextmenu),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("AutoFill"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),c&&(contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Copy Username"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Copy Password"),
type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Copy URL"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1])),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Recheck Page"),onclick:function(){recheckpage()}}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Generate Secure Password"),
onclick:opengenpw}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=opera.contexts.menu.createItem({title:gs("Fill Forms"),type:"folder"}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1])):g_isfirefoxsdk&&(toplevelcontextmenu=g_context_menu.Menu({label:gs("LastPass"),image:self.data.url("images/icon16.png"),context:g_context_menu.PredicateContext(function(){return!0})}),contextParents[contextParents.length]=g_context_menu.Menu({label:gs("AutoFill")}),
toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),c&&(contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Copy Username")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Copy Password")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Copy URL")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-
1])),contextParents[contextParents.length]=g_context_menu.Item({label:gs("Recheck Page"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){recheckpage()}}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]),contextParents[contextParents.length]=g_context_menu.Item({label:gs("Generate Secure Password"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){opengenpw()}}),toplevelcontextmenu.addItem(contextParents[contextParents.length-
1]),contextParents[contextParents.length]=g_context_menu.Menu({label:gs("Fill Forms")}),toplevelcontextmenu.addItem(contextParents[contextParents.length-1]));var e=lp_gettld_url(a),f=reorderOnURL(getsites(e),a,!0,!1);0<f.length?set_badge_text(f.length):clear_badge_text();for(d=0;d<f.length;d++)for(e=0;e<=(c?3:0);e++){var g=f[d].useusername,g="undefined"!=typeof g&&g.length?" ("+g+")":"",h=0==e?cmaction_autofill:1==e?cmaction_copyusername:2==e?cmaction_copypassword:cmaction_copyurl;g_ischrome?(g=chrome.contextMenus.create({title:f[d].name+
g,contexts:["all"],parentId:contextParents[e],onclick:h}),contextMenuIdToId[g]=f[d].aid,contextParents[contextParents.length]=g):g_isopera?contextParents[e].addItem(opera.contexts.menu.createItem({title:f[d].name+g,onclick:h,id:f[d].aid})):g_isfirefoxsdk&&contextParents[e].addItem(g_context_menu.Item({label:f[d].name+g,data:h.name+"|"+f[d].aid,contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){cmaction(this.data)}}))}if(0==f.length)for(e=0;e<=(c?3:0);e++)g_ischrome?
chrome.contextMenus.create({title:gs("No Matching Sites!"),contexts:["all"],parentId:contextParents[e]}):g_isopera?contextParents[e].addItem(opera.contexts.menu.createItem({title:gs("No Matching Sites!")})):g_isfirefoxsdk&&contextParents[e].addItem(g_context_menu.Item({label:gs("No Matching Sites!")}));for(e=0;e<g_formfills.length;e++)check_ident_ffid(g_formfills[e].ffid)&&(g_ischrome?(contextParents[contextParents.length]=chrome.contextMenus.create({title:g_formfills[e].decprofilename,contexts:["all"],
parentId:contextParents[b]}),g=chrome.contextMenus.create({title:gs("Fill Form"),contexts:["all"],parentId:contextParents[contextParents.length-1],onclick:cmaction1}),contextMenuIdToId[g]=g_formfills[e].ffid,g=chrome.contextMenus.create({title:gs("Edit"),contexts:["all"],parentId:contextParents[contextParents.length-1],onclick:cmaction2}),contextMenuIdToId[g]=g_formfills[e].ffid):g_isopera?(c=opera.contexts.menu.createItem({title:g_formfills[e].decprofilename,type:"folder"}),contextParents[b].addItem(c),
c.addItem(opera.contexts.menu.createItem({title:gs("Fill Form"),onclick:cmaction1,id:g_formfills[e].ffid})),c.addItem(opera.contexts.menu.createItem({title:gs("Edit"),onclick:cmaction2,id:g_formfills[e].ffid}))):g_isfirefoxsdk&&(c=g_context_menu.Menu({label:g_formfills[e].decprofilename}),contextParents[b].addItem(c),c.addItem(g_context_menu.Item({label:gs("Fill Form"),data:"cmaction1|"+g_formfills[e].ffid,contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){cmaction(this.data)}})),
c.addItem(g_context_menu.Item({label:gs("Edit"),data:"cmaction2|"+g_formfills[e].ffid,contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){cmaction(this.data)}}))));g_ischrome?(contextParents[contextParents.length]=chrome.contextMenus.create({type:"separator",parentId:contextParents[b]}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Add Profile"),contexts:["all"],parentId:contextParents[b],onclick:addprofile}),contextParents[contextParents.length]=
chrome.contextMenus.create({title:gs("Add Credit Card"),contexts:["all"],parentId:contextParents[b],onclick:addcreditcard}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Clear Forms"),contexts:["all"],parentId:contextParents[b],onclick:clearforms}),contextParents[contextParents.length]=chrome.contextMenus.create({title:gs("Choose Profile and Credit Card"),contexts:["all"],parentId:contextParents[b],onclick:openchooseprofilecc})):g_isopera?(contextParents[b].addItem(opera.contexts.menu.createItem({type:"line"})),
contextParents[b].addItem(opera.contexts.menu.createItem({title:gs("Add Profile"),onclick:addprofile})),contextParents[b].addItem(opera.contexts.menu.createItem({title:gs("Add Credit Card"),onclick:addcreditcard})),contextParents[b].addItem(opera.contexts.menu.createItem({title:gs("Clear Forms"),onclick:clearforms})),contextParents[b].addItem(opera.contexts.menu.createItem({title:gs("Choose Profile and Credit Card"),onclick:openchooseprofilecc}))):g_isfirefoxsdk&&(contextParents[b].addItem(g_context_menu.Separator()),
contextParents[b].addItem(g_context_menu.Item({label:gs("Add Profile"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){addprofile()}})),contextParents[b].addItem(g_context_menu.Item({label:gs("Add Credit Card"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){addcreditcard()}})),contextParents[b].addItem(g_context_menu.Item({label:gs("Clear Forms"),contentScript:"self.on('click', function() { self.postMessage(); });",
onMessage:function(){clearforms()}})),contextParents[b].addItem(g_context_menu.Item({label:gs("Choose Profile and Credit Card"),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){openchooseprofilecc()}})))}else g_isopera?(toplevelcontextmenu=opera.contexts.menu.createItem({title:gs("LastPass"),icon:"images/icon16.png",onclick:open_login}),opera.contexts.menu.addItem(toplevelcontextmenu)):g_isfirefoxsdk&&(toplevelcontextmenu=g_context_menu.Item({label:gs("LastPass"),
image:self.data.url("images/icon16.png"),context:g_context_menu.PredicateContext(function(){return!0}),contentScript:"self.on('click', function() { self.postMessage(); });",onMessage:function(){open_login()}}))}}function setbadgetext(a){if(lastbadgeurl!=a){lastbadgeurl=a;var b=lp_gettld_url(a);a=reorderOnURL(getsites(b),a,!0,!1);0<a.length?set_badge_text(a.length):clear_badge_text()}}var context_menus_created=!1;
function createContextMenus(){lpdbg("context","createContextMenus called");if("undefined"!=typeof chrome&&("undefined"!=typeof chrome.contextMenus&&!is_guiless())&&(!context_menus_created||1==lpGetPref("hideContextMenus",0)))lpdbg("context","not created yet or preference changed"),chrome.contextMenus.removeAll(function(){lpdbg("context","context menu items all removed");context_menus_created=!1;contextParents=[];0==lpGetPref("hideContextMenus",0)&&(lpdbg("context","creating context menu"),toplevelcontextmenu=
chrome.contextMenus.create({title:gs("LastPass"),contexts:["all"],onclick:cm_handler},cm_callback))})}createContextMenus();
function cm_handler(a){console_log("******Context menu item is clicked****");a&&(console_log("menuItemId: "+a.menuItemId),console_log("parentMenuItemId: "+a.parentMenuItemId),console_log("mediaType: "+a.mediaType),console_log("linkUrl: "+a.linkUrl),console_log("srcUrl: "+a.srcUrl),console_log("pageUrl: "+a.pageUrl),console_log("frameUrl: "+a.frameUrl),console_log("selectionText: "+a.selectionText),console_log("editable  "+a.editable));if(lploggedin){if(g_issafari){var b=[];for(a=0;a<g_formfills.length;a++)check_ident_ffid(g_formfills[a].ffid)&&
(b[b.length]=g_formfills[a]);get_selected_tab(null,function(a){var c=lp_gettld_url(gettaburl(a));sendCS(gettabid(a),{cmd:"showcontext",sites:cache_usernames(reorderOnURL(getsites(c),gettaburl(a),!0,!0)),formfills:LPJSON.stringify(b),can_copy:can_copy_to_clipboard()},"all")})}}else open_login()}function cm_callback(){console_log("Context menu callback function called");context_menus_created=!0}
function DeleteOldDynamicFiles(){var a=localStorage.getItem("ff.dat");if(null!=a){var b=a.indexOf("\n");-1!=b&&(a=a.substr(0,b),0<CompareLastPassVersions(ffver,a)&&localStorage.removeItem("ff.dat"))}}function geteventtargeturl(a){return g_ismaxthon?(a=geteventtarget(a))?a.url:"":g_isfirefoxsdk?(a=geteventtarget(a))?punycode.URLToASCII(a.url):"":punycode.URLToASCII(g_isopera?a.message.topurl:a.target.url)}
function geteventtarget(a){if(g_ismaxthon){for(var b=window.external.mxGetRuntime().create("mx.browser").tabs,d=0;d<b.length;d++){var c=b.getTab(d);if(c.url==a.topurl)return c}return null}return g_isfirefoxsdk?"undefined"!=typeof a.worker?a.worker.tab:"undefined"!=typeof a.target?a.target.tab:null:g_isopera?a.source:a.target}function GetStringResource(a,b){have_binary_function("GetStringResource")?call_binary_function("GetStringResource","",a,b):b("")}this.lpgs=function(a,b){return gs(a,b)};
function GetImageResource(a,b){have_binary_function("GetImageResource")?call_binary_function("GetImageResource","",a,function(a){b("data:image/png;base64,"+a)}):b("")}function event_dispatch_message(a,b,d){g_issafari?geteventtarget(a).page.dispatchMessage(b,d):g_isopera?(d.messagetype=b,geteventtarget(a).postMessage(d)):g_ismaxthon?(d.messagetype=b,window.external.mxGetRuntime().post(a.pageid,d)):g_isfirefoxsdk&&(d.messagetype=b,a.target.port.emit("message",d))}
function gettabidfromevent(a){if(g_isopera){for(var b=opera.extension.windows.getAll(),d=0;d<b.length;d++){get_tabs(b[d]);for(var c=0;c<get_tabs_length(b[d]);c++)if(punycode.URLToASCII(a.data.topurl)==gettaburl(get_tabs(b[d])[c]))return gettabid(get_tabs(b[d])[c])}return-1}return gettabid(geteventtarget(a))}
function LoadData(a,b){var d=[],c=localStorage.getItem(a);if(null!=c&&""!=c)for(var c=c.split("\n"),e=0;e<c.length;e++)b&&-1==c[e].indexOf(".")||(d[c[e]]="");if(debug||g_isdebug)c=Object.keys(d).length,verbose_log("Loaded "+c+" from "+a),write_history({cmd:"LoadData",file:a,num:c});return d}function LoadSpecialSites(){SpecialSites=LoadData("sites.dat",!0)}function LoadBigIconList(){BigIconList=LoadData("bigicons.dat")}
function isSpecialSite(a){return null==a?!1:"undefined"!=typeof SpecialSites[lpcanonizeUrl(a)]}function copytoclipboard(a){g_isfirefoxsdk&&"undefined"!=typeof g_clipboard?g_clipboard.set(a):(g_is_win||g_is_mac)&&have_binary_function("copy_to_clipboard")?call_binary_function("copy_to_clipboard",a):Clipboard.copy(a);if(can_clear_clipboard()){var b=lpGetPref("clearClipboardSecsVal",30);0<b&&setTimeout(function(){clearclipboardif(a)},1E3*b)}return!0}
function clearclipboardif(a){g_isfirefoxsdk&&"undefined"!=typeof g_clipboard?g_clipboard.get()==a&&g_clipboard.set(""):(g_is_win||g_is_mac)&&have_binary_function("clear_clipboard_if")&&call_binary_function("clear_clipboard_if",a)}function unlock_plug2web(){g_plug2web_last_initiated=lp_get_gmt_timestamp()}
"undefined"!=typeof chrome&&"undefined"!=typeof chrome.omnibox&&(chrome.omnibox.onInputChanged.addListener(function(a,b){if(lploggedin){if(0!=a.length){var d=[],c=g_prompts.edit_sn_prompt?!1:get_searchNotesPref(),c=search_results(a.toLowerCase(),c);typeof("undefined"!==c)&&c.sort(lp_sort_case_insensitive_name);var e=0,f;for(f in c){var g=c[f],h,k="id";g.sn?(h=of(g.name),k="sn"):(h=of(g.name),g=getusernamefromacct(g),""!=g&&(h+=" ("+of(g)+")"));d.push({content:gs("Launch")+" "+h+"     "+k+":"+get_record_id(c[f])+
"",description:h});if(7<e++)break}b(d)}}else b([{content:"login",description:gs("Login to LastPass")}])}),chrome.omnibox.onInputEntered.addListener(function(a){(!lploggedin||"login"==a)&&open_login();/id:\d+$/.test(a)?(a=a.split("id:"),a=a[1],launchautologin(a)):/id:app\d+$/.test(a)?(a=a.split("id:"),a=a[1],launch(a)):/sn:\d+$/.test(a)?(a=a.split("sn:"),a=a[1],editAid(a)):getBG().g_isadmin&&(console.log("You entered: "+a),openURL("https://rodan-internal.lastpass.com/admintools/search.php?q="+encodeURIComponent(a)+
"&xmarks=on"))}));function setup_push_listener(a){g_dopushserver&&(0>=60*parseInt(lpGetPref("pollServerVal",15))?console.log("No poll timer so no push notifications server."):(a=a.split(" "),push_server_connect(a[0],a[1],poll_server_request)))}function shutdown_push_listener(){push_server_disconnect()}function contextMenuOnClick(a,b){console.log("item "+a.menuItemId+" was clicked");console.log("info: "+JSON.stringify(a));console.log("tab: "+JSON.stringify(b));lploggedin||open_login()}
function can_copy_to_clipboard(){return(g_is_win||g_is_mac)&&have_binary_function("copy_to_clipboard",!0)?!0:g_ischrome||g_isfirefoxsdk&&"undefined"!=typeof g_clipboard?!0:!1}function can_clear_clipboard(){return(g_is_win||g_is_mac)&&have_binary_function("clear_clipboard_if")?!0:g_isfirefoxsdk&&"undefined"!=typeof g_clipboard?!0:!1}function is_guiless(){return"undefined"!=typeof g_guiless&&1==g_guiless}function skiplogin(){return"undefined"!=typeof g_nologin&&1==g_nologin}
function isadmin(){return g_isadmin}function getbaseurl(){return base_url}function update_create_account_data(){}function lpvt_store_data_and_setsinglefactortype(a){var b=getBG();b.have_binary_function("lpvt_store_data")&&b.call_binary_function("lpvt_store_data",a,gs("Swipe finger"),gs("Swipe your finger on the fingerprint sensor"),gs("Cancel"),gs("Swipe current user's finger"),function(a){a&&b.setsinglefactortype("vtapi")})}
function delete_file(a){var b=getBG();b.have_binary_function("delete_file")&&b.call_binary_function("delete_file",a)}function log(a){console_error(a)}
function ReadFileGeneric(a,b,d){var c=function(a){lplog("ReadFileGeneric : callback2 called");null==a?(lplog("ReadFileGeneric : callback2 called -- failed cuz data=null"),d("")):(b&&b<a.length&&(lplog("ReadFileGeneric : callback2 called -- truncating from="+a.length+" to="+b),a=a.substring(0,b)),"undefined"!=typeof d&&(lplog("ReadFileGeneric : callback2 calling callback"),d(a)))};have_binary_function("read_file")?(lplog("ReadFileGeneric : calling read_file binary function filename="+a+" filename2="+
db_prepend(a)),call_binary_function("read_file",db_prepend(a),c)):(lplog("ReadFileGeneric : calling localStorage.getItem filename="+a),c(localStorage.getItem(a)))}function WriteFileGeneric(a,b){have_binary_function("write_file")?call_binary_function("write_file",db_prepend(a),b):localStorage_setItem(a,b)}
function DeleteFileGeneric(a){if(have_binary_function("delete_file"))call_binary_function("delete_file",db_prepend(a));else try{localStorage.removeItem(a)}catch(b){L("Failed to removeItem("+a+") e: "+b)}}function lpevent(a){"undefined"==typeof g_events[a]&&(g_events[a]=0);g_events[a]+=1}
function fastDecryptAttachment(a,b,d,c,e,f){a=lpdec(c,e);"function"==typeof f&&!have_nplastpass()&&have_pplastpass()?"!"==d.charAt(0)?pplastpass_send_message({cmd:"decryptcbc",key:a,input:d},f):pplastpass_send_message({cmd:"decrypt",key:a,input:d},f):lpdec(d,AES.hex2bin(a),f)}
function fastEncryptAttachments(a,b,d){var c=[],e=0,f;for(f in b)b.hasOwnProperty(f)&&"undefined"!=typeof b[f]&&e++;for(f in b)b.hasOwnProperty(f)&&"undefined"!=typeof b[f]&&function(f){enccbc(b[f].bytes,a,function(a){c[c.length]={id:b[f].id,data:a};c.length==e&&d(c)})}(f)}function allow_nplastpass(){if(g_isopera&&g_is_mac){var a=navigator.userAgent.match(/Version\/(\d+)/);if(a&&12<=parseInt(a[1]))return!1}return!0}g_fixpbkdf2=!0;var g_onloaddelay=0;
function doDelayedOnload(){if(!g_ischrome||!g_do_native_messaging)!window.openDatabase&&window.indexedDB?(0==g_onloaddelay&&opendb(),g_onloaddelay++,g_db||20<g_onloaddelay?onLoad():setTimeout(function(){doDelayedOnload()},100)):onLoad();else{g_onloaddelay++;var a=localStorage.getItem("hadNativeMessaging");have_binary()||null==a&&5<g_onloaddelay||20<g_onloaddelay?onLoad():setTimeout(function(){doDelayedOnload()},100)}}
"undefined"!=typeof document&&!g_isfirefoxsdk?document.addEventListener("DOMContentLoaded",function(){window.addEventListener("load",function(){setTimeout(function(){doDelayedOnload()},0)});window.addEventListener("unload",function(){onUnload()})}):(doDelayedOnload(),g_isfirefoxsdk&&g_system_unload.when(function(){onUnload()}));function get_safari_version(){var a=navigator.appVersion.match(/Version\/(\d+\.\d+)(\.\d+)? Safari/),b=0;a&&(b=parseFloat(a[1]));return b}
g_issafari&&(safari.application.addEventListener("contextmenu",handleContextMenu,!1),6<=get_safari_version()?safari.application.addEventListener("beforeSearch",function(a){if(lploggedin){var b=a.query;b&&0==b.indexOf("lp ")&&(a.preventDefault(),opensearch(b.substring(3)))}},!1):safari.application.addEventListener("beforeNavigate",function(a){if(lploggedin){var b=a.url;b&&(b=b.replace(/^\w{2,8}:\/\//,"").replace(/\/$/,""),b=punycode.ToUnicode(unescape(b)).replace("&","%26"),0==b.indexOf("lp ")&&(a.preventDefault(),
opensearch(b.substring(3))))}},!1));function handleContextMenu(a){is_guiless()||1==lpGetPref("hideContextMenus",0)||a.contextMenu.appendContextMenuItem("LPContextMenuClick",gs("LastPass"))}function pplastpass_load(a){g_ischrome&&"pplastpass"==a.target.id&&pplastpass_send_message({cmd:"ping"},function(a){"pong"==a&&(g_pplastpass_loaded=!0)})}
function pplastpass_message(a){a=JSON.parse(a.data);if("function"==typeof g_pplastpass_callbacks[a.id]){var b=g_pplastpass_callbacks[a.id];g_pplastpass_callbacks[a.id]=null;b(a.retval)}}function have_pplastpass(){return g_pplastpass_loaded}var g_pplastpass_callbacks={};function pplastpass_send_message(a,b){var d=(new Date).getTime()+"_"+Math.floor(100*Math.random());g_pplastpass_callbacks[d]=b;a.id=d;document.getElementById("pplastpass").postMessage(JSON.stringify(a))}
function disablesitealert(a){var b=g_sites[a];b&&(b.noalert=1,a="id="+LP.en(a),b=issharedfolder(g_shares,b.group),a+=!1==b?"":"&sharedfolderid="+en(b.id),lpMakeRequest(base_url+"update_alert.php",a,function(){},function(){}),setTimeout(function(){rewritelocalfile()},0))}
function dopwchange(a,b,d){if(!g_cpwbot||!check_ident_aid(a))return!1;var c=get_record(a);if(!c)return!1;var e=c.pwprotect;if(!b&&(e||g_prompts.login_site_prompt))return security_prompt(function(){dopwchange(a,!0,d)}),!1;g_cpwbot&&CPWbot_bg&&(CPWbot_bg.site_html_url=geturlfromacct(c));!CPWbot_bg&&"undefined"!=typeof CPWbot_bg_lib&&(CPWbot_bg=new CPWbot_bg_lib);CPWbot_bg.mark_timestamp("dopwchange");CPWbot_bg.preinit();(new Date).getTime();var f=CPWbot_bg.new_session(c.url);CPWbot_bg.broken_hearted_st_id=
setTimeout(function(){CPWbot_bg.broken_hearted(f)},60001);g_ischrome&&chrome.tabs.onRemoved.addListener(function(a){CPWbot_bg&&a==CPWbot_bg.get_pwchangetabid()&&(verbose_log("tab "+a+" closed, halting"),(!CPWbatch||!CPWbatch.cpw_get_batchjob_state()||CPWbatch.cpw_get_batchjob_state()==F_DONE)&&cpwbot_halt())});get_recipe_for_url(c.url,function(b){if(CPWbot_bg&&b){CPWbot_bg.mark_timestamp("recipe_callback");if(!CPWbot_bg.get_login_url(b))return console_error("bad recipe - login_url property is not defined"),
CPWbot_bg.panic("bad recipe"),!1;"undefined"!=typeof d&&null!==d?(CPWbot_bg.originating_tabid=gettabid(d),CPWbot_bg.originating_tab=d):(CPWbot_bg.originating_tabid=null,CPWbot_bg.originating_tab=null);var c={aid:a,recipe:b};openURL(CPWbot_bg.get_login_url(b),function(a,b){var c=gettabid(a);CPWbot_bg.destination_tabid=c;CPWbot_bg.destination_tab=a;CPWbot_bg.mark_timestamp("openurl_callback");CPWbot_bg.initialize({tabid:c,aid:b.aid,recipe:b.recipe});verbose_log("going to run CPWbot_bg.initialize_engine for tabid="+
c);CPWbatch&&CPWbatch.cpw_get_batchjob_state()&&CPWbatch.register_worker(c,b.aid);g_issafari&&(a.addEventListener("close",function(){var a=gettabid(this);verbose_log("tab "+a+" closed, halting");CPWbot_bg&&a==CPWbot_bg.get_pwchangetabid()&&(!CPWbatch||!CPWbatch.cpw_get_batchjob_state()||CPWbatch.cpw_get_batchjob_state()==F_DONE)&&cpwbot_halt()},!1),d&&d.addEventListener("close",function(){var a=gettabid(this);verbose_log("site.html was just closed ; site.html="+a+" pwchange tabd="+c);CPWbot_bg&&c==
CPWbot_bg.get_pwchangetabid()&&cpwbot_halt()},!1));g_robots_txt||(CPWbot_bg.do_milestone(c,2,b.recipe),CPWbot_bg.initiate_on_complete(c,b),g_launches[gettabid(a)]=b.aid)},c,!0,!0,!0,!0);return!0}return!1});return!0}function disableallalerts(){g_disablepwalerts=!0;lpMakeRequest(base_url+"update_alert.php","all=1",function(){},function(){})}function checkgeneratepassword(a){sendCS(a,{cmd:"checkgeneratepassword"},"all")}
function parse_formdata(a){for(var b=a.formdata2.split("\n"),d=!1,c=!1,e="",f="",g=0;g<b.length;g++){var h=b[g].split("\t");if(!(4!=h.length&&5!=h.length)){var k=decodeURIComponent(h[2]),h=h[3];if((!d||!c)&&("text"==h||"email"==h||"tel"==h)&&k.length)e=k,d=!0;"password"==h&&(!c&&k.length)&&(f=k,c=!0)}}a.username=e;a.password=f;a.formdata=a.formdata2}
function closeclickables(a,b){var d=b?"true":"false";null!=a?sendCS(a,{cmd:"closeclickables",force:d,lploggedin:lploggedin},"all"):get_selected_tab(null,function(a){a=gettabid(a);sendCS(a,{cmd:"closeclickables",force:d,lploggedin:lploggedin},"all")});g_popupform_active[a]=0;g_popupform_active_choose[a]=0}
function closeallclickables(a){var b=a?"true":"false";get_all_windows({populate:!0},function(a){for(var c=0;c<a.length;c++)for(var e=0;e<get_tabs_length(a[c]);e++)sendCS(gettabid(get_tabs(a[c])[e]),{cmd:"closeclickables",force:b,lploggedin:lploggedin},"all")});g_popupform_active=[];g_popupform_active_choose=[];g_popupform_more_open=[];g_popupform_shownavbar=[]}
function handleGetNevers(a,b){setcurrenturl(b);if(do_experimental_popupfill){var d=LPJSON.stringify(getnevers());sendCS(a,{cmd:"gotnevers",g_nevers:d},"all")}}function doPopupResize(a,b,d){sendCS(a,{cmd:"popupfillresize",width:b,height:d},"all")}function isEmptyObject(a){return 0===Object.keys(a).length}function doPopupIconHint(a,b,d){sendCS(a,{cmd:"popupfilliconnumber",sitenumber:b,formfillsnumber:d},"all")}
function doPopupSaveOK(a){if(null==a)return!1;sendCS(a,{cmd:"popupfillsaveok"},g_CS_tops[a])}
function savesite_from_iframe(a,b){if(!lploggedin)return null;var d=punycode.URLToASCII(a.url);g_popup_url_by_tabid[b]&&(d=g_popup_url_by_tabid[b]);if(!check_for_frame_mismatch_ok(b,!0,gs("Are you sure you would like to save a new site to your LastPass vault?"),"savesite"))return null;var c=a.formdata2,e=a.name,f=a.group,g=a.username,h=a.password,k=a.orig_username,l=a.orig_password,j=null!=c&&0<c.length?!0:!1,q=issharedfolder(g_shares,f);if(!checkreadonly(q))return{error:gs("Sorry, this shared folder is read-only.")};
var n=!1==q?g_local_key:q.sharekey,m=createNewAcct(),u=lp_gettld_url(AES._utf8_encode(d));m.genpw=!1;m.name=e;m.group=f;m.url=AES._utf8_encode(d);m.tld=u;m.unencryptedUsername=g;m.username=lpmenc(g,!0,n);m.password=lpmenc(h,!0,n);m.extra="";m.fav=0;m.autologin=0;m.never_autofill=0;m.pwprotect=0;m.aid="0";!1!=q&&(m.sharefolderid=q.id,0==q.give&&(m.sharedfromaid=1));u=f;q&&(u=f.substr(q.decsharename.length+1));m.fields=[];m.save_all=a.save_all?1:0;f=[];c=updateAndEncryptData(c,m.fields,f,m,n,{save_all:0,
username:k,password:l,new_username:g,new_password:h,fromiframe:1});e="name="+en(lpenc(e,n))+"&grouping="+en(lpenc(u,n))+"&data="+en(bin2hex(c))+"&extra="+en(lpenc("",n));e=e+"&extjs=1&localupdate=1"+(!1==q?"":"&sharedfolderid="+en(q.id));m.newvalues=f;j?(e+="&ref="+en(AES.url2hex(d)),saveSiteFromSubmit(e,m)):(e+="&aid=0",e+="&url="+en(AES.url2hex(d)),e+="&openid_url=",e+="&username="+en(crypto_btoa(m.username)),e+="&password="+en(crypto_btoa(m.password)),saveSite(e,m));"fidelity.com"==m.tld?refreshsites():
fill({tabid:b,acct:m,desc:"fill_A4"});return{}}function verbose_log(a){(debug||"undefined"!=typeof verbose&&!0===verbose)&&lplog(a)}function can_allow_reprompt_skip(){return!(g_prompts.company_login_site_prompt||g_prompts.company_copyview_site_prompt)}function update_prefs(){}
function savesiteicon_real(a,b){"undefined"!=typeof b.iframe&&b.iframe?"undefined"!=typeof g_popup_tab_docnum[a]?sendCS(a,{cmd:"savesiteiframe"},g_popup_tab_docnum[a]):sendCS(a,{cmd:"savesiteiframe"}):"undefined"!=typeof g_popup_tab_docnum[a]?sendCS(a,{cmd:"savesiteicon"},g_popup_tab_docnum[a]):sendCS(a,{cmd:"savesiteicon"});g_popup_tabid_save=a}function changepw_wrapper(a){changePassword(a.newpw,Array(a.singleaid),"undefined"!=typeof a.autochange?a.autochange:null)}
function openchangepw_wrapper(a){openchangepw(a.newpw,a.tld,"undefined"==typeof a.excludeid?"":a.excludeid)}
function cobble_popup_iframe_data(a){var b="",d="",c="",e="",f=0,g=0,h="",k="";if(null!=a){null!=g_popupfill_hint[a]&&(null!=g_popupfill_last_active[a]&&null!=g_popupfill_hint[a][g_popupfill_last_active[a]])&&(e=g_popupfill_hint[a][g_popupfill_last_active[a]]);g_popupfill_hint_generate[a]&&(f=g_popupfill_hint_generate[a]);g_popupfill_hint_save[a]&&(g=g_popupfill_hint_save[a]);g_popupfill_hint_type[a]&&(k=g_popupfill_hint_type[a]);"undefined"!=typeof g_popupfill_last_active_fieldtype[a]&&(h=g_popupfill_last_active_fieldtype[a]);
var l=g_popup_url_by_tabid[a],j=assemble_popup_data_payload(l);j&&j.sites&&(b=j.sites);j&&j.favicons&&(d=j.favicons);j&&j.formfills&&(c=j.formfills)}var f=f?1:0,g=g?1:0,j=can_copy_to_clipboard()?1:0,q={ff_firstname_regexp:get_ff_translation("ff_firstname_regexp"),ff_middlename_regexp:get_ff_translation("ff_middlename_regexp"),ff_lastname_regexp:get_ff_translation("ff_lastname_regexp"),ff_username_regexp:get_ff_translation("ff_username_regexp"),ff_email_regexp:get_ff_translation("ff_email_regexp"),
ff_zip_regexp:get_ff_translation("ff_zip_regexp"),ff_currpass_regexp:get_ff_translation("ff_currpass_regexp"),ff_search_regexp:get_ff_translation("ff_search_regexp"),ff_captcha_regexp:get_ff_translation("ff_captcha_regexp"),ff_bankacctnum_regexp:get_ff_translation("ff_bankacctnum_regexp"),ff_company_regexp:get_ff_translation("ff_company_regexp"),ff_password_regexp:get_ff_translation("ff_password_regexp"),ff_question_answer_regexp:get_ff_translation("ff_question_answer_regexp"),ff_address1_regexp:get_ff_translation("ff_address1_regexp"),
ff_city_regexp:get_ff_translation("ff_city_regexp"),ff_forgot_regexp:get_ff_translation("ff_forgot_regexp"),ff_country_regexp:get_ff_translation("ff_country_regexp")},n=get_sitepwlen(lp_gettld_url(l));if(null===n||"string"==typeof n)n=0;var m=-1;g_possiblemax_tuple!==[]&&g_possiblemax_tuple[0]==a&&(m=g_possiblemax_tuple[1],g_possiblemax_tuple=[]);return{cmd:"gotpopupfilldata",sites:b,favicons:d,formfills:c,popuphtml:g_datacache[a].popuphtml,url:l,rowtype:e,ask_generate:f,can_copy_clipboard:j,lastpass_username:g_username,
inputtype:h,ask_save:g,maxpwlen:m,start_type:k,has_view_pw_challenge:g_prompts.view_pw_prompt?1:0,has_view_site_challenge:g_prompts.edit_site_prompt||g_prompts.company_copyview_site_prompt?1:0,has_view_ff_challenge:g_prompts.view_ff_prompt||g_prompts.company_copyview_site_prompt?1:0,site_pwlen:n,reg_obj:q,ftd:frame_and_topdoc_has_same_domain(a)}}
function toplevelpopupsetstate(a,b){var d=b?1:0;null!=a?sendCS(a,{cmd:"toplevelpopupsetstate",toplevel_exists:d},"all"):get_selected_tab(null,function(a){a=gettabid(a);sendCS(a,{cmd:"toplevelpopupsetstate",toplevel_exists:d},"all")})}
function closepopuptoplevel_handler(a){null!=a?(closeclickables(a,!1),toplevelpopupsetstate(a,!1),clear_popup_heartbeat(a),delete g_iframe_hack_src[a]):(get_selected_tab(null,function(a){a=gettabid(a);closeclickables(a,!1);toplevelpopupsetstate(a,!1);clear_popup_heartbeat(a)}),g_iframe_hack_src=[])}
function createpopuptoplevel_handler(a,b){sendCS(a,{cmd:"createpopuptoplevel",from_iframe:b},g_CS_tops[a]);toplevelpopupsetstate(a,!0);g_iframe_hack_src[a]=b.url;has_popup_heartbeat(a)||(do_popup_heartbeat(a),popup_heartbeat_fn(a))}
function assemble_popup_data_payload(a,b){var d=[],c={},e={},f="",g="",d="",f=[];b||(b=lp_gettld_url(a));d=getsites(b);d=reorderOnURL(d,a,!0);for(g=0;g<d.length;g++)c[d[g].aid]=geticonurlfromrecord(d[g]);for(g=0;g<g_formfills.length;g++)if(check_ident_ffid(g_formfills[g].ffid)){f[f.length]=g_formfills[g];var h=lpmdec_acct(g_formfills[g].ccnum,!0,g_formfills[g],g_shares);c[g_formfills[g].ffid]=geticonCCnum(h)}g=LPJSON.stringify("");f&&0<f.length&&(g=LPJSON.stringify(f));d=cache_usernames(d);f=g;g=
LPJSON.stringify(c);d&&(e.sites=d);f&&(e.formfills=f);g&&(e.favicons=g);return e}function remember_changed_pw(a,b){if(a&&b)return verbose_log("storing pw="+(g_show_pw_in_logs||g_isadmin?a:"REDACTED")+" tld="+b+" in g_didchangepw"),g_didchangepw[SHA256(a+b)]=(new Date).getTime(),!0;verbose_log("tried but failed to store pw="+(g_show_pw_in_logs||g_isadmin?a:"REDACTED")+" tld="+b+" in g_didchangepw");return!1}var g_inner_text=[];function got_inner_text_handler(a,b){g_inner_text[a]=b.buf}
function got_inner_html_handler(){return!0}function get_cs_inner_text(a,b){sendCS(a,{cmd:"get_inner_text"},b)}function get_cs_inner_html(a,b){sendCS(a,{cmd:"get_inner_html"},b)}function browser_focus(){g_ischrome&&chrome.windows.update(chrome.windows.WINDOW_ID_CURRENT,{focused:!0})}
function send_sms_passcodes(a){lpMakeRequest(base_url+"send_sms_passcodes.php",a,function(){alert(gs("A batch of SMS passcodes have been sent to your mobile device."))},function(){alert(gs("Request failed; is your Internet connection down?"))})}function create_account(a,b,d){a+="&method="+encodeURIComponent(get_method());a+=get_devicetype_param();lpMakeRequest(base_url+"create_account.php",a,b,d)}function enable_credit_monitoring(a,b,d){lpMakeRequest(base_url+"creditmon.php",a,b,d)}
var g_hotkeys=[];
function setup_hotkeys(){if(g_isfirefoxsdk&&"undefined"!=typeof g_ff_hotkeys){for(var a=0;a<g_hotkeys.length;a++)g_hotkeys[a].destroy();g_hotkeys=[];for(a=0;a<g_lp_hotkeys.length;a++)(function(a){var d=lpGetPref(a+"KeyCode",0),c=lpGetPref(a+"Mods","");if(0!=d&&""!=c){var e="";-1!=c.indexOf("control")&&(e+="control-");-1!=c.indexOf("meta")&&(e+="meta-");-1!=c.indexOf("alt")&&(e+="alt-");-1!=c.indexOf("shift")&&(e+="shift-");e=33==d?e+"pageup":34==d?e+"pagedown":35==d?e+"end":36==d?e+"home":37==d?e+
"left":38==d?e+"up":39==d?e+"right":40==d?e+"down":189==d?e+"-":219==d?e+"[":220==d?e+"\\":221==d?e+"]":186==d?e+";":222==d?e+"'":188==d?e+",":187==d?e+"+":190==d?e+".":191==d?e+"/":106==d?e+"*":192==d?e+"~":124==d?e+"printscreen":e+String.fromCharCode(d).toLowerCase();g_hotkeys.push(g_ff_hotkeys.Hotkey({combo:e,onPress:function(){processCS(null,{cmd:"runhotkey",hotkey:a})}}))}})(g_lp_hotkeys[a])}}
function base64_to_binary_ciphertext(a){var b=a.split("|"),d="";2==b.length?(a=b[0].slice(1),b=b[1],d="!"+atob(a)+atob(b)):d="!"==a.charAt(0)?atob(a.slice(1)):"!"+atob(a);return d}function aidkiller(a,b,d){setTimeout(function(){"undefined"!==typeof d&&d&&(g_cached_hash=null,g_hash_live=0)},b)}
SecureReprompter=new function(){this.secretcache={};this.secure_reprompt_token="<SECURE_REPROMPT>";this.most_recent_aid=null;this.add_secret=function(a,b,d,c){this.most_recent_aid=a;for(var e in b.fields)"password"==b.fields[e].type&&(b.fields[e].value=base64_to_binary_ciphertext(b.fields[e].value));e=this.get_secret_field(b);var f=base64_to_binary_ciphertext(b[e]);b[e]=f;d*=1E3;0===d||"undefined"==typeof d&&"undefined"!==typeof c?d=3E3:g_cached_hash=c;3E3>d&&(d=3E3);this.secretcache[a]=[b,!0];g_secret_cache=
this.secretcache;g_hash_live<d?(aidkiller(a,d,1),g_hash_live=d):aidkiller(a,d)};this.get_secret=function(a){if("undefined"==typeof a&&"undefined"==typeof this.most_recent_aid)return null;"undefined"==typeof a&&(a=this.most_recent_aid);a=this.secretcache[a];return"undefined"==typeof a?null:a[0]};this.get_secret_field=function(a){return"http://sn"===a.url?"extra":"password"};this.should_secure_reprompt=function(a){if("http://sn"==a.url){if(a.extra==this.secure_reprompt_token)return!0}else if(a.password==
this.secure_reprompt_token)return!0;for(var b in a.fields)if("password"==a.fields[b].type&&a.fields[b].value==this.secure_reprompt_token)return!0;return!1};this.g_secure_reprompt_token="<SECURE_REPROMPT>";this.set_securereprompt_secret=function(a){this.g_securereprompt_secret=a};this.get_securereprompt_secret=function(){var a=this.g_securereprompt_secret;this.g_securereprompt_secret=null;return a}};function fix_sites_secure_reprompt(){}
function fennec_menu(){if(lploggedin){var a=g_chrome.Cc["@mozilla.org/embedcomp/prompt-service;1"].getService(g_chrome.Ci.nsIPromptService),b=a.BUTTON_POS_0*a.BUTTON_TITLE_IS_STRING+a.BUTTON_POS_1*a.BUTTON_TITLE_IS_STRING+a.BUTTON_POS_2*a.BUTTON_TITLE_IS_STRING,b=a.confirmEx(null,gs("LastPass"),null,b,gs("More"),gs("Fill Forms"),gs("AutoFill"),null,{});if(0==b)if(b=a.BUTTON_POS_0*a.BUTTON_TITLE_IS_STRING+a.BUTTON_POS_1*a.BUTTON_TITLE_IS_STRING,b=a.confirmEx(null,gs("More"),null,b,gs("Logoff"),gs("Preferences"),
null,null,{}),0==b)lplogoff();else{if(1==b){var b=[gs("Logoff on browser close"),gs("Logoff after logged in for minutes")],d={};if(a.select(null,gs("Preferences"),gs("Select a preference to edit, then tap OK."),b.length,b,d))switch(d.value){case 0:b={value:1==lpGetPref("logoffWhenCloseBrowser",0)};a.confirmCheck(null,gs("Logoff on browser close"),null,gs("Logoff on browser close"),b)&&(lpPutGblPref("logoffWhenCloseBrowser",b.value?1:0),lpWriteAllPrefs());break;case 1:b={value:lpGetPref("logOffAfterLoggedInVal",
0)},a.prompt(null,gs("Logoff after logged in for minutes"),null,b,null,{})&&(a=parseInt(b.value),0<=a&&9999>=a?(lpPutUserPref("logOffAfterLoggedInVal",a),lpWriteAllPrefs()):alert("Invalid value, must be between 0 and 9999."))}}}else if(1==b)if(0==g_formfills.length)alert(gs("No Form Fill Profiles!"));else{for(var d={},b=[],c=0;c<g_formfills.length;c++)b[c]=g_formfills[c].decprofilename;a.select(null,gs("Fill Forms"),null,b.length,b,d)&&fillform(g_formfills[d.value].ffid)}else if(2==b){var e=getmatchingsites();
if(0==e.length)alert(gs("No Matching Sites!"));else{d={};b=[];for(c=0;c<e.length;c++){b[c]=e[c].name;var f=getusernamefromacct(e[c]);""!=f&&(b[c]+=" ("+f+")")}a.select(null,gs("AutoFill"),null,b.length,b,d)&&handleFill(getcurrenttabid(),{url:getcurrenturl(),topurl:getcurrenturl(),docid:0,force:!1,docnum:0,cmd:"autofillaid",aid:e[d.value].aid})}}}else open_login()}function getLoginSitePrompt(){return g_prompts.login_site_prompt}
function getNameUsernameFromLPA(a){if(!a)return"";var b=a.name;a=getusernamefromacct(a);""!=a&&(b+=" ("+a+")");return b}function get_breach_data(){return g_breach_data}function hostof(a){var b=document.createElement("a");b.href=a;return b.host}
function needs_secure_reprompt(a){if(!a||"string"==typeof a.appaid)return!1;a=get_record(a.aid);for(var b in a)if(a[b]==SecureReprompter.secure_reprompt_token)return!0;for(b in a.fields)if(a.fields[b]==SecureReprompter.secure_reprompt_token)return!0;return!1}
function debug_checkpoint_handler(a,b){var d="";if(b&&is_user_debug_enabled()&&"undefined"!=typeof b.msg&&b.msg&&0<b.msg.length){try{d=JSON.parse(b.msg)}catch(c){console_error("json parse failed on '"+b.msg+"'")}console_log(sprintf("DEBUG [%s][%d][%s][t=%d][url=%s] %s",a,b.docnum,b.docstate,b.timestamp,b.url,d));d={cmd:"dbgCS",tabid:a,docnum:b.docnum,url:b.url,docstate:b.docstate,msg:d};"undefined"!=typeof b.history_cmd&&b.history_cmd&&(d.cmd=b.history_cmd);"undefined"!=typeof b.timestamp&&b.timestamp&&
(d.timestamp=b.timestamp);"undefined"!=typeof b.aid&&(d.aid=b.aid);"undefined"!=typeof b.num&&(d.num=b.num);"undefined"!=typeof b.param1&&(d.param1=b.param1);"undefined"!=typeof b.param2&&(d.param2=b.param2);"undefined"!=typeof b.param3&&(d.param3=b.param3);"undefined"!=typeof b.param4&&(d.param4=b.param4);"undefined"!=typeof b.param5&&(d.param5=b.param5);"undefined"!=typeof b.param6&&(d.param6=b.param6);"undefined"!=typeof b.param7&&(d.param7=b.param7);"undefined"!=typeof b.param8&&(d.param8=b.param8);
"undefined"!=typeof b.param9&&(d.param9=b.param9);write_history(d)}}function frame_and_topdoc_has_same_domain(a){var b=ftd_get_frameparenturl(a);a=ftd_get_topurl(a);return b&&a&&compare_tlds(lp_gettld_url(a),lp_gettld_url(b))?!0:!1}function ftd_report_error(a,b){var d=sprintf("cmd=showiframeconfirm type=%s tldurl=%s tldurliframe=%s",b,lpcanonizeUrl(ftd_get_topurl(a)),lpcanonizeUrl(ftd_get_frameparenturl(a)));lplog("ftd_report_error : "+d);return lpReportError(d)}
function ftd_get_frameparenturl(a){return null===g_popup_url_by_tabid||null===a||"undefined"==typeof g_popup_url_by_tabid[a]?"":g_popup_url_by_tabid[a]}
function ftd_get_topurl(a){if(null===g_CS_tops||null===g_CS||"undefined"==typeof g_CS[a]||null===g_CS[a]||null===a)return"";var b="",d=g_CS_tops[a];if("undefined"==typeof d||null===d){console.warn("no topdocnum for tabid="+a);if(g_ischrome)try{for(var c in g_CS[a])if(g_CS[a].hasOwnProperty(c)&&"undefined"!=typeof g_CS[a][c].sender&&g_CS[a][c].sender&&g_CS[a][c].sender.tab&&g_CS[a][c].sender.tab.url){b=g_CS[a][c].sender.tab.url;break}}catch(e){}return b}if(g_CS[a]&&(a=g_CS[a][d]))b=gettaburl(a),!b&&
a.name&&(b=a.name);return b}function lpConfirmYesNo(a){return confirm(a)}var g_popup_heartbeat={};function do_popup_heartbeat(a){null==g_popup_heartbeat&&(g_popup_heartbeat={});g_popup_heartbeat[a.toString()]=!0}function has_popup_heartbeat(a){return null==g_popup_heartbeat?(g_popup_heartbeat={},!1):!0===g_popup_heartbeat[a.toString()]}
function popup_heartbeat_fn(a,b){null!=a&&(b||(b=1),doPopupResize(a,-1,-1),!0===g_popup_heartbeat[a.toString()]&&setTimeout(function(){popup_heartbeat_fn(a,b+1)},1099))}function clear_popup_heartbeat(a){null!=a&&(null==g_popup_heartbeat&&(g_popup_heartbeat={}),g_popup_heartbeat[a.toString()]=!1)}
function getnevers_given(a,b){function d(a,b,c,d,e,f){if(g_neverurls[b]&&0<g_neverurls[b].length)for(var g=0;g_neverurls[b]&&g<g_neverurls[b].length;g++){var h=g_neverurls[b][g];h==c?(a.push({type:b,url:h,domain:0}),a.push({type:b,url:e,domain:0})):h==d&&(a.push({type:b,url:h,domain:1}),a.push({type:b,url:f,domain:1}))}}if(a)var c=a,e=getcurrenturl(),f=lp_gettld_url(e);else f=e="",c=getcurrenturl();var g=lp_gettld_url(c),c=lpcanonizeUrl(c),h=[];b&&(h=b);d(h,"neveraccounts",c,g,e,f);d(h,"neverautologins",
c,g,e,f);d(h,"neverformfills",c,g,e,f);d(h,"nevergenerates",c,g,e,f);d(h,"neverautofills",c,g,e,f);d(h,"nevershowicons",c,g,e,f);d(h,"neverenablelp",c,g,e,f);return h}function openlastpasslegacy(){g_legacy_enabled&&(unlock_plug2web(),openURL(base_url+"?dolegacy=1&lpnorefresh=1"))}
function get_browser_history_tlds(a){var b=function(b){for(var c={},e=0;e<b.length;e++)c[lp_gettld_url(b[e].url)]=!0;a(Object.keys(c))};if(g_isfirefoxsdk&&"undefined"!=typeof g_places_history)g_places_history.search().on("end",b);else g_ischrome?chrome.permissions.contains({permissions:["history"]},function(a){a?"undefined"!=typeof chrome.history?chrome.history.search({text:"",startTime:0,endTime:(new Date).getTime(),maxResults:0},b):alert(gs("Please restart your browser to finish enabling history.")):
chrome.permissions.request({permissions:["history"]},function(a){a&&alert(gs("Please restart your browser to finish enabling history."))})}):g_issafari&&have_binary_function("get_safari_history")?call_binary_function("get_safari_history",function(a){a=""!=a?a.split("\n"):[];for(var c=0;c<a.length;c++)a[c]={url:a[c]};b(a)}):b([])}function get_equiv_domains_for_tab(){}
function start_trial(){var a=multifactor_getdata("postdata");return g_trial_available&&a&&""!=a?(lpMakeRequest(base_url+"login.php",a+"&starttrial=1",lpLoginResponse,lpLoginError),!0):!1}function opendebugtab(){openURL(getchromeurl("debug.html"))}function is_user_debug_enabled(){return g_isdebug}function cleardeccache(){"undefined"!=typeof mdec_cache&&(mdec_cache=[]);"undefined"!=typeof mdec_cache_key&&(mdec_cache_key=null)}
function is_human_initiated_action(a){var b=!1;lp_in_array(a.cmd,["fillfield","fillbest"])&&a.manualfill&&(b=!0);return b}function repromptSuccess(){g_reprompt_callback()}
function get_plugin_capabilities_handler(a){try{var b={lpversion:lpversion,have_nplastpass:have_nplastpass(),nplastpass_version:get_nplastpass_version(),have_native_messaging:have_native_messaging(),have_native_messaging_permission:g_have_native_messaging_permission,have_ws:have_ws(),have_pplastpass:have_pplastpass(),can_cpwbot:g_cpwbot?1:0,can_disable_lp:1};a&&sendCS(a,{cmd:"got_plugin_capabilities",capabilities:JSON.stringify(b)})}catch(d){return console_warn(d),!1}return!0};
